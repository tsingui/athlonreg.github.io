<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Canvas&#39;s Blog</title>
  
  <subtitle>å¥—é™†çš„åšå®¢</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://iamzhl.top/"/>
  <updated>2019-03-11T16:21:49.900Z</updated>
  <id>https://iamzhl.top/</id>
  
  <author>
    <name>Canvas/å¥—é™†</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CentOS å®‰è£…é…ç½® GitLab</title>
    <link href="https://iamzhl.top/Setup-gitlab-to-support-frame.html"/>
    <id>https://iamzhl.top/Setup-gitlab-to-support-frame.html</id>
    <published>2019-02-01T02:55:52.000Z</published>
    <updated>2019-03-11T16:21:49.900Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="CentOS-å®‰è£…-GitLab"><a href="#CentOS-å®‰è£…-GitLab" class="headerlink" title="CentOS å®‰è£… GitLab"></a>CentOS å®‰è£… GitLab</h2><h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install curl</span></span><br><span class="line"><span class="comment"># yum -y install postfix</span></span><br><span class="line"><span class="comment"># systemctl start postfix</span></span><br><span class="line"><span class="comment"># systemctl enable postfix</span></span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½-GitLab-çš„-RPM-åŒ…"><a href="#ä¸‹è½½-GitLab-çš„-RPM-åŒ…" class="headerlink" title="ä¸‹è½½ GitLab çš„ RPM åŒ…"></a>ä¸‹è½½ GitLab çš„ RPM åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-11.7.0-ce.0.el7.x86_64.rpm</span></span><br></pre></td></tr></table></figure><p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuL2dpdGxhYi1jZS95dW0vZWw3Lw==" title="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/<i class="fa fa-external-link"></i></span>æ‰¾è‡ªå·±éœ€è¦çš„ç‰ˆæœ¬ï¼Œä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åå®‰è£…å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -ivh  gitlab-ce-11.7.0-ce.0.el7.x86_64.rpm</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¿™æ ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum localinstall gitlab-ce-11.7.0-ce.0.el7.x86_64.rpm</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®-gitlab-repo"><a href="#é…ç½®-gitlab-repo" class="headerlink" title="é…ç½® gitlab repo"></a>é…ç½® gitlab repo</h2><p>ä¸ºäº†åç»­å‡çº§æ–¹ä¾¿ï¼Œå»ºè®®æ·»åŠ <code>gitlab</code>çš„<code>repo</code>æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sh</span></span><br></pre></td></tr></table></figure><h2 id="ç«¯å£ä¿®æ”¹"><a href="#ç«¯å£ä¿®æ”¹" class="headerlink" title="ç«¯å£ä¿®æ”¹"></a>ç«¯å£ä¿®æ”¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/gitlab/gitlab.rb</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸‹é¢çš„å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">external_url &apos;http://devops.iamzhl.top:8090&apos;</span><br><span class="line">unicorn[&apos;port&apos;] = 8070</span><br><span class="line">nginx[&apos;listen_port&apos;] = 8090</span><br></pre></td></tr></table></figure><p><em>è¯·æ ¹æ®ä¸ªäººéœ€è¦è¿›è¡Œå®šåˆ¶</em></p><h2 id="é‡æ–°éƒ¨ç½²å¹¶é‡å¯"><a href="#é‡æ–°éƒ¨ç½²å¹¶é‡å¯" class="headerlink" title="é‡æ–°éƒ¨ç½²å¹¶é‡å¯"></a>é‡æ–°éƒ¨ç½²å¹¶é‡å¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gitlab-ctl reconfigure</span></span><br><span class="line"><span class="comment"># gitlab-ctl restart</span></span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®é¡µé¢åµŒå¥—æ”¯æŒ"><a href="#è®¾ç½®é¡µé¢åµŒå¥—æ”¯æŒ" class="headerlink" title="è®¾ç½®é¡µé¢åµŒå¥—æ”¯æŒ"></a>è®¾ç½®é¡µé¢åµŒå¥—æ”¯æŒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/opt/gitlab/nginx/conf/gitlab-http.conf</span></span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fzqr3dsb7gj31p818kgzc.jpg" alt></p><p>å¦‚å›¾ï¼Œæ·»åŠ æ ‡æ³¨çš„å±æ€§è®¾ç½®åé‡å¯<code>GitLab</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gitlab-ctl restart</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      CentOS å®‰è£…é…ç½® GitLab
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="GitLab" scheme="https://iamzhl.top/tags/GitLab/"/>
    
      <category term="frame" scheme="https://iamzhl.top/tags/frame/"/>
    
  </entry>
  
  <entry>
    <title>é«˜æ•ˆåˆ©ç”¨æœ‰é“äº‘ç¬”è®°</title>
    <link href="https://iamzhl.top/How-to-use-youdao-note-in-a-special-way.html"/>
    <id>https://iamzhl.top/How-to-use-youdao-note-in-a-special-way.html</id>
    <published>2019-01-20T13:12:25.000Z</published>
    <updated>2019-03-11T16:21:49.892Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…ˆè¯´å‡ ä¸ªåšä¸»å’Œå…¶ä»–çš„ç å­—å†œæ°‘å·¥æ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜</p><ul><li>äº‘åŒæ­¥</li></ul><p>ç°åœ¨æ˜¯äº‘çš„æ—¶ä»£ï¼Œæ²¡æœ‰äº‘åŒæ­¥çš„ç æ–‡ç¯å¢ƒä¸æ˜¯ä¸€ä¸ªå¥½çš„ç¯å¢ƒï¼Œå¯èƒ½æ¯ä¸ªäººéƒ½æœ‰ä¸æ­¢ä¸€ä¸ªç æ–‡å¹³å°ï¼Œæ¯”å¦‚å·¥ä½œé…çš„æœºå™¨å’Œç§äººçš„æœºå™¨ï¼Œæˆ‘åœ¨å…¶ä¸­ä¸€å°æœºå™¨å†™å¥½çš„æ–‡ç« è¿˜è¦å†å†™ä¸€ä»½åˆ°å¦å¤–çš„æœºå™¨ã€‚ã€‚ã€‚ç®€ç›´ä¸è¦å¤ªlowerã€‚å¯èƒ½æœ‰äººè¯´æˆ‘ä»¬ç”¨æŸåº¦ç½‘ç›˜ã€‚ã€‚ã€‚Whatâ€™s thatï¼Ÿå·²ç»æ”¾å¼ƒå¥½ä¹…ï¼Œæœ¬æ–‡ä¸åšèµ˜è¿°ï¼Œæƒ³ç”¨çš„å°±ç”¨å§ã€‚ã€‚ã€‚</p><ul><li>è·¨å¹³å°</li></ul><p>è¿™é‡Œå‡è®¾ä¸Šé¢çš„ç¯å¢ƒæˆç«‹ï¼Œä½ æœ‰ä¸¤å°æœºå™¨ï¼Œç§äººçš„æ˜¯Macç¯å¢ƒï¼Œå·¥ä½œæœºå™¨æ˜¯Windowsï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¹‹å‰æˆ‘åœ¨Macéå¸¸å–œæ¬¢MWebï¼Œå› ä¸ºå®ƒçš„å›¾åºŠé›†æˆè®©æˆ‘ç€è¿· ï¼Œæˆªå›¾ç²˜è´´ä¸€å¼ å¼•ç”¨å¤–é“¾çš„å›¾ç‰‡å°±è¿™ä¹ˆå®Œæˆäº†ï¼Œå°±æ˜¯è¿™ä¹ˆå¿«ï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿå·²ç»æ”¾å¼ƒäº†ï¼Œå› ä¸ºWindowså¹³å°äººå®¶ä¸åšï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆï¼Œæˆ‘ä¸æƒ³å–·Windowså¤ªåƒåœ¾ğŸŒğŸŒä½†æ˜¯æ— å¥ˆå•ä½åªæœ‰Windowsï¼Œäºæ˜¯æˆ‘è¦ç”¨ä¸¤å¥—ç¯å¢ƒã€‚ã€‚ã€‚è®°ä½ä¸¤å¥—å¿«æ·é”®ã€‚ã€‚ã€‚</p><ul><li>MarkDown</li></ul><p>å…³äºMarkDownçš„ä»‹ç»è¿™é‡Œä¸èµ˜è¿°ã€‚äºæˆ‘è€Œè¨€ï¼Œä¸æ”¯æŒMarkDownè§£æçš„ç¼–è¾‘å™¨ï¼Œæˆ‘æ˜¯ç»å¯¹ä¸ä¼šç”¨çš„ï¼ŒWordå°±å·¥ä½œç”¨ç”¨ã€‚ã€‚ã€‚ä¸ºä½•å‘¢ï¼Ÿå› ä¸ºMarkDownå¤ªä¼˜é›…äº†ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼ŒWordå’ŒMarkDownå°±åƒ50å²çš„å¤§å¦ˆå’Œ20å²çš„å¦™é¾„å°‘å¥³ï¼Œå†™æ–‡æ¡£å‘åšæ–‡ç”¨Wordç®€ç›´æ˜¯é­ç½ªï¼Œç”¨MarkDownç®€ç›´æ˜¯äº«å—ï¼Œå½“ç„¶å•¦ï¼Œçº¯å±ä¸ªäººçœ‹æ³•ï¼Œä¸å–œå‹¿å–·ã€‚ã€‚ã€‚</p><ul><li>å›¾åºŠ</li></ul><p>è¯´å®Œäº†MarkDownå’Œäº‘çš„é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜å¾ˆæ˜æ˜¾ï¼Œäº‘ä¸Šçš„æ•°æ®æ–‡å­—å¯ä»¥ï¼Œå›¾ç‰‡ç”šè‡³è§†é¢‘æ€ä¹ˆåŠï¼Ÿéš¾é“æˆ‘è¿˜è¦ä¹°ä¸ªäº‘å­˜å‚¨ç”šè‡³æ˜¯äº‘æœåŠ¡å™¨ï¼Ÿå½“ç„¶ä¸ç”¨å•¦ï¼å›½å†…æœ‰äº›å¤§å…¬å¸è¿˜æ˜¯ç›¸å½“è‰¯å¿ƒçš„ï¼Œå…ˆç¥ç§˜ä¸€ä¸‹ï¼Œå…·ä½“ç”¨ä»€ä¹ˆï¼Œä¸‹é¢è¯¦ç»†è¯´ğŸ˜„</p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>ç¼–è¾‘å™¨<ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cudHlwb3JhLmlv" title="https://www.typora.io">Typora<i class="fa fa-external-link"></i></span></li></ul></li><li>æˆªå›¾å·¥å…·<ul><li>Windowsï¼š<span class="exturl" data-url="aHR0cHM6Ly9zbmlwLnFxLmNvbQ==" title="https://snip.qq.com">Snip<i class="fa fa-external-link"></i></span></li><li>macOSï¼š<span class="exturl" data-url="aHR0cHM6Ly96aC54bmlwYXBwLmNvbQ==" title="https://zh.xnipapp.com">Xnip<i class="fa fa-external-link"></i></span></li></ul></li><li>å›¾åºŠ<ul><li>Sina Weoboè´¦å·(Sinaçš„å¾®åšå¹³å°æä¾›äº†ä¸€ä¸ªå›¾åºŠæœåŠ¡ï¼Œè‡ªå¸¦cdn)</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01vbHVuZXJmaW5uL1BpY0dvL3JlbGVhc2Vz" title="https://github.com/Molunerfinn/PicGo/releases">PicGo<i class="fa fa-external-link"></i></span></li></ul></li><li>äº‘åŒæ­¥<ul><li><span class="exturl" data-url="aHR0cDovL25vdGUueW91ZGFvLmNvbQ==" title="http://note.youdao.com">æœ‰é“äº‘ç¬”è®°<i class="fa fa-external-link"></i></span></li></ul></li></ul><h2 id="é…ç½®PicGo"><a href="#é…ç½®PicGo" class="headerlink" title="é…ç½®PicGo"></a>é…ç½®PicGo</h2><p>å…¶ä»–çš„éƒ½æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œè¯´ä¸€ä¸‹PicGoçš„é…ç½®å§ï¼é¦–å…ˆåœ¨æ–°æµªå¾®åšå®˜ç½‘ç™»å½•å¾®åšè´¦å·ï¼Œç„¶åæ‰“å¼€<span class="exturl" data-url="aHR0cHM6Ly93ZWliby5jb20vbWluaXB1Ymxpc2g=" title="https://weibo.com/minipublish">minipublish<i class="fa fa-external-link"></i></span>é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fzde3dq3hvj326w1e047w.jpg" alt></p><p>ç„¶åæ‰“å¼€è°ƒè¯•çª—å£ï¼Œ<code>Chrome</code>å¿«æ·é”®ä¸º<code>F12</code>ï¼Œç„¶åè°ƒåˆ°ç½‘ç»œé€‰é¡¹å¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fzde59wlkyj326w1e0gzx.jpg" alt></p><p>ç‚¹å‡»<code>minipublish</code>ï¼ŒæŸ¥çœ‹ä¸€ä¸‹Cookieå€¼å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fzde6i4je7j326w1e0tpj.jpg" alt></p><p>é€‰ä¸­Cookieåé¢é‚£ä¸€ä¸²å­—ç¬¦ï¼Œæ‹·è´ä¸€ä¸‹ï¼Œæ‰“å¼€<code>PicGo</code>çª—å£ï¼Œæ‰¾åˆ°å›¾åºŠè®¾ç½® -&gt; æ–°æµªå›¾åºŠï¼Œåœ¨Cookieåé¢çš„è¾“å…¥æ¡†ç²˜è´´åˆšæ‰çš„å­—ç¬¦ä¸²ï¼Œå‹¾é€‰cookieæ¨¡å¼ï¼Œç‚¹å‡»ç¡®å®š -&gt; è®¾ä¸ºé»˜è®¤å›¾åºŠï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fzde7rnurvj31eo0v847r.jpg" alt></p><p>è¿™æ—¶å€™ï¼Œç”¨å‰æ–‡æ‰€è¯´çš„æˆªå›¾å·¥å…·æˆ–è€…è‡ªå·±å–œæ¬¢çš„å·¥å…·æˆªå›¾ï¼Œç„¶åæŒ‰ä¸‹åˆšåˆšè®¾ç½®çš„å¿«æ·é”®ï¼Œå›¾ç‰‡å°±ä¼šä¸Šä¼ åˆ°æ–°æµªå¾®åšçš„å›¾åºŠæœåŠ¡å™¨ï¼Œç„¶åå°†å›¾ç‰‡çš„å¤–é“¾è¿”å›ç»™å‰ªè´´æ¿äº†ã€‚</p><p>åœ¨æœ‰é“äº‘éšä¾¿å»ºä¸€ä¸ªMarkDownæ–‡æ¡£ï¼Œç²˜è´´ä¸€ä¸‹ï¼Œå¦‚å›¾</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fzdem32mcej320w1e0nep.jpg" alt></p><p>æ–‡æ¡£ä¿å­˜åï¼Œæœ‰é“äº‘ç¬”è®°ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œäº‘åŒæ­¥ï¼Œä»æ­¤ä¸å¿…æ‹…å¿ƒå…¶3Gçš„ç©ºé—´ä¸å¤Ÿç”¨äº†ã€‚</p><p>å½“ç„¶å•¦ï¼Œå¿«æ·é”®æ ¹æ®ä¸ªäººä¹ æƒ¯åœ¨PicGoè®¾ç½®é‡Œé¢è‡ªè¡Œå®šä¹‰å§ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      é«˜æ•ˆåˆ©ç”¨æœ‰é“äº‘ç¬”è®°
    
    </summary>
    
      <category term="é«˜æ•ˆåˆ©ç”¨æœ‰é“äº‘ç¬”è®°" scheme="https://iamzhl.top/categories/%E9%AB%98%E6%95%88%E5%88%A9%E7%94%A8%E6%9C%89%E9%81%93%E4%BA%91%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="æœ‰é“äº‘ç¬”è®°" scheme="https://iamzhl.top/tags/%E6%9C%89%E9%81%93%E4%BA%91%E7%AC%94%E8%AE%B0/"/>
    
      <category term="Picbed" scheme="https://iamzhl.top/tags/Picbed/"/>
    
      <category term="å›¾åºŠ" scheme="https://iamzhl.top/tags/%E5%9B%BE%E5%BA%8A/"/>
    
  </entry>
  
  <entry>
    <title>TestLink æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•</title>
    <link href="https://iamzhl.top/TestLink-integrate-with-ldap-and-CAS.html"/>
    <id>https://iamzhl.top/TestLink-integrate-with-ldap-and-CAS.html</id>
    <published>2018-12-04T06:55:56.000Z</published>
    <updated>2019-03-11T16:21:49.903Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:27 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><ul><li>TestLink ç‰ˆæœ¬ï¼š2.18</li><li>TestLink URLï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wL3Rlc3RsaW5r" title="http://devops.iamzhl.top/testlink">http://devops.iamzhl.top/testlink<i class="fa fa-external-link"></i></span></li><li>openLDAP æœåŠ¡ï¼šldap://devops.iamzhl.top:389</li><li>CAS æœåŠ¡ï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgwODAvY2Fz" title="http://devops.iamzhl.top:8080/cas">http://devops.iamzhl.top:8080/cas<i class="fa fa-external-link"></i></span></li></ul><h2 id="æ•´åˆ-LDAP"><a href="#æ•´åˆ-LDAP" class="headerlink" title="æ•´åˆ LDAP"></a>æ•´åˆ LDAP</h2><h3 id="ä¿®æ”¹TestLinké…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹TestLinké…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹TestLinké…ç½®æ–‡ä»¶"></a>ä¿®æ”¹<code>TestLink</code>é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/testlink/custom_config.inc.php</span></span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ <code>LDAP</code>é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$tlCfg-&gt;authentication[<span class="string">'method'</span>] = <span class="string">'LDAP'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>] = <span class="keyword">array</span>();</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_server'</span>] = <span class="string">'devops.iamzhl.top'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_port'</span>] = <span class="string">'389'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_version'</span>] = <span class="string">'3'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_root_dn'</span>] = <span class="string">'dc=iamzhl,dc=top'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_bind_dn'</span>] = <span class="string">'cn=Manager,dc=iamzhl,dc=top'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_bind_passwd'</span>] = <span class="string">'123456'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_tls'</span>] = <span class="keyword">false</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_organization'</span>] = <span class="string">''</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_uid_field'</span>] = <span class="string">'uid'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_email_field'</span>] = <span class="string">'mail'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_firstname_field'</span>] = <span class="string">'givenname'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap'</span>][<span class="number">1</span>][<span class="string">'ldap_surname_field'</span>] = <span class="string">'sn'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap_automatic_user_creation'</span>] = <span class="keyword">true</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap_email_field'</span>] = <span class="string">'mail'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap_firstname_field'</span>] = <span class="string">'givenname'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'ldap_surname_field'</span>] = <span class="string">'sn'</span>;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><blockquote><p>æ‰“å¼€<code>TestLink</code>ç½‘å€<code>http://devops.iamzhl.top/testlink</code></p></blockquote><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fxvp6j1abej328s1f8qb2.jpg" alt></p><p>å¦‚å›¾ï¼Œæ­£å¸¸è·³è½¬åˆ°<code>TestLink</code>ç™»å½•ç•Œé¢ï¼Œè¾“å…¥<code>LDAP</code>æœåŠ¡å™¨ä¸­çš„ç”¨æˆ·åå¯†ç åç‚¹å‡»<code>Log in</code></p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fxvuh6h46uj328s1f8k01.jpg" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œç™»é™†æˆåŠŸåæ­£å¸¸çš„è·å–åˆ°äº†ç”¨æˆ·åï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ç™»å‡ºæŒ‰é’®ï¼Œæ­£å¸¸é€€å‡ºåè·³è½¬åˆ°äº†<code>TestLink</code>çš„ç™»å½•ç•Œé¢</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fxvuj3kqkjj328s1f8gtv.jpg" alt></p><p>è‡³æ­¤ï¼Œ<code>TestLink</code>æ•´åˆ<code>LDAP</code>å®Œæˆã€‚</p><h2 id="æ•´åˆCASå•ç‚¹ç™»å½•"><a href="#æ•´åˆCASå•ç‚¹ç™»å½•" class="headerlink" title="æ•´åˆCASå•ç‚¹ç™»å½•"></a>æ•´åˆ<code>CAS</code>å•ç‚¹ç™»å½•</h2><h3 id="æ·»åŠ ä¾èµ–çš„phpCASåº“æ–‡ä»¶"><a href="#æ·»åŠ ä¾èµ–çš„phpCASåº“æ–‡ä»¶" class="headerlink" title="æ·»åŠ ä¾èµ–çš„phpCASåº“æ–‡ä»¶"></a>æ·»åŠ ä¾èµ–çš„<code>phpCAS</code>åº“æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://github.com/apereo/phpCAS/archive/1.3.6.tar.gz</span></span><br><span class="line"><span class="comment"># mv 1.3.6.tar.gz phpCAS-1.3.6.tar.gz</span></span><br><span class="line"><span class="comment"># tar zxvf phpCAS-1.3.6.tar.gz</span></span><br><span class="line"><span class="comment"># chown -R apache:apache phpCAS-1.3.6</span></span><br><span class="line"><span class="comment"># cp -arf phpCAS-1.3.6/source/CAS.php /var/www/html/testlink/lib/functions/</span></span><br><span class="line"><span class="comment"># cp -arf phpCAS-1.3.6/source/CAS /var/www/html/testlink/lib/functions/</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹TestLinké…ç½®æ–‡ä»¶-1"><a href="#ä¿®æ”¹TestLinké…ç½®æ–‡ä»¶-1" class="headerlink" title="ä¿®æ”¹TestLinké…ç½®æ–‡ä»¶"></a>ä¿®æ”¹<code>TestLink</code>é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/testlink/custom_config.inc.php</span></span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ <code>CAS</code>é…ç½®é¡¹</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** CAS server parameters */</span></span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_enable'</span>] = <span class="keyword">true</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_name'</span>] = <span class="string">'devops.iamzhl.top'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_port'</span>] = <span class="number">8080</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_path'</span>] = <span class="string">'cas'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_debug_enable'</span>] = <span class="keyword">true</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_debug_file'</span>] = <span class="string">'/var/logs/testlink/phpCAS.log'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_protocol'</span>] = <span class="string">'2.0'</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç™»å½•ç•Œé¢"><a href="#ä¿®æ”¹ç™»å½•ç•Œé¢" class="headerlink" title="ä¿®æ”¹ç™»å½•ç•Œé¢"></a>ä¿®æ”¹ç™»å½•ç•Œé¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/testlink/login.php</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨<code>switch($args-&gt;action)</code>åˆ†æ”¯é€‰æ‹©è¯­å¥æ®µå†…æ‰¾åˆ°<code>case &#39;loginform&#39;</code>éƒ¨åˆ†ï¼Œæ·»åŠ <code>CAS</code>çš„è®¤è¯</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>($args-&gt;action) </span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'doLogin'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'ajaxlogin'</span>:</span><br><span class="line">    doSessionStart(<span class="keyword">true</span>);</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// When doing ajax login we need to skip control regarding session already open</span></span><br><span class="line">    <span class="comment">// that we use when doing normal login.</span></span><br><span class="line">    <span class="comment">// If we do not proceed this way we will enter an infinite loop</span></span><br><span class="line">    $options = <span class="keyword">array</span>(<span class="string">'doSessionExistsCheck'</span> =&gt; ($args-&gt;action==<span class="string">'doLogin'</span>));</span><br><span class="line">    $op = doAuthorize($db,$args-&gt;login,$args-&gt;pwd,$options);</span><br><span class="line">    $doAuthPostProcess = <span class="keyword">true</span>;</span><br><span class="line">    $gui-&gt;draw = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'ajaxcheck'</span>:</span><br><span class="line">    processAjaxCheck($db);</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'oauth'</span>:</span><br><span class="line">    <span class="comment">//If code is empty then break</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">        renderLoginScreen($gui);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Switch between oauth providers</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">include_once</span>(<span class="string">'lib/functions/oauth_providers/'</span>.$_GET[<span class="string">'oauth'</span>].<span class="string">'.php'</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Oauth client doesn't exist"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $oau = config_get(<span class="string">'OAuthServers'</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($oau <span class="keyword">as</span> $oprov) &#123;</span><br><span class="line">      <span class="keyword">if</span> (strcmp($oprov[<span class="string">'oauth_name'</span>],$_GET[<span class="string">'oauth'</span>]) == <span class="number">0</span>)&#123;</span><br><span class="line">        $oauth_params = $oprov;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $user_token = oauth_get_token($oauth_params, $_GET[<span class="string">'code'</span>]);</span><br><span class="line">    <span class="keyword">if</span>($user_token-&gt;status[<span class="string">'status'</span>] == tl::OK) &#123;</span><br><span class="line">      doSessionStart(<span class="keyword">true</span>);</span><br><span class="line">      $op = doAuthorize($db,$user_token-&gt;options-&gt;user,<span class="string">'oauth'</span>,$user_token-&gt;options);</span><br><span class="line">      $doAuthPostProcess = <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $gui-&gt;note = $user_token-&gt;status[<span class="string">'msg'</span>];</span><br><span class="line">        renderLoginScreen($gui);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'loginform'</span>:</span><br><span class="line">  <span class="comment">//zhanghl start</span></span><br><span class="line">  <span class="keyword">if</span>($authCfg[<span class="string">'cas_enable'</span>])</span><br><span class="line">    &#123;    </span><br><span class="line">       <span class="keyword">if</span>($authCfg[<span class="string">'cas_debug_enable'</span>])</span><br><span class="line">       &#123;</span><br><span class="line">          phpCAS::setDebug($authCfg[<span class="string">'cas_debug_file'</span>]);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// Initialize phpCAS</span></span><br><span class="line">       phpCAS::client($authCfg[<span class="string">'cas_server_protocol'</span>], $authCfg[<span class="string">'cas_server_name'</span>], $authCfg[<span class="string">'cas_server_port'</span>], $authCfg[<span class="string">'cas_server_path'</span>]);</span><br><span class="line">       <span class="comment">// For production use set the CA certificate that is the issuer of the cert</span></span><br><span class="line">       <span class="comment">// on the CAS server and uncomment the line below</span></span><br><span class="line">       <span class="comment">// phpCAS::setCasServerCACert($cas_server_ca_cert_path);</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">// For quick testing you can disable SSL validation of the CAS server.</span></span><br><span class="line">       <span class="comment">// THIS SETTING IS NOT RECOMMENDED FOR PRODUCTION.</span></span><br><span class="line">       <span class="comment">// VALIDATING THE CAS SERVER IS CRUCIAL TO THE SECURITY OF THE CAS PROTOCOL!</span></span><br><span class="line">       phpCAS::setNoCasServerValidation();</span><br><span class="line">               </span><br><span class="line">       <span class="comment">// Override the validation url for any (ST and PT) CAS 2.0 validation</span></span><br><span class="line">       <span class="comment">//phpCAS::setServerProxyValidateURL('http://devops.iamzhl.top:8080/cas/proxyValidate');</span></span><br><span class="line">               </span><br><span class="line">       <span class="comment">// Override the validation url for any CAS 1.0 validation</span></span><br><span class="line">       <span class="comment">//phpCAS::setServerServiceValidateURL('http://devops.iamzhl.top:8080/cas/serviceValidate');</span></span><br><span class="line">              </span><br><span class="line">       phpCAS::handleLogoutRequests();</span><br><span class="line">       phpCAS::forceAuthentication();</span><br><span class="line">       $options = <span class="keyword">array</span>(<span class="string">'doSessionExistsCheck'</span> =&gt; ($args-&gt;action==<span class="string">'doLogin'</span>));</span><br><span class="line">       $op = doCASAuthorize($db,$options);</span><br><span class="line">       $doAuthPostProcess = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//zhanghl end</span></span><br><span class="line">    $doRenderLoginScreen = <span class="keyword">true</span>;</span><br><span class="line">    $gui-&gt;draw = <span class="keyword">true</span>;</span><br><span class="line">    $op = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// unfortunatelly we use $args-&gt;note in order to do some logic.</span></span><br><span class="line">    <span class="keyword">if</span>( ($args-&gt;note=trim($args-&gt;note)) == <span class="string">""</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>( $gui-&gt;authCfg[<span class="string">'SSO_enabled'</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        doSessionStart(<span class="keyword">true</span>);</span><br><span class="line">        $doAuthPostProcess = <span class="keyword">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> ($gui-&gt;authCfg[<span class="string">'SSO_method'</span>]) </span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">'CLIENT_CERTIFICATE'</span>:</span><br><span class="line">            $op = doSSOClientCertificate($db,$_SERVER,$gui-&gt;authCfg);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">case</span> <span class="string">'WEBSERVER_VAR'</span>:</span><br><span class="line">            <span class="comment">//DEBUGsyslogOnCloud('Trying to execute SSO using SAML');</span></span><br><span class="line">            $op = doSSOWebServerVar($db,$gui-&gt;authCfg);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//zhanghl start</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//zhanghl end</span></span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨<code>init_gui</code>å‡½æ•°å†…æ‰¾åˆ°<code>switch($args-&gt;note)</code>åˆ†æ”¯è¯­å¥ï¼Œåœ¨<code>expired</code>åˆ†æ”¯ä¸‹æ·»åŠ ä¸€è¡Œé‡å®šå‘è°ƒç”¨</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>($args-&gt;note) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'expired'</span>:</span><br><span class="line">      <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) &#123;</span><br><span class="line">        session_start();</span><br><span class="line">      &#125;</span><br><span class="line">      session_unset();</span><br><span class="line">      session_destroy();</span><br><span class="line">      $gui-&gt;note = lang_get(<span class="string">'session_expired'</span>);</span><br><span class="line">      $gui-&gt;reqURI = <span class="keyword">null</span>;</span><br><span class="line">      <span class="comment">// æ·»åŠ é‡å®šå‘è°ƒç”¨</span></span><br><span class="line">      redirect(TL_BASE_HREF .<span class="string">"login.php?destination="</span>.$args-&gt;destination);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'first'</span>:</span><br><span class="line">      $gui-&gt;note = lang_get(<span class="string">'your_first_login'</span>);</span><br><span class="line">      $gui-&gt;reqURI = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'lost'</span>:</span><br><span class="line">      $gui-&gt;note = lang_get(<span class="string">'passwd_lost'</span>);</span><br><span class="line">      $gui-&gt;reqURI = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      $gui-&gt;note = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç™»å‡ºç•Œé¢"><a href="#ä¿®æ”¹ç™»å‡ºç•Œé¢" class="headerlink" title="ä¿®æ”¹ç™»å‡ºç•Œé¢"></a>ä¿®æ”¹ç™»å‡ºç•Œé¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /var/www/html/testlink/logout.php</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨<code>$authCfg = config_get(&#39;authentication&#39;);</code>è¯­å¥ä¹‹åæ·»åŠ <code>CAS</code>çš„ç™»å‡ºå¤„ç†</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($authCfg[<span class="string">'cas_enable'</span>])</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">if</span>($authCfg[<span class="string">'cas_debug_enable'</span>])</span><br><span class="line">   &#123;</span><br><span class="line">      phpCAS::setDebug($authCfg[<span class="string">'cas_debug_file'</span>]);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// Initialize phpCAS</span></span><br><span class="line">   phpCAS::client($authCfg[<span class="string">'cas_server_protocol'</span>], $authCfg[<span class="string">'cas_server_name'</span>], $authCfg[<span class="string">'cas_server_port'</span>], $authCfg[<span class="string">'cas_server_path'</span>]);</span><br><span class="line">   phpCAS::logout();</span><br><span class="line">&#125;</span><br><span class="line">redirect(<span class="string">"login.php?note=logout"</span>);</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹common-phpå…¨å±€å¼•ç”¨æ–‡ä»¶"><a href="#ä¿®æ”¹common-phpå…¨å±€å¼•ç”¨æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹common.phpå…¨å±€å¼•ç”¨æ–‡ä»¶"></a>ä¿®æ”¹<code>common.php</code>å…¨å±€å¼•ç”¨æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/testlink/lib/functions/common.php</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨<code>require_once(&#39;tlsmarty.inc.php&#39;);</code>å¼•ç”¨çš„å‰é¢å¢åŠ å¯¹<code>CAS</code>çš„å¼•ç”¨</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** TestLink CAS Authentication Ref */</span></span><br><span class="line">$authCfg = config_get(<span class="string">'authentication'</span>);</span><br><span class="line"><span class="keyword">if</span>($authCfg[<span class="string">'cas_enable'</span>])</span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// Load the CAS lib</span></span><br><span class="line">   <span class="keyword">require_once</span> <span class="string">'CAS.php'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fxvnthnmyaj31p818kn8o.jpg" alt></p><h3 id="ä¿®æ”¹è®¤è¯å‡½æ•°"><a href="#ä¿®æ”¹è®¤è¯å‡½æ•°" class="headerlink" title="ä¿®æ”¹è®¤è¯å‡½æ•°"></a>ä¿®æ”¹è®¤è¯å‡½æ•°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/testlink/lib/functions/doAuthorize.php</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨å¼€å¤´<code>require_once</code>è¯­å¥çš„åé¢æ·»åŠ <code>CAS</code>è®¤è¯å‡½æ•°</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// zhanghl start</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doCASAuthorize</span><span class="params">(&amp;$db,$options=null)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">global</span> $g_tlLogger;</span><br><span class="line">   $result = <span class="keyword">array</span>(<span class="string">'status'</span> =&gt; tl::ERROR, <span class="string">'msg'</span> =&gt; <span class="keyword">null</span>);</span><br><span class="line">   $user = <span class="keyword">new</span> tlUser();</span><br><span class="line">   $user-&gt;login = $_SESSION[<span class="string">'phpCAS'</span>][<span class="string">'user'</span>];</span><br><span class="line">   $login_exists = ($user-&gt;readFromDB($db,tlUser::USER_O_SEARCH_BYLOGIN) &gt;= tl::OK);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(!$login_exists)</span><br><span class="line">   &#123;</span><br><span class="line">      $user = <span class="keyword">new</span> tlUser();</span><br><span class="line">      $user-&gt;login = $_SESSION[<span class="string">'phpCAS'</span>][<span class="string">'user'</span>];</span><br><span class="line">      $user-&gt;isActive = <span class="keyword">true</span>;</span><br><span class="line">      $user-&gt;authentication = <span class="string">'LDAP'</span>;  <span class="comment">// force for auth_does_password_match</span></span><br><span class="line">      $user-&gt;setPassword($user-&gt;login);  <span class="comment">// write password on DB anyway</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//$user-&gt;emailAddress = $_SESSION['phpCAS']['attributes']['mail'];</span></span><br><span class="line">   <span class="comment">//$user-&gt;firstName = $_SESSION['phpCAS']['attributes']['sn'];</span></span><br><span class="line">   <span class="comment">//$user-&gt;lastName = $_SESSION['phpCAS']['attributes']['givenName'];</span></span><br><span class="line">   $doLogin = ($user-&gt;writeToDB($db) == tl::OK);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>( $doLogin )</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="comment">// Need to do set COOKIE following Mantis model</span></span><br><span class="line">      $auth_cookie_name = config_get(<span class="string">'auth_cookie'</span>);</span><br><span class="line">      $expireOnBrowserClose=<span class="keyword">false</span>;</span><br><span class="line">      setcookie($auth_cookie_name,$user-&gt;getSecurityCookie(),$expireOnBrowserClose,<span class="string">'/'</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Disallow two sessions within one browser</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'currentUser'</span>]) &amp;&amp; !is_null($_SESSION[<span class="string">'currentUser'</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">         $result[<span class="string">'msg'</span>] = lang_get(<span class="string">'login_msg_session_exists1'</span>) .</span><br><span class="line">            <span class="string">' &lt;a style="color:white;" href="logout.php"&gt;'</span> .</span><br><span class="line">            lang_get(<span class="string">'logout_link'</span>) . <span class="string">'&lt;/a&gt;'</span> . lang_get(<span class="string">'login_msg_session_exists2'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="comment">// Setting user's session information</span></span><br><span class="line">         $_SESSION[<span class="string">'currentUser'</span>] = $user;</span><br><span class="line">         $_SESSION[<span class="string">'lastActivity'</span>] = time();</span><br><span class="line"></span><br><span class="line">         $g_tlLogger-&gt;endTransaction();</span><br><span class="line">         $g_tlLogger-&gt;startTransaction();</span><br><span class="line">         setUserSession($db,$user-&gt;login, $user-&gt;dbID,$user-&gt;globalRoleID,$user-&gt;emailAddress,$user-&gt;locale,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">         $result[<span class="string">'status'</span>] = tl::OK;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// zhanghl end</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å…¨å±€é…ç½®æ–‡ä»¶-å¯é€‰"><a href="#ä¿®æ”¹å…¨å±€é…ç½®æ–‡ä»¶-å¯é€‰" class="headerlink" title="ä¿®æ”¹å…¨å±€é…ç½®æ–‡ä»¶ (å¯é€‰)"></a>ä¿®æ”¹å…¨å±€é…ç½®æ–‡ä»¶ (å¯é€‰)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/testlink/config.inc.php</span></span><br></pre></td></tr></table></figure><blockquote><p>å¢åŠ <code>CAS</code>è®¤è¯å±æ€§</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** CAS server properties */</span></span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_enable'</span>] = <span class="keyword">false</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_name'</span>] = <span class="string">''</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_port'</span>] = <span class="number">8080</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_path'</span>] = <span class="string">'cas'</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_debug_enable'</span>] = <span class="keyword">true</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_debug_file'</span>] = <span class="string">''</span>;</span><br><span class="line">$tlCfg-&gt;authentication[<span class="string">'cas_server_protocol'</span>] = <span class="string">''</span>;</span><br></pre></td></tr></table></figure><p><strong><em>Noteï¼šæ­¤é€‰é¡¹ç”¨ä»¥è®¾ç½®é»˜è®¤å±æ€§å€¼ï¼Œä¸»è¦ç”¨æ¥æ—¥åæŸ¥é˜…ï¼Œå¯ä»¥ä¸å†™ï¼Œ<code>/var/www/html/testlink/custom_config.inc.php</code>æ–‡ä»¶ç›¸åŒçš„å±æ€§é…ç½®ä¼šè¦†ç›–ç”Ÿæ•ˆã€‚</em></strong></p><h3 id="ä¿®æ”¹CASçš„Client-phpå¯ç”¨httpè¿æ¥-æ ¹æ®ä¸ªäººCASæœåŠ¡å™¨æ¥å®š"><a href="#ä¿®æ”¹CASçš„Client-phpå¯ç”¨httpè¿æ¥-æ ¹æ®ä¸ªäººCASæœåŠ¡å™¨æ¥å®š" class="headerlink" title="ä¿®æ”¹CASçš„Client.phpå¯ç”¨httpè¿æ¥(æ ¹æ®ä¸ªäººCASæœåŠ¡å™¨æ¥å®š)"></a>ä¿®æ”¹<code>CAS</code>çš„<code>Client.php</code>å¯ç”¨<code>http</code>è¿æ¥(æ ¹æ®ä¸ªäºº<code>CAS</code>æœåŠ¡å™¨æ¥å®š)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/testlink/lib/functions/CAS/Client.php</span></span><br></pre></td></tr></table></figure><blockquote><p>å°†å¦‚ä¸‹å‡ ä¸ªå‡½æ•°ä¸­çš„<code>https</code>æ”¹ä¸º<code>http</code>å³å¯</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_getServerBaseURL</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// the URL is build only when needed</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>]) ) &#123;</span><br><span class="line">        <span class="comment">// $this-&gt;_server['base_url'] = 'https://' . $this-&gt;_getServerHostname();</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>] = <span class="string">'http://'</span> . <span class="keyword">$this</span>-&gt;_getServerHostname();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;_getServerPort()!=<span class="number">443</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>] .= <span class="string">':'</span></span><br><span class="line">                .<span class="keyword">$this</span>-&gt;_getServerPort();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>] .= <span class="keyword">$this</span>-&gt;_getServerURI();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_getCallbackURL</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// the URL is built when needed only</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;_callback_url) ) &#123;</span><br><span class="line">        $final_uri = <span class="string">''</span>;</span><br><span class="line">        <span class="comment">// remove the ticket if present in the URL</span></span><br><span class="line">        <span class="comment">// $final_uri = 'https://';</span></span><br><span class="line">        $final_uri = <span class="string">'http://'</span>;</span><br><span class="line">        $final_uri .= <span class="keyword">$this</span>-&gt;_getClientUrl();</span><br><span class="line">        $request_uri = $_SERVER[<span class="string">'REQUEST_URI'</span>];</span><br><span class="line">        $request_uri = preg_replace(<span class="string">'/\?.*$/'</span>, <span class="string">''</span>, $request_uri);</span><br><span class="line">        $final_uri .= $request_uri;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_callback_url = $final_uri;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_callback_url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getURL</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    phpCAS::traceBegin();</span><br><span class="line">    <span class="comment">// the URL is built when needed only</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;_url) ) &#123;</span><br><span class="line">        $final_uri = <span class="string">''</span>;</span><br><span class="line">        <span class="comment">// remove the ticket if present in the URL</span></span><br><span class="line">        <span class="comment">// $final_uri = ($this-&gt;_isHttps()) ? 'https' : 'http';</span></span><br><span class="line">        $final_uri = (<span class="keyword">$this</span>-&gt;_isHttps()) ? <span class="string">'http'</span> : <span class="string">'http'</span>;</span><br><span class="line">        $final_uri .= <span class="string">'://'</span>;</span><br><span class="line"></span><br><span class="line">        $final_uri .= <span class="keyword">$this</span>-&gt;_getClientUrl();</span><br><span class="line">        $request_uri= explode(<span class="string">'?'</span>, $_SERVER[<span class="string">'REQUEST_URI'</span>], <span class="number">2</span>);</span><br><span class="line">        $final_uri.= $request_uri[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($request_uri[<span class="number">1</span>]) &amp;&amp; $request_uri[<span class="number">1</span>]) &#123;</span><br><span class="line">            $query_string= <span class="keyword">$this</span>-&gt;_removeParameterFromQueryString(<span class="string">'ticket'</span>, $request_uri[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If the query string still has anything left,</span></span><br><span class="line">            <span class="comment">// append it to the final URI</span></span><br><span class="line">            <span class="keyword">if</span> ($query_string !== <span class="string">''</span>) &#123;</span><br><span class="line">                $final_uri.= <span class="string">"?$query_string"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        phpCAS::trace(<span class="string">"Final URI: $final_uri"</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;setURL($final_uri);</span><br><span class="line">    &#125;</span><br><span class="line">    phpCAS::traceEnd(<span class="keyword">$this</span>-&gt;_url);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><blockquote><p>æ–°å»º<code>debug</code>è°ƒè¯•ç›®å½•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /var/log/testlink</span></span><br><span class="line"><span class="comment"># chown -R apache:apache /var/log/testlink</span></span><br></pre></td></tr></table></figure><blockquote><p>æ‰“å¼€<code>TestLink</code>ç½‘å€<code>http://devops.iamzhl.top/testlink</code></p></blockquote><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fxvougi1woj32221fcdv4.jpg" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæ­£å¸¸è·³è½¬åˆ°<code>CAS</code>çš„ç™»å½•ç•Œé¢ï¼Œåœ°å€å˜æˆäº†<code>http://devops.iamzhl.top:8080/cas/login?service=http%3A%2F%2Fdevops.iamzhl.top%2Ftestlink%2Flogin.php</code>ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç åç‚¹å‡»ç™»å½•</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fxvuh6h46uj328s1f8k01.jpg" alt></p><p>å¦‚å›¾ç™»é™†æˆåŠŸåæ­£å¸¸è·å–ç”¨æˆ·åï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„ç™»å‡ºæŒ‰é’®åï¼Œæ­£å¸¸é€€å‡ºåˆ°<code>CAS</code>ç™»å‡ºé¡µé¢</p><p><img src="/Users/canvas/Library/Application Support/typora-user-images/image-20181205173735167.png" alt="image-20181205173735167"></p><p>è‡³æ­¤ï¼Œ<code>TestLink</code>æ•´åˆ<code>CAS</code>å•ç‚¹ç™»å½•å®Œæˆã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      TestLink æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="CAS" scheme="https://iamzhl.top/tags/CAS/"/>
    
      <category term="LDAP" scheme="https://iamzhl.top/tags/LDAP/"/>
    
      <category term="TestLink" scheme="https://iamzhl.top/tags/TestLink/"/>
    
  </entry>
  
  <entry>
    <title>MantisBT æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•</title>
    <link href="https://iamzhl.top/MantisBT-integrate-with-ldap-and-CAS.html"/>
    <id>https://iamzhl.top/MantisBT-integrate-with-ldap-and-CAS.html</id>
    <published>2018-12-03T07:07:11.000Z</published>
    <updated>2019-03-11T16:21:49.897Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:27 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><ul><li>MantisBT ç‰ˆæœ¬ï¼š2.18</li><li>Mantis URLï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wL21hbnRpcw==" title="http://devops.iamzhl.top/mantis">http://devops.iamzhl.top/mantis<i class="fa fa-external-link"></i></span></li><li>openLDAP æœåŠ¡ï¼šldap://devops.iamzhl.top:389</li><li>CAS æœåŠ¡ï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgwODAvY2Fz" title="http://devops.iamzhl.top:8080/cas">http://devops.iamzhl.top:8080/cas<i class="fa fa-external-link"></i></span></li></ul><h2 id="æ•´åˆ-LDAP"><a href="#æ•´åˆ-LDAP" class="headerlink" title="æ•´åˆ LDAP"></a>æ•´åˆ LDAP</h2><h3 id="ä¿®æ”¹MantisBTé…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹MantisBTé…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹MantisBTé…ç½®æ–‡ä»¶"></a>ä¿®æ”¹<code>MantisBT</code>é…ç½®æ–‡ä»¶</h3><blockquote><p>æ·»åŠ ä»¥ä¸‹é…ç½®é¡¹</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MantisBT Authentication and LDAP Settings #</span></span><br><span class="line">$g_login_method = LDAP;</span><br><span class="line">$g_reauthentication = ON;</span><br><span class="line">$g_reauthentication_expiry = TOKEN_EXPIRY_AUTHENTICATED;</span><br><span class="line">$g_ldap_server = <span class="string">'ldap://devops.iamzhl.top:389'</span>;</span><br><span class="line">$g_ldap_root_dn = <span class="string">'ou=People,dc=iamzhl,dc=top'</span>;</span><br><span class="line">$g_ldap_protocol_version = <span class="number">3</span>;</span><br><span class="line">$g_ldap_organization = <span class="string">''</span>;</span><br><span class="line">$g_ldap_bind_dn = <span class="string">'cn=Manager,dc=iamzhl,dc=top'</span>;</span><br><span class="line">$g_ldap_bind_passwd = <span class="string">'123456'</span>;</span><br><span class="line">$g_ldap_uid_field = <span class="string">'uid'</span>;</span><br><span class="line">$g_ldap_realname_field = <span class="string">'cn'</span>;</span><br><span class="line">$g_use_ldap_realname = ON;</span><br><span class="line">$g_use_ldap_email = ON;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>MantisBT</code>ç½‘å€ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ç‚¹å‡»ç™»å½•</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/dd/a754582a7218fd2860d31fb543c667.jpg" alt></p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/07/158dfd797dce0fa01335dd8d9b5085.jpg" alt></p><p>ç™»é™†æˆåŠŸåï¼Œæ­£å¸¸è·å–ç”¨æˆ·å</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/5d/e2fd0f937861208615ce61fae90423.jpg" alt></p><p>ç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·å -&gt; æ³¨é”€ï¼Œä¼šæ­£å¸¸é€€å‡ºå¹¶è·³è½¬åˆ°ç™»å½•ç•Œé¢</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/5e/e198803ba7693b67b5e6c5fc075ab5.jpg" alt></p><p>è‡³æ­¤ï¼Œ<code>MantisBT</code>æ•´åˆ<code>LDAP</code>å®Œæˆã€‚</p><h2 id="æ•´åˆ-CAS-å•ç‚¹ç™»å½•"><a href="#æ•´åˆ-CAS-å•ç‚¹ç™»å½•" class="headerlink" title="æ•´åˆ CAS å•ç‚¹ç™»å½•"></a>æ•´åˆ CAS å•ç‚¹ç™»å½•</h2><h3 id="ä¸‹è½½phpCASæ”¾åˆ°MantisBTä¸‹"><a href="#ä¸‹è½½phpCASæ”¾åˆ°MantisBTä¸‹" class="headerlink" title="ä¸‹è½½phpCASæ”¾åˆ°MantisBTä¸‹"></a>ä¸‹è½½<code>phpCAS</code>æ”¾åˆ°<code>MantisBT</code>ä¸‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://github.com/apereo/phpCAS/archive/1.3.6.tar.gz</span></span><br><span class="line"><span class="comment"># mv 1.3.6.tar.gz phpCAS-1.3.6.tar.gz</span></span><br><span class="line"><span class="comment"># tar zxvf phpCAS-1.3.6.tar.gz</span></span><br><span class="line"><span class="comment"># chown -R apache:apache phpCAS-1.3.6</span></span><br><span class="line"><span class="comment"># cp -arf phpCAS-1.3.6 /var/www/html/mantis/phpCAS</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹MantisBTé…ç½®æ–‡ä»¶-1"><a href="#ä¿®æ”¹MantisBTé…ç½®æ–‡ä»¶-1" class="headerlink" title="ä¿®æ”¹MantisBTé…ç½®æ–‡ä»¶"></a>ä¿®æ”¹<code>MantisBT</code>é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/mantis/config/config_inc.php</span></span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ <code>CAS</code>è®¤è¯éœ€è¦çš„å˜é‡(è¯·æŒ‰ç…§è‡ªå·±çš„<code>LDAP</code>æœåŠ¡å™¨è¿›è¡Œä¿®æ”¹)</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MantisBT Authentication With CAS Settings #</span></span><br><span class="line">$g_login_method = CAS;</span><br><span class="line">$g_cas_server = <span class="string">'devops.iamzhl.top'</span>;</span><br><span class="line">$g_cas_port = <span class="number">8080</span>;</span><br><span class="line">$g_cas_uri = <span class="string">'/cas'</span>;</span><br><span class="line">$g_cas_validate = <span class="string">''</span>;</span><br><span class="line">$g_cas_version = <span class="string">'2.0'</span>;</span><br><span class="line">$g_cas_debug = <span class="string">'/var/www/html/mantis/cas.log'</span>;</span><br><span class="line">$g_cas_saml_attributes = OFF;</span><br><span class="line">$g_cas_saml_map = <span class="keyword">array</span>( <span class="string">'name'</span> =&gt; <span class="string">''</span>, <span class="string">'mail'</span> =&gt; <span class="string">''</span> );</span><br><span class="line">$g_cas_use_ldap = ON;</span><br><span class="line">$g_ldap_mantis_uid  = <span class="string">'uid'</span>;</span><br><span class="line">$g_cas_ldap_update  = OFF;</span><br><span class="line">$g_cas_ldap_update_fields = <span class="string">''</span>;</span><br><span class="line">$g_cas_ldap_update_map    = <span class="string">''</span>;</span><br><span class="line">$g_ldap_language_field = <span class="string">''</span>;</span><br><span class="line">$g_ldap_language_keys = <span class="string">''</span>;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç™»å½•é¡µé¢"><a href="#ä¿®æ”¹ç™»å½•é¡µé¢" class="headerlink" title="ä¿®æ”¹ç™»å½•é¡µé¢"></a>ä¿®æ”¹ç™»å½•é¡µé¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/mantis/login_page.php</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨æ–‡ä»¶å¼€å¤´çš„ require_once éƒ¨åˆ†å¢åŠ å¯¹ phpCAS çš„å¼•å…¥</span></span><br><span class="line"><span class="keyword">require_once</span>( <span class="string">'/var/www/html/mantis/phpCAS/login_cas.php'</span> );</span><br><span class="line"><span class="comment">// åœ¨ $f_username å˜é‡çš„å®šä¹‰ä¹‹å‰æ·»åŠ åˆ¤æ–­è¯­å¥ï¼Œå½“æ£€æµ‹åˆ°ç”¨æˆ·å·²ç»è®¤è¯æ—¶ï¼Œè·³è½¬åˆ°ä¸»é¡µ</span></span><br><span class="line"><span class="keyword">if</span>( auth_is_user_authenticated() &amp;&amp; !current_user_is_anonymous() ) &#123;</span><br><span class="line">print_header_redirect( config_get( <span class="string">'default_home_page'</span> ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/mantis/login.php</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨åˆ¤æ–­å˜é‡ f_install çš„åˆ¤æ–­è¯­å¥ä¹‹åæ·»åŠ ä¸‹é¢çš„åˆ¤æ–­è¯­å¥æ¥åˆ¤æ–­éªŒè¯æ–¹å¼ï¼Œè‹¥ä¸º CAS ï¼Œåˆ™åˆ©ç”¨ auth_cas_get_name å‡½æ•°æ¥å¤„ç†</span></span><br><span class="line"><span class="keyword">if</span> ( CAS == config_get( <span class="string">'login_method'</span> ) ) &#123;</span><br><span class="line"><span class="comment"># This will detour to the CAS login page if needed</span></span><br><span class="line">$f_password = <span class="string">''</span>;</span><br><span class="line">$f_username = auth_cas_get_name();</span><br><span class="line"><span class="comment"># User is always authenticated by this point</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/mantis/login_password_page.php</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ $f_username å˜é‡çš„å®šä¹‰ä¹‹å‰æ·»åŠ åˆ¤æ–­è¯­å¥ï¼Œå½“æ£€æµ‹åˆ°ç”¨æˆ·å·²ç»è®¤è¯æ—¶ï¼Œè·³è½¬åˆ°ä¸»é¡µ</span></span><br><span class="line"><span class="keyword">if</span>( auth_is_user_authenticated() &amp;&amp; !current_user_is_anonymous() ) &#123;</span><br><span class="line">print_header_redirect( config_get( <span class="string">'default_home_page'</span> ) );</span><br><span class="line">&#125;</span><br><span class="line">$f_username              = gpc_get_string( <span class="string">'username'</span>, <span class="string">''</span> );</span><br><span class="line"><span class="comment"># zhanghl start</span></span><br><span class="line"><span class="keyword">if</span>( $f_username == <span class="string">''</span> ) &#123;</span><br><span class="line">        $f_username = $staffid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># zhanghl end</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹ç™»å‡ºé¡µé¢"><a href="#ä¿®æ”¹ç™»å‡ºé¡µé¢" class="headerlink" title="ä¿®æ”¹ç™»å‡ºé¡µé¢"></a>ä¿®æ”¹ç™»å‡ºé¡µé¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/mantis/logout_page.php</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨æ–‡ä»¶å¼€å¤´çš„ require_once éƒ¨åˆ†å¢åŠ å¯¹ phpCAS çš„å¼•å…¥</span></span><br><span class="line"><span class="keyword">require_once</span>( <span class="string">'/var/www/html/mantis/phpCAS/login_cas.php'</span> );</span><br><span class="line"><span class="comment"># Cache the current logout redirect page as it will be cleared by auth_logout()</span></span><br><span class="line"><span class="comment">//$t_logout_redirect = auth_logout_redirect_page();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//auth_logout();</span></span><br><span class="line">phpCAS::setDebug();</span><br><span class="line">phpCAS::setVerbose(<span class="keyword">true</span>);</span><br><span class="line">phpCAS::handleLogoutRequests();</span><br><span class="line">phpCAS::logout();</span><br><span class="line"></span><br><span class="line"><span class="comment">//print_header_redirect( $t_logout_redirect, true, false );</span></span><br><span class="line">print_header_redirect( config_get( <span class="string">'logout_redirect_page'</span> ), <span class="keyword">true</span>, <span class="keyword">false</span> );</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹éªŒè¯é€»è¾‘"><a href="#ä¿®æ”¹éªŒè¯é€»è¾‘" class="headerlink" title="ä¿®æ”¹éªŒè¯é€»è¾‘"></a>ä¿®æ”¹éªŒè¯é€»è¾‘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/mantis/core/authentication_api.php</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å˜é‡ g_cache_current_user_id çš„å®šä¹‰åé¢æ·»åŠ ä»¥ä¸‹å‡½æ•°ï¼Œå®šä¹‰ CAS çš„ç™»å½•é€»è¾‘</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Initialize phpCAS.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_cas_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment"># phpCAS must be installed in the include path</span></span><br><span class="line">       <span class="comment"># or in the Mantis directory.</span></span><br><span class="line">       <span class="keyword">require_once</span>(<span class="string">'/var/www/html/mantis/phpCAS/CAS.php'</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">static</span> $s_initialized=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (! $s_initialized ) &#123;</span><br><span class="line">               phpCAS::setDebug( config_get( <span class="string">'cas_debug'</span> ) );</span><br><span class="line">              <span class="comment">## These should be set in config_inc.php</span></span><br><span class="line">               $t_server_version = config_get( <span class="string">'cas_version'</span> );</span><br><span class="line">               $t_server_cas_server = config_get( <span class="string">'cas_server'</span> );</span><br><span class="line">               $t_server_port = config_get( <span class="string">'cas_port'</span> );</span><br><span class="line">               $t_server_uri = config_get( <span class="string">'cas_uri'</span> );</span><br><span class="line">               $t_start_session = (boolean)<span class="keyword">FALSE</span>; <span class="comment"># Mantis takes care of its own session</span></span><br><span class="line"></span><br><span class="line">               phpCAS::client($t_server_version, $t_server_cas_server, $t_server_port, $t_server_uri, $t_start_session);</span><br><span class="line">               <span class="keyword">if</span> ($t_server_version == <span class="string">"S1"</span>)</span><br><span class="line">                       phpCAS::setServerSamlValidateURL( config_get( <span class="string">'cas_validate'</span> ) );</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                       phpCAS::setServerProxyValidateURL( config_get( <span class="string">'cas_validate'</span> ) );</span><br><span class="line">               <span class="keyword">if</span> (method_exists(<span class="string">'phpCAS'</span>, <span class="string">'setNoCasServerValidation'</span>)) &#123;</span><br><span class="line">                       <span class="comment">// no SSL validation for the CAS server</span></span><br><span class="line">                       phpCAS::setNoCasServerValidation();</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               $s_initialized = <span class="keyword">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Fetches the user's CAS name, authenticating if needed.</span></span><br><span class="line"><span class="comment">* Can translate CAS login name to Mantis username through LDAP.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_cas_get_name</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       <span class="comment"># Get CAS username from phpCAS</span></span><br><span class="line">       auth_cas_init();</span><br><span class="line">       phpCAS::forceAuthentication();</span><br><span class="line">       $t_cas_id = phpCAS::getUser();</span><br><span class="line">       $t_cas_attribs = phpCAS::getAttributes();</span><br><span class="line"></span><br><span class="line">       <span class="comment"># If needed, translate the CAS username through LDAP</span></span><br><span class="line">       $t_username = $t_cas_id;</span><br><span class="line">       <span class="keyword">if</span> (config_get( <span class="string">'cas_use_ldap'</span>, <span class="keyword">false</span> )) &#123;</span><br><span class="line">               $t_username = auth_cas_ldap_translate( $t_cas_id );</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">elseif</span> (config_get( <span class="string">'cas_saml_attributes'</span>, <span class="keyword">false</span> )) &#123;</span><br><span class="line">               $t_cas_attribmap = config_get( <span class="string">'cas_saml_map'</span>, <span class="keyword">array</span>() );</span><br><span class="line">               $t_cas_attrib_name = $t_cas_attribs[$t_cas_attribmap[<span class="string">'name'</span>]];</span><br><span class="line">               $t_cas_attrib_mail = $t_cas_attribs[$t_cas_attribmap[<span class="string">'mail'</span>]];</span><br><span class="line">               <span class="keyword">if</span> ( user_get_id_by_name($t_cas_id) == <span class="keyword">false</span> ) &#123;</span><br><span class="line">                       user_create( $t_cas_id, <span class="string">''</span>, $t_cas_attrib_mail, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, $t_cas_attrib_name );</span><br><span class="line">       &#125;</span><br><span class="line">       &#125;</span><br><span class="line">                               </span><br><span class="line">       <span class="keyword">return</span> $t_username;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Takes an ID string, and looks up the LDAP directory to find</span></span><br><span class="line"><span class="comment">* the matching username for Mantis.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* Optionally, also update the user information in the Mantis user</span></span><br><span class="line"><span class="comment">* table.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $p_cas_id string Typically, the username given by phpCAS.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> $p_update_user bool Whether or not to update user details from LDAP.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_cas_ldap_translate</span><span class="params">( $p_cas_id, $p_update_user=<span class="string">''</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment"># Please make sure the Mantis CAS and LDAP settings are set in config_inc.php</span></span><br><span class="line"></span><br><span class="line">       $t_ldap_organization    = config_get( <span class="string">'ldap_organization'</span> );</span><br><span class="line">       $t_ldap_root_dn         = config_get( <span class="string">'ldap_root_dn'</span> );</span><br><span class="line"></span><br><span class="line">       <span class="comment"># Required fields in LDAP for CAS</span></span><br><span class="line">       $t_ldap_language_field = config_get( <span class="string">'ldap_language_field'</span>, <span class="string">''</span> );</span><br><span class="line">       $t_ldap_uid_field = config_get( <span class="string">'ldap_uid_field'</span>, <span class="string">'uid'</span> ) ;</span><br><span class="line">       $t_ldap_mantis_uid = config_get( <span class="string">'ldap_mantis_uid'</span>, <span class="string">'uid'</span> );</span><br><span class="line">       $t_ldap_required = <span class="keyword">array</span>( $t_ldap_uid_field, $t_ldap_mantis_uid, <span class="string">'dn'</span> );</span><br><span class="line">       <span class="keyword">if</span> ($t_ldap_language_field) &#123;</span><br><span class="line">               <span class="comment">// Add language field to attributes list only if it is configured.</span></span><br><span class="line">               $t_ldap_required[] = $t_ldap_language_field;</span><br><span class="line">       &#125;</span><br><span class="line">       $t_ldap_required = array_combine( $t_ldap_required, $t_ldap_required );</span><br><span class="line"></span><br><span class="line">       <span class="comment"># User-defined fields to fetch from LDAP...</span></span><br><span class="line">       $t_ldap_fields = explode( <span class="string">','</span>, config_get( <span class="string">'cas_ldap_update_fields'</span> ) );</span><br><span class="line">       $t_ldap_fields = array_combine( $t_ldap_fields, $t_ldap_fields );</span><br><span class="line">       <span class="comment"># ...which are mapped to Mantis user fields</span></span><br><span class="line">       $t_ldap_map = explode( <span class="string">','</span>, config_get( <span class="string">'cas_ldap_update_map'</span> ) );</span><br><span class="line">       $t_ldap_map = array_combine( $t_ldap_map, $t_ldap_map );</span><br><span class="line"></span><br><span class="line">       <span class="comment"># Build LDAP search filter, attribute list from CAS ID</span></span><br><span class="line">       $t_search_filter = <span class="string">"(&amp;$t_ldap_organization($t_ldap_uid_field=$p_cas_id))"</span>;</span><br><span class="line">       $t_search_attrs = array_values($t_ldap_required + $t_ldap_fields);      <span class="comment"># array union</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># Use Mantis ldap_api to connect to LDAP</span></span><br><span class="line">       $t_ds = ldap_connect_bind();</span><br><span class="line">       $t_sr   = ldap_search( $t_ds, $t_ldap_root_dn, $t_search_filter, $t_search_attrs );</span><br><span class="line">       $t_info = ldap_get_entries( $t_ds, $t_sr );</span><br><span class="line">       <span class="comment"># Parse the LDAP entry to find the Mantis username</span></span><br><span class="line">       <span class="keyword">if</span> ( $t_info ) &#123;</span><br><span class="line">               <span class="comment"># Get Mantis username</span></span><br><span class="line">               $t_username = $t_info[<span class="number">0</span>][$t_ldap_mantis_uid][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">               <span class="comment"># @@@ The fact that we got here means the user is authenticated</span></span><br><span class="line">               <span class="comment"># @@@ by CAS, and has an LDAP entry.</span></span><br><span class="line">               <span class="comment"># @@@ We might as well update other user details since we are here.</span></span><br><span class="line"></span><br><span class="line">               <span class="comment"># If no argument given, check settings</span></span><br><span class="line">               <span class="keyword">if</span> ( <span class="string">''</span> == $p_update_user ) &#123;</span><br><span class="line">                       $p_update_user = config_get( <span class="string">'cas_ldap_update'</span>, <span class="keyword">FALSE</span> );</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment"># If there's a user record, then update it</span></span><br><span class="line">               <span class="keyword">if</span> ( $p_update_user ) &#123;</span><br><span class="line">                       <span class="comment"># Only proceed if the field map arrays are the same length</span></span><br><span class="line">                       $t_field_map = array_combine( $t_ldap_fields, $t_ldap_map );</span><br><span class="line">                       <span class="keyword">if</span> ($t_field_map) &#123;</span><br><span class="line">                               <span class="comment"># If user is new, then we must create their account before updating it</span></span><br><span class="line">                               <span class="comment"># @@@ ( make sure $g_allow_blank_email == ON )</span></span><br><span class="line">                               $t_userid = user_get_id_by_name($t_username);</span><br><span class="line">                               <span class="keyword">if</span> ( <span class="keyword">false</span> == $t_userid ) &#123;</span><br><span class="line">                                       user_create( $t_username, <span class="string">''</span> );</span><br><span class="line">                                       <span class="comment"># @@@ Wow, this is pretty lame</span></span><br><span class="line">                                       $t_userid = user_get_id_by_name($t_username);</span><br><span class="line">                               &#125;</span><br><span class="line">                               <span class="comment"># @@@ maybe we can optimize this to write all fields at once?</span></span><br><span class="line">                             <span class="keyword">foreach</span> ( $t_field_map <span class="keyword">as</span> $key=&gt;$t_userfield ) &#123;</span><br><span class="line">                                     <span class="keyword">if</span> (<span class="keyword">isset</span>($t_info[<span class="number">0</span>][$key][<span class="number">0</span>])) &#123;</span><br><span class="line">                                             user_set_field( $t_userid, $t_userfield, $t_info[<span class="number">0</span>][$key][<span class="number">0</span>] );</span><br><span class="line">                                     &#125;</span><br><span class="line">                             &#125;</span><br><span class="line">                       &#125;</span><br><span class="line"></span><br><span class="line">                       <span class="comment">// Update user's overall language preference</span></span><br><span class="line">                       <span class="keyword">if</span> ($t_ldap_language_field) &#123;</span><br><span class="line">                               $t_language = $t_info[<span class="number">0</span>][$t_ldap_language_field][<span class="number">0</span>];</span><br><span class="line">                               <span class="comment">// Map the LDAP language field to Mantis' language field if needed</span></span><br><span class="line">                               $t_language_keys = config_get( <span class="string">'ldap_language_keys'</span>, <span class="string">''</span>);</span><br><span class="line">                               $t_language_values = config_get( <span class="string">'ldap_language_values'</span>, <span class="string">''</span>);</span><br><span class="line">                               $t_language_map = array_combine(</span><br><span class="line">                                       explode(<span class="string">','</span>, $t_language_keys),</span><br><span class="line">                                       explode(<span class="string">','</span>, $t_language_values)</span><br><span class="line">                               );</span><br><span class="line">                               <span class="keyword">if</span> (<span class="keyword">isset</span>($t_language_map[$t_language])) &#123;</span><br><span class="line">                                       $t_language = $t_language_map[$t_language];</span><br><span class="line">                               &#125;</span><br><span class="line">                               user_pref_set_pref($t_userid, <span class="string">'language'</span>, $t_language);</span><br><span class="line">                       &#125;</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       ldap_free_result( $t_sr );</span><br><span class="line">       ldap_unbind( $t_ds );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> $t_username;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Logs out of CAS, redirecting to Mantis on re-login.</span></span><br><span class="line"><span class="comment">* User should already be logged out of Mantis by the time this is called.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@see</span> auth_logout()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_cas_logout</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       $t_path = config_get(<span class="string">'path'</span>);</span><br><span class="line">       auth_cas_init();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (method_Exists(<span class="string">'phpCAS'</span>, <span class="string">'logoutWithUrl'</span>)) &#123;</span><br><span class="line">               phpCAS::logoutWithUrl($t_path);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               phpCAS::logout($t_path);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// zhanghl end</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹ auth_auto_create_user å‡½æ•°å®ç° CAS è‡ªåŠ¨åˆ›å»ºç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_auto_create_user</span><span class="params">( $p_username, $p_password )</span> </span>&#123;</span><br><span class="line">$t_login_method = config_get_global( <span class="string">'login_method'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// if( $t_login_method == BASIC_AUTH ) &#123;</span></span><br><span class="line"><span class="keyword">if</span> ( in_array( $t_login_method, <span class="keyword">array</span>( BASIC_AUTH, CAS ) ) ) &#123;</span><br><span class="line"><span class="comment"># attempt to create the user if using BASIC_AUTH or CAS</span></span><br><span class="line">$t_auto_create = <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>( $t_login_method == LDAP &amp;&amp; ldap_authenticate_by_username( $p_username, $p_password ) ) &#123;</span><br><span class="line">$t_auto_create = <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$t_auto_create = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( CAS == config_get( <span class="string">'login_method'</span> ) ) &#123;</span><br><span class="line"><span class="comment"># Redirect to CAS page to logout</span></span><br><span class="line">auth_cas_logout();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( $t_auto_create ) &#123;</span><br><span class="line"><span class="comment"># attempt to create the user</span></span><br><span class="line">$t_cookie_string = user_create( $p_username, md5( $p_password ) );</span><br><span class="line"><span class="keyword">if</span>( $t_cookie_string === <span class="keyword">false</span> ) &#123;</span><br><span class="line"><span class="comment"># it didn't work</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ok, we created the user, get the row again</span></span><br><span class="line"><span class="keyword">return</span> user_get_id_by_name( $p_username );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session_clean();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_attempt_login</span><span class="params">( $p_username, $p_password, $p_perm_login = false )</span> </span>&#123;</span><br><span class="line">$t_user_id = auth_get_user_id_from_login_name( $p_username );</span><br><span class="line">$t_login_method = config_get( <span class="string">'login_method'</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( $t_user_id === <span class="keyword">false</span> ) &#123;</span><br><span class="line"><span class="keyword">if</span> ( in_array( $t_login_method, <span class="keyword">array</span>( BASIC_AUTH, CAS ) ) ) &#123;</span><br><span class="line">            <span class="comment"># attempt to create the user if using BASIC_AUTH or CAS</span></span><br><span class="line">            <span class="comment"># ( note: CAS must have $g_allow_blank_email == ON )</span></span><br><span class="line"> $t_auto_create = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">$t_user_id = auth_auto_create_user( $p_username, $p_password );</span><br><span class="line"><span class="keyword">if</span>( $t_user_id === <span class="keyword">false</span> ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># max. failed login attempts achieved...</span></span><br><span class="line"><span class="keyword">if</span>( !user_is_login_request_allowed( $t_user_id ) ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># check for anonymous login</span></span><br><span class="line"><span class="keyword">if</span>( !user_is_anonymous( $t_user_id ) ) &#123;</span><br><span class="line"><span class="comment"># anonymous login didn't work, so check the password</span></span><br><span class="line"><span class="keyword">if</span>( !auth_does_password_match( $t_user_id, $p_password ) ) &#123;</span><br><span class="line">user_increment_failed_login_count( $t_user_id );</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> auth_login_user( $t_user_id, $p_perm_login );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">global</span> $g_cache_current_user_id, $g_cache_cookie_valid;</span><br><span class="line"></span><br><span class="line"><span class="comment"># clear cached userid</span></span><br><span class="line">user_clear_cache( $g_cache_current_user_id );</span><br><span class="line">current_user_set( <span class="keyword">null</span> );</span><br><span class="line">$g_cache_cookie_valid = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># clear cookies, if they were set</span></span><br><span class="line"><span class="keyword">if</span>( auth_clear_cookies() ) &#123;</span><br><span class="line">helper_clear_pref_cookies();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( HTTP_AUTH == config_get_global( <span class="string">'login_method'</span> ) ) &#123;</span><br><span class="line">auth_http_set_logout_pending( <span class="keyword">true</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">elseif</span> ( CAS == config_get( <span class="string">'login_method'</span> ) ) &#123;</span><br><span class="line">        <span class="comment"># Redirect to CAS page to logout</span></span><br><span class="line">        auth_cas_logout();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session_clean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_automatic_logon_bypass_form</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>( config_get( <span class="string">'login_method'</span> ) ) &#123;</span><br><span class="line">                <span class="keyword">case</span> HTTP_AUTH:</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">case</span> CAS:</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">//return config_get_global( 'login_method' ) == HTTP_AUTH;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_does_password_match</span><span class="params">( $p_user_id, $p_test_password )</span> </span>&#123;</span><br><span class="line">$t_configured_login_method = config_get_global( <span class="string">'login_method'</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( LDAP == $t_configured_login_method ) &#123;</span><br><span class="line"><span class="keyword">return</span> ldap_authenticate( $p_user_id, $p_test_password );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">elseif</span> ( CAS == $t_configured_login_method ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( !auth_can_use_standard_login( $p_user_id ) ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$t_password = user_get_field( $p_user_id, <span class="string">'password'</span> );</span><br><span class="line">$t_login_methods = <span class="keyword">array</span>(</span><br><span class="line">MD5,</span><br><span class="line">CRYPT,</span><br><span class="line">PLAIN,</span><br><span class="line">BASIC_AUTH,</span><br><span class="line">CAS,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>( $t_login_methods <span class="keyword">as</span> $t_login_method ) &#123;</span><br><span class="line"><span class="comment"># pass the stored password in as the salt</span></span><br><span class="line"><span class="keyword">if</span>( auth_process_plain_password( $p_test_password, $t_password, $t_login_method ) == $t_password ) &#123;</span><br><span class="line"><span class="comment"># Do not support migration to PLAIN, since this would be a crazy thing to do.</span></span><br><span class="line"><span class="comment"># Also if we do, then a user will be able to login by providing the MD5 value</span></span><br><span class="line"><span class="comment"># that is copied from the database.  See #8467 for more details.</span></span><br><span class="line"><span class="keyword">if</span>( ( $t_configured_login_method != PLAIN &amp;&amp; $t_login_method == PLAIN ) ||</span><br><span class="line">( $t_configured_login_method != BASIC_AUTH &amp;&amp; $t_login_method == BASIC_AUTH ) ) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check for migration to another login method and test whether the password was encrypted</span></span><br><span class="line"><span class="comment"># with our previously insecure implementation of the CRYPT method</span></span><br><span class="line"><span class="keyword">if</span>( ( $t_login_method != $t_configured_login_method ) || (( CRYPT == $t_configured_login_method ) &amp;&amp; mb_substr( $t_password, <span class="number">0</span>, <span class="number">2</span> ) == mb_substr( $p_test_password, <span class="number">0</span>, <span class="number">2</span> ) ) ) &#123;</span><br><span class="line">user_set_password( $p_user_id, $p_test_password, <span class="keyword">true</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth_reauthenticate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//if( !auth_reauthentication_enabled() || BASIC_AUTH == config_get_global( 'login_method' ) || HTTP_AUTH == config_get_global( 'login_method' ) ) &#123;</span></span><br><span class="line"><span class="keyword">if</span>( !auth_reauthentication_enabled() || in_array(config_get(<span class="string">'login_method'</span>), <span class="keyword">array</span>(BASIC_AUTH, HTTP_AUTH, CAS)) ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$t_auth_token = token_get( TOKEN_AUTHENTICATED );</span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">null</span> != $t_auth_token ) &#123;</span><br><span class="line">token_touch( $t_auth_token[<span class="string">'id'</span>], auth_reauthentication_expiry() );</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$t_anon_account = auth_anonymous_account();</span><br><span class="line">$t_anon_allowed = auth_anonymous_enabled();</span><br><span class="line"></span><br><span class="line">$t_user_id = auth_get_current_user_id();</span><br><span class="line">$t_username = user_get_username( $t_user_id );</span><br><span class="line"></span><br><span class="line"><span class="comment"># check for anonymous login</span></span><br><span class="line"><span class="keyword">if</span>( ON == $t_anon_allowed &amp;&amp; $t_anon_account == $t_username ) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$t_request_uri = string_url( $_SERVER[<span class="string">'REQUEST_URI'</span>] );</span><br><span class="line"></span><br><span class="line">$t_query_params = http_build_query(</span><br><span class="line"><span class="keyword">array</span>(</span><br><span class="line"><span class="string">'reauthenticate'</span> =&gt; <span class="number">1</span>,</span><br><span class="line"><span class="string">'username'</span> =&gt; $t_username,</span><br><span class="line"><span class="string">'return'</span> =&gt; $t_request_uri,</span><br><span class="line">),</span><br><span class="line"><span class="string">''</span>, <span class="string">'&amp;'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment"># redirect to login page</span></span><br><span class="line">print_header_redirect( auth_credential_page( $t_query_params ) );</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºlogin-cas-phpå¤„ç†æ‹¦æˆªåˆ©ç”¨CASè®¤è¯ç™»å½•"><a href="#æ–°å»ºlogin-cas-phpå¤„ç†æ‹¦æˆªåˆ©ç”¨CASè®¤è¯ç™»å½•" class="headerlink" title="æ–°å»ºlogin_cas.phpå¤„ç†æ‹¦æˆªåˆ©ç”¨CASè®¤è¯ç™»å½•"></a>æ–°å»º<code>login_cas.php</code>å¤„ç†æ‹¦æˆªåˆ©ç”¨<code>CAS</code>è®¤è¯ç™»å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  vi /var/www/html/mantis/phpCAS/login_cas.php</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>( <span class="string">'CAS.php'</span> );</span><br><span class="line">define(<span class="string">'CAS_ENABLE'</span>, <span class="keyword">true</span>);</span><br><span class="line">$cas_host = <span class="string">'devops.iamzhl.top'</span>;</span><br><span class="line">$cas_context = <span class="string">'/cas'</span>;</span><br><span class="line">$cas_port = <span class="number">8080</span>;</span><br><span class="line">$cas_real_hosts = <span class="keyword">array</span> (</span><br><span class="line"><span class="string">'devops.iamzhl.top'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">phpCAS::setDebug();</span><br><span class="line">phpCAS::setVerbose(<span class="keyword">true</span>);</span><br><span class="line">phpCAS::client(CAS_VERSION_2_0, $cas_host, $cas_port, $cas_context);</span><br><span class="line">phpCAS::setNoCasServerValidation();</span><br><span class="line">phpCAS::handleLogoutRequests(<span class="keyword">true</span>, $cas_real_hosts);</span><br><span class="line">phpCAS::forceAuthentication();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹CASçš„Client-phpå¯ç”¨httpè¿æ¥-æ ¹æ®ä¸ªäººCASæœåŠ¡å™¨æ¥å®š"><a href="#ä¿®æ”¹CASçš„Client-phpå¯ç”¨httpè¿æ¥-æ ¹æ®ä¸ªäººCASæœåŠ¡å™¨æ¥å®š" class="headerlink" title="ä¿®æ”¹CASçš„Client.phpå¯ç”¨httpè¿æ¥(æ ¹æ®ä¸ªäººCASæœåŠ¡å™¨æ¥å®š)"></a>ä¿®æ”¹<code>CAS</code>çš„<code>Client.php</code>å¯ç”¨<code>http</code>è¿æ¥(æ ¹æ®ä¸ªäºº<code>CAS</code>æœåŠ¡å™¨æ¥å®š)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /var/www/html/mantis/phpCAS/source/CAS/Client.php</span></span><br></pre></td></tr></table></figure><blockquote><p>å°†å¦‚ä¸‹å‡ ä¸ªå‡½æ•°ä¸­çš„httpsæ”¹ä¸ºhttpå³å¯</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_getServerBaseURL</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// the URL is build only when needed</span></span><br><span class="line">        <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>]) ) &#123;</span><br><span class="line">            <span class="comment">//$this-&gt;_server['base_url'] = 'https://' . $this-&gt;_getServerHostname();</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>] = <span class="string">'http://'</span> . <span class="keyword">$this</span>-&gt;_getServerHostname();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;_getServerPort()!=<span class="number">443</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>] .= <span class="string">':'</span></span><br><span class="line">                .<span class="keyword">$this</span>-&gt;_getServerPort();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>] .= <span class="keyword">$this</span>-&gt;_getServerURI();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_server[<span class="string">'base_url'</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_getCallbackURL</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// the URL is built when needed only</span></span><br><span class="line">        <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;_callback_url) ) &#123;</span><br><span class="line">            $final_uri = <span class="string">''</span>;</span><br><span class="line">            <span class="comment">// remove the ticket if present in the URL</span></span><br><span class="line">            <span class="comment">//$final_uri = 'https://';</span></span><br><span class="line">            $final_uri = <span class="string">'http://'</span>;</span><br><span class="line">            $final_uri .= <span class="keyword">$this</span>-&gt;_getClientUrl();</span><br><span class="line">            $request_uri = $_SERVER[<span class="string">'REQUEST_URI'</span>];</span><br><span class="line">            $request_uri = preg_replace(<span class="string">'/\?.*$/'</span>, <span class="string">''</span>, $request_uri);</span><br><span class="line">            $final_uri .= $request_uri;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_callback_url = $final_uri;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_callback_url;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public function getURL()</span><br><span class="line">    &#123;</span><br><span class="line">        phpCAS::traceBegin();</span><br><span class="line">        // the URL is built when needed only</span><br><span class="line">        if ( empty($this-&gt;_url) ) &#123;</span><br><span class="line">            $final_uri = &apos;&apos;;</span><br><span class="line">            // remove the ticket if present in the URL</span><br><span class="line">            //$final_uri = ($this-&gt;_isHttps()) ? &apos;https&apos; : &apos;http&apos;;</span><br><span class="line">            $final_uri = ($this-&gt;_isHttps()) ? &apos;http&apos; : &apos;http&apos;;</span><br><span class="line">            $final_uri .= &apos;://&apos;;</span><br><span class="line"></span><br><span class="line">            $final_uri .= $this-&gt;_getClientUrl();</span><br><span class="line">            $request_uri        = explode(&apos;?&apos;, $_SERVER[&apos;REQUEST_URI&apos;], 2);</span><br><span class="line">            $final_uri          .= $request_uri[0];</span><br><span class="line"></span><br><span class="line">            if (isset($request_uri[1]) &amp;&amp; $request_uri[1]) &#123;</span><br><span class="line">                $query_string= $this-&gt;_removeParameterFromQueryString(&apos;ticket&apos;, $request_uri[1]);</span><br><span class="line"></span><br><span class="line">                // If the query string still has anything left,</span><br><span class="line">                // append it to the final URI</span><br><span class="line">                if ($query_string !== &apos;&apos;) &#123;</span><br><span class="line">                    $final_uri  .= &quot;?$query_string&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            phpCAS::trace(&quot;Final URI: $final_uri&quot;);</span><br><span class="line">            $this-&gt;setURL($final_uri);</span><br><span class="line">        &#125;</span><br><span class="line">        phpCAS::traceEnd($this-&gt;_url);</span><br><span class="line">        return $this-&gt;_url;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><blockquote><p>æ–°å»º<code>log</code>ç›®å½•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /var/log/mantis</span></span><br><span class="line"><span class="comment"># chown -R apache:apache /var/log/mantis</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>MantisBT</code>ç½‘å€ï¼Œæ­£å¸¸è·³è½¬è‡³<code>CAS</code>ç™»å½•ç•Œé¢ï¼Œç½‘å€æ˜¯<code>http://devops.iamzhl.top:8080/cas/login?service=http%3A%2F%2Fdevops.iamzhl.top%2Fmantis%2Flogin_page.php</code></p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/fa/f707556ce41d95b71052d07834f5d8.jpg" alt></p><p>å¦‚å›¾ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç åç‚¹å‡»ç™»å½•ï¼Œæ­£å¸¸ç™»é™†åè·³è½¬è‡³<code>MantisBT</code>ä¸»é¡µï¼Œå¹¶ä¸”æ­£å¸¸è·å–ç”¨æˆ·å</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/49/1365298ec15c90fbf95612a38606ed.jpg" alt></p><p>ç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·å -&gt; æ³¨é”€ï¼Œä¼šæ­£å¸¸é€€å‡ºå¹¶è·³è½¬åˆ°<code>CAS</code>çš„ç™»å‡ºç•Œé¢</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/85/2d25e40bdf97b6f06dad6239cf3167.jpg" alt></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      MantisBT æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="CAS" scheme="https://iamzhl.top/tags/CAS/"/>
    
      <category term="LDAP" scheme="https://iamzhl.top/tags/LDAP/"/>
    
      <category term="MantisBT" scheme="https://iamzhl.top/tags/MantisBT/"/>
    
  </entry>
  
  <entry>
    <title>Gerrit æ•´åˆ ldap å’Œ CAS å•ç‚¹ç™»å½•</title>
    <link href="https://iamzhl.top/Gerrit-integrate-with-ldap-and-CAS.html"/>
    <id>https://iamzhl.top/Gerrit-integrate-with-ldap-and-CAS.html</id>
    <published>2018-12-03T01:42:41.000Z</published>
    <updated>2019-03-11T16:21:49.891Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><ul><li>Gerrit ç‰ˆæœ¬ï¼š2.16</li><li>Gerrit URLï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgy" title="http://devops.iamzhl.top:82">http://devops.iamzhl.top:82<i class="fa fa-external-link"></i></span></li><li>openLDAP æœåŠ¡ï¼šldap://devops.iamzhl.top:389</li><li>CAS æœåŠ¡ï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgwODAvY2Fz" title="http://devops.iamzhl.top:8080/cas">http://devops.iamzhl.top:8080/cas<i class="fa fa-external-link"></i></span></li></ul><h2 id="æ•´åˆ-LDAP"><a href="#æ•´åˆ-LDAP" class="headerlink" title="æ•´åˆ LDAP"></a>æ•´åˆ LDAP</h2><h3 id="ä¿®æ”¹-gerrit-config"><a href="#ä¿®æ”¹-gerrit-config" class="headerlink" title="ä¿®æ”¹ gerrit.config"></a>ä¿®æ”¹ gerrit.config</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/review_site/etc/gerrit.config</span></span><br></pre></td></tr></table></figure><blockquote><p>è¯·æ ¹æ®è‡ªå·±çš„<code>LDAP</code>æœåŠ¡å™¨ä¿¡æ¯è¿›è¡Œå®šåˆ¶</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[auth]</span><br><span class="line">        type = LDAP</span><br><span class="line">[ldap]</span><br><span class="line">        server = ldap://devops.iamzhl.top:389</span><br><span class="line">        username = cn=Manager,dc=iamzhl,dc=top</span><br><span class="line">        password = passwd</span><br><span class="line">        accountBase = ou=People,dc=iamzhl,dc=top</span><br><span class="line">        groupBase = ou=People,dc=iamzhl,dc=top</span><br><span class="line">        accountFullName = uid</span><br></pre></td></tr></table></figure><h3 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gerrit restart</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æ‰“å¼€ç½‘å€<code>http://devops.iamzhl.top:8081</code>ï¼Œè¿›å…¥åˆ°<code>Gerrit</code>ä¸»é¡µé¢</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/4d/42f6d16ca0cd469d5b5bd9cfb9f471.jpg" alt></p><p>ç‚¹å‡»å³ä¸Šè§’<code>Sign in</code>ï¼Œè¿›å…¥ç™»å½•ç•Œé¢ï¼Œè¾“å…¥<code>LDAP</code>æœåŠ¡å™¨ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åç‚¹å‡»<code>Sign in</code></p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/5e/3a439fb1bcfae0116018eaca7dd987.jpg" alt></p><p>ç™»å½•æˆåŠŸåè·³è½¬åˆ°ç”¨æˆ·ä¸»é¡µé¢ï¼Œæ­£å¸¸è·å–ç”¨æˆ·å</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/3d/ea561210f011755f97aec7c4a90b59.jpg" alt></p><p>ç‚¹å‡»ç”¨æˆ·å -&gt; Sign Outï¼Œæ­£å¸¸é€€å‡º</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/4d/42f6d16ca0cd469d5b5bd9cfb9f471.jpg" alt></p><p>è‡³æ­¤ï¼Œ<code>Gerrit</code>æ•´åˆ<code>LDAP</code>å®Œæˆã€‚</p><h2 id="æ•´åˆ-CAS"><a href="#æ•´åˆ-CAS" class="headerlink" title="æ•´åˆ CAS"></a>æ•´åˆ CAS</h2><h3 id="ä¿®æ”¹-gerrit-config-1"><a href="#ä¿®æ”¹-gerrit-config-1" class="headerlink" title="ä¿®æ”¹ gerrit.config"></a>ä¿®æ”¹ gerrit.config</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/review_site/etc/gerrit.config</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>[auth]</code>éƒ¨åˆ†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[auth]</span><br><span class="line">        type = HTTP</span><br><span class="line">        httpHeader = X-Forwarded-Gerrit</span><br><span class="line">        logoutUrl = http://devops.iamzhl.top:8080/cas/logout</span><br></pre></td></tr></table></figure><h3 id="mod-auth-casä¿®æ”¹"><a href="#mod-auth-casä¿®æ”¹" class="headerlink" title="mod_auth_casä¿®æ”¹"></a><code>mod_auth_cas</code>ä¿®æ”¹</h3><p>ç„¶åå®‰è£…<code>mod_auth_cas</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install mod_auth_cas</span></span><br></pre></td></tr></table></figure><p>é…ç½®<code>mod_auth_cas</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/httpd/conf.d/auth_cas.conf</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>CAS</code>çš„<code>Cookie</code>å­˜å‚¨ä½ç½®ä»¥åŠç™»å½•åœ°å€å’ŒéªŒè¯åœ°å€ç­‰å‚æ•°å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LogLevel Debug</span><br><span class="line">CASDebug On</span><br><span class="line">CASVersion 2</span><br><span class="line">CASTimeout 1740</span><br><span class="line">CASIdleTimeout 1740</span><br><span class="line">CASSSOEnabled On</span><br><span class="line">CASCookiePath /var/cache/httpd/mod_auth_cas/</span><br><span class="line">CASLoginURL http://devops.iamzhl.top:8080/cas/login</span><br><span class="line">CASValidateURL http://devops.iamzhl.top:8080/cas/serviceValidate</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-apache-é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹-apache-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ apache é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ apache é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/httpd/conf/httpd.conf</span></span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ åå‘ä»£ç†</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ ä¸€ä¸ªç›‘å¬ç«¯å£ 82 ç”¨ä½œ Gerrit çš„ä»£ç†ä¸»æœº</span><br><span class="line">Listen 82</span><br><span class="line"></span><br><span class="line"># åŠ è½½ mod_auth_cas æ¨¡å—ï¼Œå¦‚æœå·²ç»åŠ è½½è¯·å¿½ç•¥</span><br><span class="line">LoadModule auth_cas_module modules/mod_auth_cas.so</span><br><span class="line"></span><br><span class="line"># è®¾ç½® Gerrit çš„è™šæ‹Ÿä¸»æœº</span><br><span class="line">&lt;VirtualHost *:82&gt;</span><br><span class="line">    ServerName devops.iamzhl.top</span><br><span class="line">    ServerAdmin 15563836030@163.com</span><br><span class="line"></span><br><span class="line">    CASRootProxiedAs http://devops.iamzhl.top:82</span><br><span class="line"></span><br><span class="line">    ProxyRequests Off</span><br><span class="line">    ProxyVia Off</span><br><span class="line">    ProxyPreserveHost On</span><br><span class="line"></span><br><span class="line">    &lt;Proxy *&gt;</span><br><span class="line">          Order deny,allow</span><br><span class="line">          Allow from all</span><br><span class="line">    &lt;/Proxy&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Location &quot;/login/&quot;&gt;</span><br><span class="line">        AuthType CAS</span><br><span class="line">        AuthName &quot;Welcome To Gerrit Code Review&quot;</span><br><span class="line">        Require valid-user</span><br><span class="line">        CASAuthNHeader X-Forwarded-Gerrit</span><br><span class="line">    &lt;/Location&gt;</span><br><span class="line"></span><br><span class="line">    AllowEncodedSlashes On</span><br><span class="line"></span><br><span class="line">    ProxyPass / http://devops.iamzhl.top:8081/</span><br><span class="line">    ProxyPassReverse / http://devops.iamzhl.top:8081</span><br><span class="line"></span><br><span class="line">    ErrorLog /var/log/gerrit/error.log</span><br><span class="line">    CustomLog /var/log/gerrit/access.log common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><h3 id="é‡å¯æœåŠ¡-1"><a href="#é‡å¯æœåŠ¡-1" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /var/log/gerrit</span></span><br><span class="line"><span class="comment"># gerrit restart</span></span><br><span class="line"><span class="comment"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æ‰“å¼€ç½‘å€<code>http://devops.iamzhl.top:82</code>ï¼Œå‘ç°è‡ªåŠ¨è·³è½¬åˆ°äº†<code>CAS</code>çš„ç™»å½•ç•Œé¢ï¼Œç½‘å€æ˜¯<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgwODAvY2FzL2xvZ2luP3NlcnZpY2U9aHR0cCUzYSUyZiUyZmRldm9wcy5pYW16aGwudG9wJTNhODIlMmY=" title="http://devops.iamzhl.top:8080/cas/login?service=http%3a%2f%2fdevops.iamzhl.top%3a82%2f">http://devops.iamzhl.top:8080/cas/login?service=http%3a%2f%2fdevops.iamzhl.top%3a82%2f<i class="fa fa-external-link"></i></span></p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/dc/a298cbb27df3f031b6a75d41b8ae3b.jpg" alt></p><p>è¾“å…¥ç”¨æˆ·åå¯†ç åï¼Œç‚¹å‡»ç™»å½•ï¼Œç™»é™†æˆåŠŸï¼Œåœ°å€æ˜¯<code>http://devops.iamzhl.top:82//#/dashboard/self</code></p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/6b/7e1c3e774f6d188f2a2a7203776be1.jpg" alt></p><p>ç‚¹å‡»ç”¨æˆ·å -&gt; Sign Outï¼Œå°±ä¼šç™»å‡º</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/a2/726b245663641d5b6aaf1eef3e17bf.jpg" alt></p><p>ç™»å‡ºç•Œé¢å¦‚ä¸‹ï¼Œåœ°å€æ˜¯<code>http://devops.iamzhl.top:8080/cas/logout</code></p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/e9/a067be6a85ec888bc9ab25bcf0d0e7.jpg" alt></p><p>è‡³æ­¤ï¼Œ<code>Gerrit</code>æ•´åˆ<code>CAS</code>å•ç‚¹ç™»å½•å®Œæˆã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      Gerrit æ•´åˆ ldap å’Œ CAS å•ç‚¹ç™»å½•
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Gerrit" scheme="https://iamzhl.top/tags/Gerrit/"/>
    
      <category term="ldap" scheme="https://iamzhl.top/tags/ldap/"/>
    
      <category term="CAS" scheme="https://iamzhl.top/tags/CAS/"/>
    
  </entry>
  
  <entry>
    <title>SonarQube æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•</title>
    <link href="https://iamzhl.top/SonarQube-integrate-with-ldap-and-CAS.html"/>
    <id>https://iamzhl.top/SonarQube-integrate-with-ldap-and-CAS.html</id>
    <published>2018-11-30T05:23:17.000Z</published>
    <updated>2019-03-11T16:21:49.901Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:27 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><ul><li><code>SonarQube</code>ç‰ˆæœ¬ï¼š7.4</li><li><code>SonarQube</code> URL: <span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjkwMDA=" title="http://devops.iamzhl.top:9000">http://devops.iamzhl.top:9000<i class="fa fa-external-link"></i></span></li><li>openLDAP æœåŠ¡ï¼šldap://devops.iamzhl.top:389</li><li>CAS æœåŠ¡ï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgwODAvY2Fz" title="http://devops.iamzhl.top:8080/cas">http://devops.iamzhl.top:8080/cas<i class="fa fa-external-link"></i></span></li></ul><h2 id="æ•´åˆLDAP"><a href="#æ•´åˆLDAP" class="headerlink" title="æ•´åˆLDAP"></a>æ•´åˆ<code>LDAP</code></h2><p>ä¿®æ”¹<code>sonar</code>é…ç½®æ–‡ä»¶<code>sonar.properties</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /usr/<span class="built_in">local</span>/sonarqube-7.4/conf/sonar.properties</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ä¸‹é¢çš„éƒ¨åˆ†ä¿®æ”¹<code>LDAP</code>é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#--------------------------------------------------------------------------------------------------</span><br><span class="line"># LDAP CONFIGURATION</span><br><span class="line"></span><br><span class="line"># Enable the LDAP feature</span><br><span class="line"># sonar.security.realm=LDAP</span><br><span class="line"></span><br><span class="line"># Set to true when connecting to a LDAP server using a case-insensitive setup.</span><br><span class="line"># sonar.authenticator.downcase=true</span><br><span class="line"></span><br><span class="line"># URL of the LDAP server. Note that if you are using ldaps, then you should install the server certificate into the Java truststore.</span><br><span class="line"># ldap.url=ldap://localhost:10389</span><br><span class="line"></span><br><span class="line"># Bind DN is the username of an LDAP user to connect (or bind) with. Leave this blank for anonymous access to the LDAP directory (optional)</span><br><span class="line"># ldap.bindDn=cn=sonar,ou=users,o=mycompany</span><br><span class="line"></span><br><span class="line"># Bind Password is the password of the user to connect with. Leave this blank for anonymous access to the LDAP directory (optional)</span><br><span class="line"># ldap.bindPassword=secret</span><br><span class="line"></span><br><span class="line"># Possible values: simple | CRAM-MD5 | DIGEST-MD5 | GSSAPI See http://java.sun.com/products/jndi/tutorial/ldap/security/auth.html (default: simple)</span><br><span class="line"># ldap.authentication=simple</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¦‚ä¸‹(è¯·å°†å…·ä½“ä¿¡æ¯æŒ‰ç…§è‡ªå·±çš„<code>LDAP</code>æœåŠ¡å™¨ä¿¡æ¯è¿›è¡Œä¿®æ”¹):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#--------------------------------------------------------------------------------------------------</span><br><span class="line"># LDAP CONFIGURATION</span><br><span class="line"></span><br><span class="line"># Enable the LDAP feature</span><br><span class="line">sonar.security.realm=LDAP</span><br><span class="line"></span><br><span class="line"># Set to true when connecting to a LDAP server using a case-insensitive setup.</span><br><span class="line"># sonar.authenticator.downcase=true</span><br><span class="line"></span><br><span class="line"># URL of the LDAP server. Note that if you are using ldaps, then you should install the server certificate into the Java truststore.</span><br><span class="line">ldap.url=ldap://devops.iamzhl.top:389</span><br><span class="line"></span><br><span class="line"># Bind DN is the username of an LDAP user to connect (or bind) with. Leave this blank for anonymous access to the LDAP directory (optional)</span><br><span class="line">ldap.bindDn=cn=Manager,dc=iamzhl,dc=top</span><br><span class="line"></span><br><span class="line"># Bind Password is the password of the user to connect with. Leave this blank for anonymous access to the LDAP directory (optional)</span><br><span class="line">ldap.bindPassword=passwd</span><br><span class="line"></span><br><span class="line"># Possible values: simple | CRAM-MD5 | DIGEST-MD5 | GSSAPI See http://java.sun.com/products/jndi/tutorial/ldap/security/auth.html (default: simple)</span><br><span class="line">ldap.authentication=simple</span><br><span class="line"></span><br><span class="line"># See :</span><br><span class="line">#   * http://java.sun.com/products/jndi/tutorial/ldap/security/digest.html</span><br><span class="line">#   * http://java.sun.com/products/jndi/tutorial/ldap/security/crammd5.html</span><br><span class="line"># (optional)</span><br><span class="line"># ldap.realm=example.org</span><br><span class="line"></span><br><span class="line"># Context factory class (optional)</span><br><span class="line"># ldap.contextFactoryClass=com.sun.jndi.ldap.LdapCtxFactory</span><br><span class="line"></span><br><span class="line"># Enable usage of StartTLS (default : false)</span><br><span class="line"># ldap.StartTLS=true</span><br><span class="line"></span><br><span class="line"># Follow or not referrals. See http://docs.oracle.com/javase/jndi/tutorial/ldap/referral/jndi.html (default: true)</span><br><span class="line"># ldap.followReferrals=false</span><br><span class="line"></span><br><span class="line"># USER MAPPING</span><br><span class="line"></span><br><span class="line"># Distinguished Name (DN) of the root node in LDAP from which to search for users (mandatory)</span><br><span class="line">ldap.user.baseDn=ou=People,dc=iamzhl,dc=top</span><br><span class="line"></span><br><span class="line"># LDAP user request. (default: (&amp;(objectClass=inetOrgPerson)(uid=&#123;login&#125;)) )</span><br><span class="line"># ldap.user.request=(&amp;(objectClass=user)(sAMAccountName=&#123;login&#125;))</span><br><span class="line">ldap.user.request=(&amp;(objectClass=inetOrgPerson)(uid=&#123;login&#125;))</span><br><span class="line"></span><br><span class="line"># Attribute in LDAP defining the userâ€™s real name. (default: cn)</span><br><span class="line"># ldap.user.realNameAttribute=name</span><br><span class="line">ldap.user.realNameAttribute=cn</span><br><span class="line"></span><br><span class="line"># Attribute in LDAP defining the userâ€™s email. (default: mail)</span><br><span class="line"># ldap.user.emailAttribute=email</span><br><span class="line">ldap.user.emailAttribute=mail</span><br><span class="line"></span><br><span class="line"># GROUP MAPPING</span><br><span class="line"></span><br><span class="line"># Distinguished Name (DN) of the root node in LDAP from which to search for groups. (optional, default: empty)</span><br><span class="line"># ldap.group.baseDn=cn=groups,dc=example,dc=org</span><br><span class="line">ldap.group.baseDn=ou=People,dc=iamzhl,dc=top</span><br><span class="line"></span><br><span class="line"># LDAP group request (default: (&amp;(objectClass=groupOfUniqueNames)(uniqueMember=&#123;dn&#125;)) )</span><br><span class="line"># ldap.group.request=(&amp;(objectClass=group)(member=&#123;dn&#125;))</span><br><span class="line">ldap.group.request=(&amp;(objectClass=posixGroup)(memberUid=&#123;uid&#125;))</span><br><span class="line"></span><br><span class="line"># Property used to specifiy the attribute to be used for returning the list of user groups in the compatibility mode. (default: cn)</span><br><span class="line"># ldap.group.idAttribute=sAMAccountName</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆåï¼Œé‡å¯<code>sonar</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sonar restart</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>sonar</code>ç½‘å€ï¼Œè¾“å…¥<code>LDAP</code>ä¸­çš„ç”¨æˆ·åå’Œå¯†ç åç‚¹å‡»ç™»å½•</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/89/7728c5a52a96a6841a426155062a56.jpg" alt></p><p>ç™»é™†æˆåŠŸåï¼Œæ­£å¸¸è·å–ç”¨æˆ·å</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/dd/53d39dc0858679e2a4949419417678.jpg" alt></p><p>è‡³æ­¤ï¼Œ<code>SonarQube</code>æ•´åˆ<code>LDAP</code>å®Œæˆ</p><h2 id="æ•´åˆCASå•ç‚¹ç™»å½•"><a href="#æ•´åˆCASå•ç‚¹ç™»å½•" class="headerlink" title="æ•´åˆCASå•ç‚¹ç™»å½•"></a>æ•´åˆ<code>CAS</code>å•ç‚¹ç™»å½•</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><code>SonarQube</code>æä¾›äº†ä¸€ç§<code>SSO</code>æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ¥ä½œä¸ºå•ç‚¹ç™»å½•çš„å®ç°æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨<code>HTTP header</code>çš„æ–¹å¼ï¼Œè€Œ<code>CAS</code>ä¹Ÿæä¾›äº†ä¸€ç§ç”¨äº<code>apache</code>æœåŠ¡çš„è®¤è¯æ–¹å¼ï¼Œè¿™å°±æ˜¯<code>mod_auth_cas</code>ï¼Œæ€è·¯å¾ˆç®€å•ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>apache</code>åå‘ä»£ç†ï¼Œåšä¸€ä¸ªç«¯å£ç”¨äºè™šæ‹Ÿä¸»æœºæ¥è½¬å‘<code>SonarQube</code>æœåŠ¡ï¼Œç„¶ååœ¨è¿™ä¸ªè™šæ‹Ÿä¸»æœºå†…éƒ¨åŠ å…¥<code>mod_auth_cas</code>æä¾›çš„è®¤è¯æ‹¦æˆªï¼ŒåŒæ—¶åœ¨é‡Œé¢æŒ‡å®šä¸€ä¸ª<code>HTTP header</code>ç”¨äºå‘é€è®¤è¯åçš„è¯·æ±‚åˆ°<code>SonarQube</code>ï¼Œç„¶åï¼Œ<code>SonarQube</code>æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œå‘ç°æ­£æ˜¯è‡ªå·±è®¾å®šçš„<code>HTTP header</code>ï¼Œäºæ˜¯äºˆä»¥é€šè¿‡è®¤è¯ã€‚è¿™å°±æ˜¯æ•´ä¸ªè®¤è¯æµç¨‹ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»æ•´åˆæ–¹æ³•ã€‚</p><h3 id="SonarQubeä¿®æ”¹"><a href="#SonarQubeä¿®æ”¹" class="headerlink" title="SonarQubeä¿®æ”¹"></a><code>SonarQube</code>ä¿®æ”¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /usr/<span class="built_in">local</span>/sonarqube-7.4/conf/sonar.properties</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¦‚ä¸‹éƒ¨åˆ†(å°±æ˜¯å°†<code>SSO AUTHENTICATION</code>éƒ¨åˆ†çš„å‚æ•°å–æ¶ˆæ³¨é‡Šï¼Œä»¤å…¶ç”Ÿæ•ˆ)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#--------------------------------------------------------------------------------------------------</span><br><span class="line"># SSO AUTHENTICATION</span><br><span class="line"></span><br><span class="line"># Enable authentication using HTTP headers</span><br><span class="line">sonar.web.sso.enable=true</span><br><span class="line"></span><br><span class="line"># Name of the header to get the user login.</span><br><span class="line"># Only alphanumeric, &apos;.&apos; and &apos;@&apos; characters are allowed</span><br><span class="line">sonar.web.sso.loginHeader=X-Forwarded-Login</span><br><span class="line"></span><br><span class="line"># Name of the header to get the user name</span><br><span class="line">sonar.web.sso.nameHeader=X-Forwarded-Name</span><br><span class="line"></span><br><span class="line"># Name of the header to get the user email (optional)</span><br><span class="line">sonar.web.sso.emailHeader=X-Forwarded-Email</span><br><span class="line"></span><br><span class="line"># Name of the header to get the list of user groups, separated by comma (optional).</span><br><span class="line"># If the sonar.sso.groupsHeader is set, the user will belong to those groups if groups exist in SonarQube.</span><br><span class="line"># If none of the provided groups exists in SonarQube, the user will only belong to the default group.</span><br><span class="line"># Note that the default group will always be set.</span><br><span class="line">sonar.web.sso.groupsHeader=X-Forwarded-Groups</span><br><span class="line"></span><br><span class="line"># Interval used to know when to refresh name, email and groups.</span><br><span class="line"># During this interval, if for instance the name of the user is changed in the header, it will only be updated after X minutes.</span><br><span class="line">sonar.web.sso.refreshIntervalInMinutes=5</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>app.d5dba530.chunk.js</code>ï¼Œè§£å†³ç™»å‡ºé—®é¢˜ï¼Œä¸åŒçš„ç‰ˆæœ¬ä¸åŒï¼Œ<code>7.2.1</code>çš„åœ¨<code>main</code>å¼€å¤´çš„ä¸€ä¸ª<code>js</code>æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/sonarqube-7.4/web/js/app.d5dba530.chunk.js</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t.handleLogout = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line"><span class="comment">// e.preventDefault(), t.context.router.push("/sessions/logout") </span></span><br><span class="line">t.context.router.push(<span class="string">"/sessions/logout"</span>)  <span class="comment">//å»æ‰e.preventDefault()æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.createElement(<span class="string">"li"</span>, <span class="literal">null</span>, r.createElement(<span class="string">"a"</span>, &#123;</span><br><span class="line"><span class="comment">//href: "#",</span></span><br><span class="line">href: <span class="string">"http://192.168.6.99:8080/cas/logout"</span>,  <span class="comment">//å°†æ­¤æ³¨é”€æŒ‰é’®çš„hrefæ”¹ä¸ºCASæœåŠ¡å™¨çš„ç™»å‡ºé¡µé¢</span></span><br><span class="line">onClick: <span class="keyword">this</span>.handleLogout</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mod-auth-casä¿®æ”¹"><a href="#mod-auth-casä¿®æ”¹" class="headerlink" title="mod_auth_casä¿®æ”¹"></a><code>mod_auth_cas</code>ä¿®æ”¹</h3><p>ç„¶åå®‰è£…<code>mod_auth_cas</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install mod_auth_cas</span></span><br></pre></td></tr></table></figure><p>é…ç½®<code>mod_auth_cas</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/httpd/conf.d/auth_cas.conf</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>CAS</code>çš„<code>Cookie</code>å­˜å‚¨ä½ç½®ä»¥åŠç™»å½•åœ°å€å’ŒéªŒè¯åœ°å€ç­‰å‚æ•°å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LogLevel Debug</span><br><span class="line">CASDebug On</span><br><span class="line">CASVersion 2</span><br><span class="line">CASTimeout 1740</span><br><span class="line">CASIdleTimeout 1740</span><br><span class="line">CASSSOEnabled On</span><br><span class="line">CASCookiePath /var/cache/httpd/mod_auth_cas/</span><br><span class="line">CASLoginURL http://devops.iamzhl.top:8080/cas/login</span><br><span class="line">CASValidateURL http://devops.iamzhl.top:8080/cas/serviceValidate</span><br></pre></td></tr></table></figure><h3 id="apacheä¿®æ”¹"><a href="#apacheä¿®æ”¹" class="headerlink" title="apacheä¿®æ”¹"></a><code>apache</code>ä¿®æ”¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/httpd/conf/httpd.conf</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ è™šæ‹Ÿä¸»æœº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ ä¸€ä¸ªç›‘å¬ç«¯å£ 83 ç”¨ä½œ SonarQube çš„ä»£ç†ä¸»æœº</span><br><span class="line">Listen 83</span><br><span class="line"></span><br><span class="line"># åŠ è½½ mod_auth_cas æ¨¡å—ï¼Œå¦‚æœå·²ç»åŠ è½½è¯·å¿½ç•¥</span><br><span class="line">LoadModule auth_cas_module modules/mod_auth_cas.so</span><br><span class="line"></span><br><span class="line"># è®¾ç½® SonarQube çš„è™šæ‹Ÿä¸»æœº</span><br><span class="line">&lt;VirtualHost *:83&gt;</span><br><span class="line">        ServerName devops.iamzhl.top</span><br><span class="line">        ServerAdmin 15563836030@163.com</span><br><span class="line"></span><br><span class="line">        CASRootProxiedAs http://devops.iamzhl.top:83</span><br><span class="line"></span><br><span class="line">        ProxyPreserveHost On</span><br><span class="line"></span><br><span class="line">        ProxyPass / http://devops.iamzhl.top:9000/</span><br><span class="line">        ProxyPassReverse / http://devops.iamzhl.top:9000/</span><br><span class="line">        ProxyPass /sessions/logout http://devops.iamzhl.top:8080/cas/logout</span><br><span class="line">        ProxyPassReverse /sessions/logout http://devops.iamzhl.top:8080/cas/logout</span><br><span class="line">        ProxyPass /api/authentication/logout http://devops.iamzhl.top:8080/cas/logout</span><br><span class="line">        ProxyPassReverse /api/authentication/logout http://devops.iamzhl.top:8080/cas/logout</span><br><span class="line"></span><br><span class="line">        ErrorLog /var/log/sonar/error.log</span><br><span class="line">        CustomLog /var/log/sonar/access.log common</span><br><span class="line"></span><br><span class="line">        &lt;Location /&gt;</span><br><span class="line">                AuthName &quot;Welcome to devops sonar&quot;</span><br><span class="line">                CASAuthNHeader X-Forwarded-Login</span><br><span class="line">                Authtype CAS</span><br><span class="line">                require valid-user</span><br><span class="line">        &lt;/Location&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Proxy *&gt;</span><br><span class="line">                Order deny,allow</span><br><span class="line">                Allow from all</span><br><span class="line">        &lt;/Proxy&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><h3 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /var/log/sonar</span></span><br><span class="line"><span class="comment"># chown -R apache:apache /var/log/sonar</span></span><br><span class="line"><span class="comment"># su sonar</span></span><br><span class="line">$ sonar restart</span><br><span class="line"><span class="comment"># su </span></span><br><span class="line"><span class="comment"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æ‰“å¼€ç½‘å€<code>http://devops.iamzhl.top:83</code>ï¼Œå‘ç°è‡ªåŠ¨è·³è½¬åˆ°äº†<code>CAS</code>çš„ç™»å½•ç•Œé¢ï¼Œç½‘å€æ˜¯<code>http://devops.iamzhl.top:8080/cas/login?service=http%3a%2f%2fdevops.iamzhl.top%3a83%2f</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/0b/b05aa63a31ffc624e42290d71c68e8.jpg" alt></p><p>è¾“å…¥ç”¨æˆ·åå¯†ç åç‚¹å‡»ç™»å½•</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/6d/548f70b5aba6e4399e06ae288adfa9.jpg" alt></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œç™»é™†æˆåŠŸï¼Œåœ°å€æ˜¯<code>http://devops.iamzhl.top:83/projects</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/e1/463c767ddd0147ed54fba65d91a0f7.jpg" alt></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç‚¹å‡»æ³¨é”€ï¼Œå°±ä¼šç™»å‡ºå¹¶è·³è½¬è‡³<code>CAS</code>çš„ç™»å‡ºç•Œé¢</p><p><img src="https://gitee.com/athlonreg/picbed/raw/master/Images/e9/a067be6a85ec888bc9ab25bcf0d0e7.jpg" alt></p><p>è‡³æ­¤ï¼Œ<code>SonarQube</code>æ•´åˆ<code>CAS</code>å•ç‚¹ç™»å½•å®Œæˆã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      SonarQube æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="CAS" scheme="https://iamzhl.top/tags/CAS/"/>
    
      <category term="LDAP" scheme="https://iamzhl.top/tags/LDAP/"/>
    
      <category term="SonarQube" scheme="https://iamzhl.top/tags/SonarQube/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins æ•´åˆ LDAP ä»¥åŠ CAS å•ç‚¹ç™»å½•</title>
    <link href="https://iamzhl.top/Jenkins-integrate-with-ldap-and-CAS.html"/>
    <id>https://iamzhl.top/Jenkins-integrate-with-ldap-and-CAS.html</id>
    <published>2018-11-30T02:17:09.000Z</published>
    <updated>2019-03-11T16:21:49.895Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h2><ul><li>Jenkins ç‰ˆæœ¬ï¼š2.138.3</li><li>Jenkins å®‰è£…æ–¹å¼ï¼š Tomcat å®¹å™¨éƒ¨ç½² war åŒ…</li><li>Jenkins åœ°å€ï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgwODAvamVua2lucw==" title="http://devops.iamzhl.top:8080/jenkins">http://devops.iamzhl.top:8080/jenkins<i class="fa fa-external-link"></i></span></li><li>openLDAP æœåŠ¡ï¼šldap://devops.iamzhl.top:389</li><li>CAS æœåŠ¡ï¼š<span class="exturl" data-url="aHR0cDovL2Rldm9wcy5pYW16aGwudG9wOjgwODAvY2Fz" title="http://devops.iamzhl.top:8080/cas">http://devops.iamzhl.top:8080/cas<i class="fa fa-external-link"></i></span></li></ul><h2 id="æ•´åˆ-openLDAP"><a href="#æ•´åˆ-openLDAP" class="headerlink" title="æ•´åˆ openLDAP"></a>æ•´åˆ openLDAP</h2><p>é¦–å…ˆå» Jenkins æ’ä»¶å®˜ç½‘ä¸‹è½½ LDAP å’Œ CAS æ’ä»¶</p><ul><li>LDAPï¼š<span class="exturl" data-url="aHR0cHM6Ly91cGRhdGVzLmplbmtpbnMuaW8vZG93bmxvYWQvcGx1Z2lucy9sZGFwLw==" title="https://updates.jenkins.io/download/plugins/ldap/">https://updates.jenkins.io/download/plugins/ldap/<i class="fa fa-external-link"></i></span></li><li>CASï¼š<span class="exturl" data-url="aHR0cHM6Ly91cGRhdGVzLmplbmtpbnMuaW8vZG93bmxvYWQvcGx1Z2lucy9jYXMtcGx1Z2luLw==" title="https://updates.jenkins.io/download/plugins/cas-plugin/">https://updates.jenkins.io/download/plugins/cas-plugin/<i class="fa fa-external-link"></i></span></li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/46/53fb1f3e3cfa00c055965bc99c7fbd.jpg" alt></p><p>å¦‚å›¾ï¼Œç‚¹å‡»<code>ç³»ç»Ÿç®¡ç†</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/86/4f0c2ebaef58a3c719397b0adfbc5b.jpg" alt></p><p>ç‚¹å‡»æ’ä»¶ç®¡ç† -&gt; é«˜çº§ -&gt; ä¸Šä¼ æ’ä»¶(é€‰æ‹©æ–‡ä»¶)</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/65/bfd2b91d856ca8132434b2da51de6e.jpg" alt></p><p>å¼¹å‡ºé€‰æ‹©æ–‡ä»¶çš„å¯¹è¯æ¡†åï¼Œé¦–å…ˆé€‰æ‹©æˆ‘ä»¬ä¸‹è½½å¥½çš„ LDAP æ’ä»¶ï¼Œç„¶åç‚¹å‡»ä¸Šä¼ ï¼Œç„¶åå°±ä¼šè·³è½¬åˆ°å®‰è£…ç•Œé¢ï¼Œæˆ‘ä»¬å‹¾é€‰<code>å®‰è£…å®Œæˆåé‡å¯Jenkins(ç©ºé—²æ—¶)</code>ï¼Œç­‰å¾…ä¸€ä¼šJenkinså®‰è£…æ’ä»¶å®Œæˆåå°±ä¼šé‡å¯</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/c5/7cf7ef11ecd49b19b07ea7333cc26a.jpg" alt></p><p>è¾“å…¥ç”¨æˆ·åå¯†ç ç™»å½•åï¼Œä¾æ¬¡æ‰“å¼€<code>ç³»ç»Ÿç®¡ç†</code> -&gt; <code>å…¨å±€å®‰å…¨é…ç½®</code>ï¼Œåœ¨å®‰å…¨åŸŸå‹¾é€‰ LDAPï¼Œç‚¹å‡»<code>Advanced Server Configuration</code>,å¼€å§‹é…ç½® LDAP æœåŠ¡å™¨çš„ç»‘å®šä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/12/adf30303385802ce2fc45d175a7d16.jpg" alt></p><p>ç‚¹å‡»<code>Test LDAP settings</code>ï¼Œæµ‹è¯•<code>LDAP</code>é…ç½®æ˜¯å¦å¯ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼Œè¾“å…¥ä¸€ä¸ª<code>LDAP</code>æœåŠ¡å™¨ä¸­å­˜åœ¨çš„ç”¨æˆ·è´¦å·å’Œå¯†ç ï¼Œç‚¹å‡»<code>Test</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/93/bca0bd8c0ac21d1b2c4cffd7cea3bc.jpg" alt></p><p>å¦‚æœæµ‹è¯•æˆåŠŸï¼Œä¼šæ‰“å°å‡ºç±»ä¼¼å¦‚ä¸‹çš„ä¿¡æ¯</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/f5/7453c8051a55d9622dbe1e461d1b25.jpg" alt></p><p>ç‚¹å‡»<code>åº”ç”¨</code>ï¼Œç„¶åç‚¹å‡»<code>ä¿å­˜</code>ã€‚</p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œç”¨<code>LDAP</code>ä¸­çš„ç”¨æˆ·è¿›è¡Œç™»å½•</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/1e/46a5ac15c7611eff4ade4830966565.jpg" alt></p><p>ç™»é™†æˆåŠŸï¼Œé…ç½®å®Œæˆï¼Œåˆ°è¿™é‡Œï¼Œ<code>Jenkins</code>æ•´åˆ<code>LDAP</code>è®¤è¯å°±å®Œæˆäº†ã€‚</p><h2 id="æ•´åˆ-CAS-å•ç‚¹ç™»å½•"><a href="#æ•´åˆ-CAS-å•ç‚¹ç™»å½•" class="headerlink" title="æ•´åˆ CAS å•ç‚¹ç™»å½•"></a>æ•´åˆ CAS å•ç‚¹ç™»å½•</h2><p>é¦–å…ˆå®‰è£…<code>CAS</code>æ’ä»¶ï¼Œå’Œä¸Šé¢å®‰è£…<code>LDAP</code>æ’ä»¶æ­¥éª¤ä¸€æ ·ï¼Œå®‰è£…å®Œ<code>CAS</code>æ‰“å¼€<code>ç³»ç»Ÿç®¡ç†</code> -&gt; <code>å…¨å±€å®‰å…¨é…ç½®</code>ï¼Œåœ¨å®‰å…¨åŸŸå‹¾é€‰<code>CAS (Central Authentication Service)</code>ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œé…ç½®å¥½<code>CAS</code>çš„<code>URL</code>å’Œ<code>CAS åè®®</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b7/99ca653df5281634fed8a6dcc4f3c2.jpg" alt></p><p>ç„¶åç‚¹å‡»<code>åº”ç”¨</code>-&gt;<code>ä¿å­˜</code>ï¼Œæ³¨é”€ï¼Œç„¶åé‡æ–°ç™»å½•</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/ce/bf7939fceebf45806037fd759179f4.jpg" alt></p><p>è¿™æ—¶å°±å¯ä»¥è·³è½¬åˆ°<code>CAS</code>çš„ç™»å½•ç•Œé¢äº†ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ç‚¹å‡»ç™»å½•ï¼Œå°±å¯ä»¥æ­£å¸¸çš„ç™»å½•è¿›å…¥<code>Jenkins</code>ç³»ç»Ÿäº†ã€‚</p><p>è‡³æ­¤ï¼Œ<code>Jenkins</code>æ•´åˆ<code>CAS</code>å®Œæˆã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      Jenkins æ•´åˆ LDAP ä»¥åŠ CAS å•ç‚¹ç™»å½•
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="CAS" scheme="https://iamzhl.top/tags/CAS/"/>
    
      <category term="Jenkins" scheme="https://iamzhl.top/tags/Jenkins/"/>
    
      <category term="LDAP" scheme="https://iamzhl.top/tags/LDAP/"/>
    
  </entry>
  
  <entry>
    <title>shadowsocks-libev</title>
    <link href="https://iamzhl.top/shadowsocks-libev.html"/>
    <id>https://iamzhl.top/shadowsocks-libev.html</id>
    <published>2018-11-25T09:39:40.000Z</published>
    <updated>2019-03-11T16:21:49.905Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ul><li>å›½å¤–æœåŠ¡å™¨ä¸€å°</li><li>CentOS æ“ä½œç³»ç»Ÿ</li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install pcre pcre-devel git wget gcc gcc-c++</span></span><br><span class="line"><span class="comment"># cd ~ &amp;&amp; git clone https://github.com/shadowsocks/shadowsocks-libev.git</span></span><br><span class="line"><span class="comment"># cd shadowsocks-libev &amp;&amp; git submodule update --init --recursive</span></span><br><span class="line"><span class="comment"># yum install gettext gcc autoconf libtool automake make asciidoc xmlto c-ares-devel libev-devel</span></span><br><span class="line"><span class="comment"># echo "LIBSODIUM_VER=1.0.13" &gt;&gt; /etc/profile</span></span><br><span class="line"><span class="comment"># source /etc/profile</span></span><br><span class="line"><span class="comment"># cd ~</span></span><br><span class="line"><span class="comment"># wget https://download.libsodium.org/libsodium/releases/LATEST.tar.gz</span></span><br><span class="line"><span class="comment"># tar zxvf LATEST.tar.gz</span></span><br><span class="line"><span class="comment"># pushd libsodium-stable</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr &amp;&amp; make</span></span><br><span class="line"><span class="comment"># make install</span></span><br><span class="line"><span class="comment"># popd</span></span><br><span class="line"><span class="comment"># ldconfig</span></span><br><span class="line"><span class="comment"># echo "export MBEDTLS_VER=2.6.0" &gt;&gt; /etc/profile</span></span><br><span class="line"><span class="comment"># source /etc/profile</span></span><br><span class="line"><span class="comment"># cd ~ &amp;&amp; wget wget https://tls.mbed.org/download/mbedtls-2.14.0-apache.tgz</span></span><br><span class="line"><span class="comment"># tar xvf mbedtls-2.14.0-apache.tgz</span></span><br><span class="line"><span class="comment"># pushd mbedtls-2.14.0</span></span><br><span class="line"><span class="comment"># make SHARED=1 CFLAGS=-fPIC</span></span><br><span class="line"><span class="comment"># make DESTDIR=/usr install</span></span><br><span class="line"><span class="comment"># popd</span></span><br><span class="line"><span class="comment"># ldconfig</span></span><br><span class="line"><span class="comment"># cd shadowsocks-libev &amp;&amp; ./autogen.sh &amp;&amp; ./configure &amp;&amp; make</span></span><br><span class="line"><span class="comment"># make install</span></span><br><span class="line"><span class="comment"># cd /usr/local &amp;&amp;  wget  https://nchc.dl.sourceforge.net/project/pcre/pcre/8.41/pcre-8.41.tar.gz</span></span><br><span class="line"><span class="comment"># tar -zxvf  pcre-8.41.tar.gz</span></span><br><span class="line"><span class="comment"># cd pcre-8.41 &amp;&amp; ./configure &amp;&amp; make</span></span><br><span class="line"><span class="comment"># make install</span></span><br><span class="line"><span class="comment"># cd /usr/local &amp;&amp; mkdir ssr &amp;&amp; cd ssr</span></span><br><span class="line"><span class="comment"># vi conf.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="attr">"server"</span>:<span class="string">"your server ip"</span>,</span><br><span class="line">        <span class="attr">"server_port"</span>:<span class="number">7788</span>,</span><br><span class="line">        <span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line">        <span class="attr">"password"</span>:<span class="string">"your password for ssr"</span>,</span><br><span class="line">        <span class="attr">"timeout"</span>:<span class="number">60</span>,</span><br><span class="line">        <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ss-server -c /usr/local/ssr/conf.conf //è¿è¡Œ</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/d4/6463c41c237e134ade8219c099db8e.jpg" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /usr/local/bin &amp;&amp; vi ssr //åˆ©ç”¨è„šæœ¬åå°è¿è¡Œ</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">nohup ss-server -c /usr/local/ssr/conf.conf &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod +x /usr/local/bin/ssr</span></span><br><span class="line"><span class="comment"># ssr</span></span><br><span class="line"><span class="comment"># ps ax | grep ssr</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a4/ef69a4b5a7ca6de17e5744064ba11d.jpg" alt></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      shadowsocks-libev
    
    </summary>
    
      <category term="study" scheme="https://iamzhl.top/categories/study/"/>
    
    
      <category term="shadowsocks" scheme="https://iamzhl.top/tags/shadowsocks/"/>
    
  </entry>
  
  <entry>
    <title>CentOSå®‰è£…éƒ¨ç½² openLDAP</title>
    <link href="https://iamzhl.top/CentOS-install-openLDAP.html"/>
    <id>https://iamzhl.top/CentOS-install-openLDAP.html</id>
    <published>2018-11-24T14:17:41.000Z</published>
    <updated>2019-03-11T16:21:49.884Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>OpenLDAP æ˜¯è½»å‹ç›®å½•è®¿é—®åè®®<code>Lightweight Directory Access Protocol</code> - <code>LDAP</code>çš„è‡ªç”±å’Œå¼€æºçš„å®ç°ï¼Œåœ¨å…¶<code>OpenLDAP</code>è®¸å¯è¯ä¸‹å‘è¡Œï¼Œå¹¶å·²ç»è¢«åŒ…å«åœ¨ä¼—å¤šæµè¡Œçš„<code>Linux</code>å‘è¡Œç‰ˆä¸­ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd ~</span></span><br><span class="line"><span class="comment"># yum -y install openldap-servers openldap-clients</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/1c/02ad1e703c7187295361dbff3fad9c.jpg" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></span><br><span class="line"><span class="comment"># chown ldap:ldap /var/lib/ldap/DB_CONFIG</span></span><br><span class="line"><span class="comment"># systemctl start slapd</span></span><br><span class="line"><span class="comment"># systemctl enable slapd</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># slappasswd</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/75/c5c970bd59e02ac7434f217a5f27a6.jpg" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi chrootpw.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># specify the password generated above for &quot;olcRootPW&quot; section</span><br><span class="line">dn: olcDatabase=&#123;0&#125;config,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcRootPW</span><br><span class="line">olcRootPW: &#123;SSHA&#125;xxxxxxxxxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif</span></span><br></pre></td></tr></table></figure><h2 id="å¯¼å…¥åŸºæœ¬æ¨¡å¼"><a href="#å¯¼å…¥åŸºæœ¬æ¨¡å¼" class="headerlink" title="å¯¼å…¥åŸºæœ¬æ¨¡å¼"></a>å¯¼å…¥åŸºæœ¬æ¨¡å¼</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif </span></span><br><span class="line"><span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif </span></span><br><span class="line"><span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif</span></span><br></pre></td></tr></table></figure><h2 id="åœ¨ldapçš„DBä¸­è®¾ç½®åŸŸå"><a href="#åœ¨ldapçš„DBä¸­è®¾ç½®åŸŸå" class="headerlink" title="åœ¨ldapçš„DBä¸­è®¾ç½®åŸŸå"></a>åœ¨ldapçš„DBä¸­è®¾ç½®åŸŸå</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># slappasswd</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/de/9a4502a39d572493b8ae8d723a08ef.jpg" alt></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi chdomain.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># replace to your own domain name for &quot;dc=***,dc=***&quot; section</span><br><span class="line"># specify the password generated above for &quot;olcRootPW&quot; section</span><br><span class="line">dn: olcDatabase=&#123;1&#125;monitor,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;</span><br><span class="line">  read by dn.base=&quot;cn=Manager,dc=iamzhl,dc=top&quot; read by * none</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcSuffix</span><br><span class="line">olcSuffix: dc=iamzhl,dc=top</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcRootDN</span><br><span class="line">olcRootDN: cn=Manager,dc=iamzhl,dc=top</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcRootPW</span><br><span class="line">olcRootPW: &#123;SSHA&#125;xxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to attrs=userPassword,shadowLastChange by</span><br><span class="line">  dn=&quot;cn=Manager,dc=iamzhl,dc=top&quot; write by anonymous auth by self write by * none</span><br><span class="line">olcAccess: &#123;1&#125;to dn.base=&quot;&quot; by * read</span><br><span class="line">olcAccess: &#123;2&#125;to * by dn=&quot;cn=Manager,dc=iamzhl,dc=top&quot; write by * read</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi basedomain.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># replace to your own domain name for &quot;dc=***,dc=***&quot; section</span><br><span class="line">dn: dc=iamzhl,dc=top</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectclass: organization</span><br><span class="line">o: iamzhl</span><br><span class="line">dc: iamzhl</span><br><span class="line"></span><br><span class="line">dn: cn=Manager,dc=iamzhl,dc=top</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">cn: Manager</span><br><span class="line">description: Directory Manager</span><br><span class="line"></span><br><span class="line">dn: ou=People,dc=iamzhl,dc=top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: People</span><br><span class="line"></span><br><span class="line">dn: ou=Group,dc=iamzhl,dc=top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: Group</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ldapadd -x -D cn=Manager,dc=iamzhl,dc=top -W -f basedomain.ldif</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/d1/46842e7f601199c0f78da4d97d30ad.jpg" alt></p><h2 id="æ·»åŠ ä¸€ä¸ªç”¨æˆ·"><a href="#æ·»åŠ ä¸€ä¸ªç”¨æˆ·" class="headerlink" title="æ·»åŠ ä¸€ä¸ªç”¨æˆ·"></a>æ·»åŠ ä¸€ä¸ªç”¨æˆ·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># slappasswd </span></span><br><span class="line"><span class="comment"># vi ldapuser.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># create new</span><br><span class="line"># replace to your own domain name for &quot;dc=***,dc=***&quot; section</span><br><span class="line">dn: uid=cent,ou=People,dc=iamzhl,dc=top</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">cn: Cent</span><br><span class="line">sn: Linux</span><br><span class="line">userPassword: &#123;SSHA&#125;xxxxxxxxxxxxxxxxx</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1000</span><br><span class="line">gidNumber: 1000</span><br><span class="line">homeDirectory: /home/cent</span><br><span class="line"></span><br><span class="line">dn: cn=cent,ou=Group,dc=iamzhl,dc=top</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">cn: Cent</span><br><span class="line">gidNumber: 1000</span><br><span class="line">memberUid: cent</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ldapadd -x -D cn=Manager,dc=iamzhl,dc=top -W -f ldapuser.ldif</span></span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ æœ¬æœºçš„ç”¨æˆ·å’Œç¾¤ç»„åˆ°ldapç›®å½•"><a href="#æ·»åŠ æœ¬æœºçš„ç”¨æˆ·å’Œç¾¤ç»„åˆ°ldapç›®å½•" class="headerlink" title="æ·»åŠ æœ¬æœºçš„ç”¨æˆ·å’Œç¾¤ç»„åˆ°ldapç›®å½•"></a>æ·»åŠ æœ¬æœºçš„ç”¨æˆ·å’Œç¾¤ç»„åˆ°ldapç›®å½•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi ldapuser.sh</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> extract <span class="built_in">local</span> users and groups who have 1000-9999 digit UID</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replace <span class="string">"SUFFIX=***"</span> to your own domain name</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this is an example</span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">SUFFIX='dc=iamzhl,dc=top'</span><br><span class="line">LDIF='ldapuser.ldif'</span><br><span class="line"></span><br><span class="line">echo -n &gt; $LDIF</span><br><span class="line">GROUP_IDS=()</span><br><span class="line">grep "x:[1-9][0-9][0-9][0-9]:" /etc/passwd | (while read TARGET_USER</span><br><span class="line">do</span><br><span class="line">    USER_ID="$(echo "$TARGET_USER" | cut -d':' -f1)"</span><br><span class="line"></span><br><span class="line">    USER_NAME="$(echo "$TARGET_USER" | cut -d':' -f5 | cut -d' ' -f1,2)"</span><br><span class="line">    [ ! "$USER_NAME" ] &amp;&amp; USER_NAME="$USER_ID"</span><br><span class="line"></span><br><span class="line">    LDAP_SN="$(echo "$USER_NAME" | cut -d' ' -f2)"</span><br><span class="line">    [ ! "$LDAP_SN" ] &amp;&amp; LDAP_SN="$USER_NAME"</span><br><span class="line"></span><br><span class="line">    LASTCHANGE_FLAG="$(grep "$&#123;USER_ID&#125;:" /etc/shadow | cut -d':' -f3)"</span><br><span class="line">    [ ! "$LASTCHANGE_FLAG" ] &amp;&amp; LASTCHANGE_FLAG="0"</span><br><span class="line"></span><br><span class="line">    SHADOW_FLAG="$(grep "$&#123;USER_ID&#125;:" /etc/shadow | cut -d':' -f9)"</span><br><span class="line">    [ ! "$SHADOW_FLAG" ] &amp;&amp; SHADOW_FLAG="0"</span><br><span class="line"></span><br><span class="line">    GROUP_ID="$(echo "$TARGET_USER" | cut -d':' -f4)"</span><br><span class="line">    [ ! "$(echo "$&#123;GROUP_IDS[@]&#125;" | grep "$GROUP_ID")" ] &amp;&amp; GROUP_IDS=("$&#123;GROUP_IDS[@]&#125;" "$GROUP_ID")</span><br><span class="line"></span><br><span class="line">    echo "dn: uid=$USER_ID,ou=People,$SUFFIX" &gt;&gt; $LDIF</span><br><span class="line">    echo "objectClass: inetOrgPerson" &gt;&gt; $LDIF</span><br><span class="line">    echo "objectClass: posixAccount" &gt;&gt; $LDIF</span><br><span class="line">    echo "objectClass: shadowAccount" &gt;&gt; $LDIF</span><br><span class="line">    echo "sn: $LDAP_SN" &gt;&gt; $LDIF</span><br><span class="line">    echo "givenName: $(echo "$USER_NAME" | awk '&#123;print $1&#125;')" &gt;&gt; $LDIF</span><br><span class="line">    echo "cn: $USER_NAME" &gt;&gt; $LDIF</span><br><span class="line">    echo "displayName: $USER_NAME" &gt;&gt; $LDIF</span><br><span class="line">    echo "uidNumber: $(echo "$TARGET_USER" | cut -d':' -f3)" &gt;&gt; $LDIF</span><br><span class="line">    echo "gidNumber: $(echo "$TARGET_USER" | cut -d':' -f4)" &gt;&gt; $LDIF</span><br><span class="line">    echo "userPassword: &#123;crypt&#125;$(grep "$&#123;USER_ID&#125;:" /etc/shadow | cut -d':' -f2)" &gt;&gt; $LDIF</span><br><span class="line">    echo "gecos: $USER_NAME" &gt;&gt; $LDIF</span><br><span class="line">    echo "loginShell: $(echo "$TARGET_USER" | cut -d':' -f7)" &gt;&gt; $LDIF</span><br><span class="line">    echo "homeDirectory: $(echo "$TARGET_USER" | cut -d':' -f6)" &gt;&gt; $LDIF</span><br><span class="line">    echo "shadowExpire: $(passwd -S "$USER_ID" | awk '&#123;print $7&#125;')" &gt;&gt; $LDIF</span><br><span class="line">    echo "shadowFlag: $SHADOW_FLAG" &gt;&gt; $LDIF</span><br><span class="line">    echo "shadowWarning: $(passwd -S "$USER_ID" | awk '&#123;print $6&#125;')" &gt;&gt; $LDIF</span><br><span class="line">    echo "shadowMin: $(passwd -S "$USER_ID" | awk '&#123;print $4&#125;')" &gt;&gt; $LDIF</span><br><span class="line">    echo "shadowMax: $(passwd -S "$USER_ID" | awk '&#123;print $5&#125;')" &gt;&gt; $LDIF</span><br><span class="line">    echo "shadowLastChange: $LASTCHANGE_FLAG" &gt;&gt; $LDIF</span><br><span class="line">    echo &gt;&gt; $LDIF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for TARGET_GROUP_ID in "$&#123;GROUP_IDS[@]&#125;"</span><br><span class="line">do</span><br><span class="line">    LDAP_CN="$(grep ":$&#123;TARGET_GROUP_ID&#125;:" /etc/group | cut -d':' -f1)"</span><br><span class="line"></span><br><span class="line">    echo "dn: cn=$LDAP_CN,ou=Group,$SUFFIX" &gt;&gt; $LDIF</span><br><span class="line">    echo "objectClass: posixGroup" &gt;&gt; $LDIF</span><br><span class="line">    echo "cn: $LDAP_CN" &gt;&gt; $LDIF</span><br><span class="line">    echo "gidNumber: $TARGET_GROUP_ID" &gt;&gt; $LDIF</span><br><span class="line"></span><br><span class="line">    for MEMBER_UID in $(grep ":$&#123;TARGET_GROUP_ID&#125;:" /etc/passwd | cut -d':' -f1,3)</span><br><span class="line">    do</span><br><span class="line">        UID_NUM=$(echo "$MEMBER_UID" | cut -d':' -f2)</span><br><span class="line">        [ $UID_NUM -ge 1000 -a $UID_NUM -le 9999 ] &amp;&amp; echo "memberUid: $(echo "$MEMBER_UID" | cut -d':' -f1)" &gt;&gt; $LDIF</span><br><span class="line">    done</span><br><span class="line">    echo &gt;&gt; $LDIF</span><br><span class="line">done</span><br><span class="line">)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sh ldapuser.sh </span></span><br><span class="line"><span class="comment"># ldapadd -x -D cn=Manager,dc=iamzhl,dc=top -W -f ldapuser.ldif</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/d5/aaa70f4f22ad6ee40fa74bf027bd4b.jpg" alt></p><h2 id="åˆ©ç”¨Apache-Directory-Studioè¿›è¡Œç®¡ç†"><a href="#åˆ©ç”¨Apache-Directory-Studioè¿›è¡Œç®¡ç†" class="headerlink" title="åˆ©ç”¨Apache Directory Studioè¿›è¡Œç®¡ç†"></a>åˆ©ç”¨Apache Directory Studioè¿›è¡Œç®¡ç†</h2><p>Apache Directory Studio æ˜¯ä¸€ä¸ª LDAP çš„å·¥å…·å¹³å°ï¼Œç”¨æ¥è¿æ¥åˆ°ä»»ä½• LDAP æœåŠ¡å™¨å¹¶è¿›è¡Œç®¡ç†å’Œå¼€å‘å·¥ä½œã€‚å…¶å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>LDAPæµè§ˆå™¨</li><li>LDIFç¼–è¾‘å™¨</li><li>åµŒå…¥å¼ ApacheDS</li><li>ACIç¼–è¾‘å™¨</li><li>å±æ€§ç®¡ç†</li></ul><p>ä¸‹é¢ä»¥æ–°å»ºè¿æ¥å’Œæ–°å¢ç”¨æˆ·ä¸ºä¾‹è¿›è¡Œæ¼”ç¤º</p><p>å¦‚å›¾ï¼Œç‚¹å‡» New Connection æ–°å»ºä¸€ä¸ª ldap è¿æ¥</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/12/d782ef026127039c48173727402ae1.jpg" alt></p><p>ä¾æ¬¡è¾“å…¥è¿æ¥åã€ä¸»æœºåä»¥åŠç«¯å£å·åç‚¹å‡»<code>Next</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b4/8238cc5d14bd32906fb1bf4d2fb726.jpg" alt></p><p>å†ä¾æ¬¡è¾“å…¥ç»‘å®šçš„<code>DN</code>å’Œå¯†ç åç‚¹å‡»<code>Finish</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/6d/33932a9dccd444922051239295a40e.jpg" alt></p><p>æ–°å»ºä¸€ä¸ª openLDAP ç”¨æˆ· test / 123456</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/0e/e69bb807212cc32a80cb28c4b927e1.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/01/ab9d40ac8d216e3e2b99a287082fa7.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/14/de8c6a3b3854b28bca29d84e338f9f.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/53/287f9a9a0cfe1c25c3c66d775fb214.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/af/af3a63b732070ac51f27b10f6e2dca.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b3/da28177e70ab2cb77421d6ae16ca95.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/70/749184f3907b06951093fc2a944e42.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/c0/5ddca5f311e7f8b2ba598480c3636e.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/e7/8a989532254213ac72efc235676a2a.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/2e/ebca96c81bd780e9b90d9bdbd3415a.jpg" alt></p><h2 id="Credits"><a href="#Credits" class="headerlink" title="Credits"></a>Credits</h2><p>æœ¬æ–‡å¤šå¤„å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlbndlbnhpb25nL2FydGljbGUvZGV0YWlscy83Njg1NTA0Nw==" title="https://blog.csdn.net/wenwenxiong/article/details/76855047">centos7ä¸‹ldapæœåŠ¡æ­å»º<i class="fa fa-external-link"></i></span>ï¼Œæ„Ÿè°¢<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlbndlbnhpb25n" title="https://blog.csdn.net/wenwenxiong">wenwenxiong<i class="fa fa-external-link"></i></span>çš„åˆ†äº«ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      CentOSå®‰è£…éƒ¨ç½² openLDAP
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="openLDAP" scheme="https://iamzhl.top/tags/openLDAP/"/>
    
  </entry>
  
  <entry>
    <title>CAS 5.3.4 å®‰è£…éƒ¨ç½²</title>
    <link href="https://iamzhl.top/CAS-5-3-4-install-and-deploy.html"/>
    <id>https://iamzhl.top/CAS-5-3-4-install-and-deploy.html</id>
    <published>2018-11-24T12:59:49.000Z</published>
    <updated>2019-03-11T16:21:49.883Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>CAS</code>å…¨ç§°<code>Central Authentication Service</code>ï¼Œä¸­å¤®è®¤è¯æœåŠ¡ï¼Œä¸€ç§ç‹¬ç«‹å¼€æ”¾æŒ‡ä»¤åè®®ã€‚CAS æ˜¯ Yale å¤§å­¦å‘èµ·çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨ä¸º Web åº”ç”¨ç³»ç»Ÿæä¾›ä¸€ç§å¯é çš„å•ç‚¹ç™»å½•æ–¹æ³•ï¼ŒCAS åœ¨ 2004 å¹´ 12 æœˆæ­£å¼æˆä¸º JA-SIG çš„ä¸€ä¸ªé¡¹ç›®ï¼Œç›®å‰æ˜¯ä¸€ç§ä¼ä¸šçº§çš„å•ç‚¹ç™»å½•è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="åè®®ä»‹ç»"><a href="#åè®®ä»‹ç»" class="headerlink" title="åè®®ä»‹ç»"></a>åè®®ä»‹ç»</h2><p>å…³äº oauth2.0 çš„åŸç†åŠä»‹ç»å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTQvMDUvb2F1dGhfMl8wLmh0bWw=" title="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">ç†è§£OAuth 2.0 - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—<i class="fa fa-external-link"></i></span>ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚</p><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p><code>CAS</code>æ˜¯åŸºäºSpringå†™çš„ï¼Œå› æ­¤éœ€è¦å‡†å¤‡Javaç¯å¢ƒï¼Œå®˜æ–¹æä¾›äº†ä¸€ç§éå¸¸å¥½ç”¨çš„ç¼–è¯‘æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å†³å®šä¾èµ–çš„é€‰æ‹©ï¼Œæœ¬æ–‡ä¸»è¦ä»¥openLDAPå’Œoauthä¸ºä¾‹ã€‚ç¼–è¯‘æ—¶éœ€è¦mavenç¯å¢ƒã€‚è¿è¡Œæ—¶éœ€è¦ Tomcat å®¹å™¨ï¼Œå› æ­¤éœ€è¦æå‰å‡†å¤‡å¥½ Tomcat ç¯å¢ƒã€‚åç»­æˆ‘ä»¬ä¼šæ•´åˆ openLDAP åšç»Ÿä¸€ç”¨æˆ·ç®¡ç†ï¼Œå› æ­¤è¯·å…ˆå®‰è£…å¥½ openLDAPã€‚</p><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><p>é¦–å…ˆå»é¡¹ç›®åœ°å€ä¸‹è½½ç¼–è¯‘æ¨¡æ¿</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/apereo/cas-overlay-template</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git clone https://github.com/apereo/cas-overlay-template</span></span><br><span class="line"><span class="comment"># cd cas-overlay-template</span></span><br><span class="line"><span class="comment"># vi pom.xml</span></span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ä¸‹é¢çš„éƒ¨åˆ†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-webapp$&#123;app.server&#125;&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;type&gt;war&lt;/type&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    ...Additional dependencies may be placed here...</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>å°†æ³¨é‡Šçš„éƒ¨åˆ†æ›¿æ¢ä¸ºæˆ‘ä»¬éœ€è¦çš„æ¨¡å—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-webapp$&#123;app.server&#125;&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;type&gt;war&lt;/type&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-oauth-webflow&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;mysql.driver.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-jdbc&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-jdbc-drivers&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-rest&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-ldap&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-jpa-ticket-registry&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-jpa-service-registry&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-rest-services&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apereo.cas&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;cas-server-support-json-service-registry&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;cas.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­ä¸­æˆ‘æ·»åŠ äº†openLDAP oauth2.0 mysqlçš„ä¾èµ–ï¼Œå…·ä½“è¯·æŒ‰ç…§è‡ªå·±éœ€æ±‚é€‰æ‹©ã€‚</p><p>ç¼–è¾‘å¥½pomæ–‡ä»¶åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¼€å§‹ç¼–è¯‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mvn clean package</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/42/20e1a20a856b8d98083544240e949b.jpg" alt></p><p>è¿‡ç¨‹å¾ˆé•¿ï¼Œéœ€è¦è”ç½‘ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç¼–è¯‘å®Œæˆåï¼Œä¼šåœ¨æ­¤ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª target ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦çš„ war åŒ…å°±åœ¨é‡Œé¢ã€‚</p><h2 id="å®‰è£…æµ‹è¯•"><a href="#å®‰è£…æµ‹è¯•" class="headerlink" title="å®‰è£…æµ‹è¯•"></a>å®‰è£…æµ‹è¯•</h2><p>å®‰è£…è¿‡ç¨‹å°±æ¯”è¾ƒç®€å•äº†ï¼Œå°† war åŒ…ä¿å­˜è‡³ Tomcat ä¸‹ webapps ç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œ Tomcat å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># startup.sh</span></span><br><span class="line"><span class="comment"># tail -f /usr/local/tomcat/logs/catalina.out</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b7/bfb043dc833a972751ad396ccc63c5.jpg" alt></p><p>è¿è¡Œå®Œæˆåæ—¥å¿—å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç„¶åæˆ‘ä»¬æ‰“å¼€ <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDgwL2Nhcw==" title="http://localhost:8080/cas">http://localhost:8080/cas<i class="fa fa-external-link"></i></span></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/91/6097314bc496dd2404ecc7ccac8a28.jpg" alt></p><p>é»˜è®¤çš„ç”¨æˆ·åå¯†ç ä¸º casuser / Mellonï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ç‚¹å‡»ç™»å½•ï¼Œç™»å½•æˆåŠŸåå¦‚å›¾è·³è½¬è‡³ç™»å½•æˆåŠŸé¡µé¢</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/41/4c9e1c4a3a9632ffd3475df7798005.jpg" alt></p><p>å®‰è£…è‡³æ­¤å®Œæˆ</p><h2 id="å¼€å¯-oauth-2-0-æˆæƒ"><a href="#å¼€å¯-oauth-2-0-æˆæƒ" class="headerlink" title="å¼€å¯ oauth 2.0 æˆæƒ"></a>å¼€å¯ oauth 2.0 æˆæƒ</h2><blockquote><p>application.properties å¢åŠ é…ç½®æ–‡ä»¶å¦‚ä¸‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/tomcat/webapps/cas/WEB-INF/classes/application.properties</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cas.authn.oauth.refreshToken.timeToKillInSeconds=2592000</span><br><span class="line">cas.authn.oauth.code.timeToKillInSeconds=30</span><br><span class="line">cas.authn.oauth.code.numberOfUses=1</span><br><span class="line">cas.authn.oauth.accessToken.releaseProtocolAttributes=true</span><br><span class="line">cas.authn.oauth.accessToken.timeToKillInSeconds=7200</span><br><span class="line">cas.authn.oauth.accessToken.maxTimeToLiveInSeconds=28800</span><br><span class="line">cas.authn.oauth.grants.resourceOwner.requireServiceHeader=true</span><br><span class="line">cas.authn.oauth.userProfileViewType=NESTED</span><br></pre></td></tr></table></figure><blockquote><p>å¢åŠ  OAUTH-1002.json service æ³¨å†Œæ–‡ä»¶</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/tomcat/webapps/cas/WEB-INF/classes/servies/OAUTH-1002.json</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;@class&quot; : &quot;org.apereo.cas.support.oauth.services.OAuthRegisteredService&quot;,</span><br><span class="line">  &quot;clientId&quot;: &quot;20181124&quot;,</span><br><span class="line">  &quot;clientSecret&quot;: &quot;123456&quot;,</span><br><span class="line">  &quot;serviceId&quot; : &quot;^(https|http|imaps)://.*&quot;,</span><br><span class="line">  &quot;name&quot; : &quot;OAuthService&quot;,</span><br><span class="line">  &quot;id&quot; : 1002</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯ Tomcat æµ‹è¯•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shutdown.sh                   </span></span><br><span class="line">Using CATALINA_BASE:   /usr/<span class="built_in">local</span>/tomcat</span><br><span class="line">Using CATALINA_HOME:   /usr/<span class="built_in">local</span>/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /usr/<span class="built_in">local</span>/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /usr</span><br><span class="line">Using CLASSPATH:       /usr/<span class="built_in">local</span>/tomcat/bin/bootstrap.jar:/usr/<span class="built_in">local</span>/tomcat/bin/tomcat-juli.jar</span><br><span class="line"><span class="comment"># startup.sh </span></span><br><span class="line">Using CATALINA_BASE:   /usr/<span class="built_in">local</span>/tomcat</span><br><span class="line">Using CATALINA_HOME:   /usr/<span class="built_in">local</span>/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /usr/<span class="built_in">local</span>/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /usr</span><br><span class="line">Using CLASSPATH:       /usr/<span class="built_in">local</span>/tomcat/bin/bootstrap.jar:/usr/<span class="built_in">local</span>/tomcat/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>é‡å¯å®Œæˆåï¼Œæˆ‘ä»¬åˆ©ç”¨æœ¬åšå®¢ä½œä¸ºç›®æ ‡è®¿é—®ç½‘å€è¿›è¡Œæµ‹è¯•ï¼Œæµè§ˆå™¨æ‰“å¼€ <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDgwL2Nhcy9vYXV0aDIuMC9hdXRob3JpemU/cmVzcG9uc2VfdHlwZT1jb2RlJmFtcDtjbGllbnRfaWQ9MjAxODExMjQmYW1wO3JlZGlyZWN0X3VyaT1odHRwczovL2Jsb2cuaWFtemhsLnRvcA==" title="http://localhost:8080/cas/oauth2.0/authorize?response_type=code&amp;client_id=20181124&amp;redirect_uri=https://blog.iamzhl.top">http://localhost:8080/cas/oauth2.0/authorize?response_type=code&amp;client_id=20181124&amp;redirect_uri=https://blog.iamzhl.top<i class="fa fa-external-link"></i></span></p><p>å‘ç°è·³è½¬äº†ä¸€ä¸ªç¤ºä¾‹ç½‘å€</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b1/603980e19d03912f2c01b3a7c94b80.jpg" alt></p><p>è¿™æ—¶æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸‹ä¸¤ä¸ªå˜é‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/tomcat/webapps/cas/WEB-INF/classes/application.properties</span></span><br></pre></td></tr></table></figure><p>åŠ å…¥ä¸‹é¢ä¸¤è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cas.server.name=http://devops.iamzhl.top:8080/cas</span><br><span class="line">cas.server.prefix=$&#123;cas.server.name&#125;</span><br></pre></td></tr></table></figure><p>è¯·å°† devops.iamzhl.top æ”¹ä¸ºä½ çš„ ipï¼Œç„¶åé‡å¯ Tomcat å†æ¬¡æµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/66/574e93fdcc2b8ab686a46ec772627d.jpg" alt></p><p>è¿™æ¬¡èƒ½æ­£å¸¸è·³è½¬äº†ï¼Œä½†æ˜¯å‡ºç°äº†<code>æœªè®¤è¯æˆæƒçš„æœåŠ¡</code>ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¼€å¯ http åè®®æ”¯æŒï¼Œå› æ­¤åªè¦å†è®©æˆ‘ä»¬çš„ CAS Server æ”¯æŒ http è®¤è¯å°±è¡Œäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/tomcat/webapps/cas/WEB-INF/classes/application.properties</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ ä¸‹é¢ä¸¤è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cas.tgc.secure=false</span><br><span class="line">cas.serviceRegistry.initFromJson=true</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/tomcat/webapps/cas/WEB-INF/classes/services/HTTPSandIMAPS-10000001.json</span></span><br></pre></td></tr></table></figure><p>å°†<code>&quot;serviceId&quot; : &quot;^(https|imaps)://.*&quot;,</code>æ”¹ä¸º<code>&quot;serviceId&quot; : &quot;^(https|http|imaps)://.*&quot;,</code>ï¼Œå¦‚å›¾</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/2b/cca4a5df53dd47b94e73664bdc8ff3.jpg" alt></p><p>å†æ¬¡ç™»å½•æµ‹è¯•</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/f5/c1a598cd7ecd0a96df200f38659aec.jpg" alt></p><p>è¿™æ¬¡ç»ˆäºæ­£å¸¸äº†ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ç‚¹å‡»ç™»å½•ï¼Œå°±ä¼šè·³è½¬åˆ°æˆæƒé¡µé¢</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/ae/c40e776bfcecf0ca8b48c4e9582dbc.jpg" alt></p><p>ç‚¹å‡» Allow å³å¯æˆåŠŸæˆæƒè·³è½¬è‡³æœ¬åšå®¢ï¼Œæˆ‘ä»¬ä¼šæ³¨æ„åˆ° uri ä¼šæºå¸¦ä¸€ä¸ª codeï¼Œè¿™å°±æ˜¯ CAS ç›®å‰åœ¨ oauth2.0 æˆæƒä¸­æœ€ä¸ºå®Œå–„çš„ code æˆæƒæ¨¡å¼äº†ã€‚</p><p>è‡³æ­¤ï¼Œ CAS 5.3 é›†æˆ oauth2.0 çš„æˆæƒå·²ç»æ­å»ºå®Œæ¯•</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/13/f1a8df13c6ee93210a970833c5059a.jpg" alt></p><h2 id="æ•´åˆ-openLDAP"><a href="#æ•´åˆ-openLDAP" class="headerlink" title="æ•´åˆ openLDAP"></a>æ•´åˆ openLDAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /usr/local/tomcat/webapps/cas/WEB-INF/classes/application.properties</span></span><br></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰é»˜è®¤çš„ <code>cas.authn.accept.users</code> è®¤è¯æ–¹å¼å¹¶æ·»åŠ ä¸<code>LDAP Server</code>è¿æ¥çš„é…ç½®(è¯·æ ¹æ®è‡ªå·±çš„<code>LDAP</code>æœåŠ¡å™¨ä¿¡æ¯è¿›è¡Œä¿®æ”¹)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">##</span><br><span class="line"># CAS Authentication Credentials</span><br><span class="line">#</span><br><span class="line"># cas.authn.accept.users=casuser::Mellon</span><br><span class="line">cas.authn.ldap[0].principalAttributeList=sn,cn:commonName,givenName,eduPersonTargettedId:SOME_IDENTIFIER</span><br><span class="line">cas.authn.ldap[0].collectDnAttribute=false</span><br><span class="line">cas.authn.ldap[0].principalDnAttributeName=principalLdapDn</span><br><span class="line">cas.authn.ldap[0].allowMultiplePrincipalAttributeValues=true</span><br><span class="line">cas.authn.ldap[0].allowMissingPrincipalAttributeValue=true</span><br><span class="line">cas.authn.ldap[0].credentialCriteria=</span><br><span class="line">cas.authn.attributeRepository.ldap[0].attributes.uid=uid</span><br><span class="line">cas.authn.attributeRepository.ldap[0].attributes.displayName=displayName</span><br><span class="line">cas.authn.attributeRepository.ldap[0].attributes.cn=commonName</span><br><span class="line">cas.authn.attributeRepository.ldap[0].attributes.affiliation=groupMembership</span><br><span class="line">cas.authn.ldap[0].ldapUrl=ldap://devops.iamzhl.top:389</span><br><span class="line">cas.authn.ldap[0].bindDn=cn=Manager,dc=iamzhl,dc=top</span><br><span class="line">cas.authn.ldap[0].bindCredential=passwd</span><br><span class="line">cas.authn.ldap[0].poolPassivator=BIND</span><br><span class="line">cas.authn.ldap[0].connectionStrategy=</span><br><span class="line">cas.authn.ldap[0].providerClass=org.ldaptive.provider.unboundid.UnboundIDProvider</span><br><span class="line">cas.authn.ldap[0].connectTimeout=5000</span><br><span class="line">cas.authn.ldap[0].trustCertificates=</span><br><span class="line">cas.authn.ldap[0].keystore=</span><br><span class="line">cas.authn.ldap[0].keystorePassword=</span><br><span class="line">cas.authn.ldap[0].keystoreType=PKCS12</span><br><span class="line">cas.authn.ldap[0].minPoolSize=3</span><br><span class="line">cas.authn.ldap[0].maxPoolSize=10</span><br><span class="line">cas.authn.ldap[0].validateOnCheckout=true</span><br><span class="line">cas.authn.ldap[0].validatePeriodically=true</span><br><span class="line">cas.authn.ldap[0].validatePeriod=500</span><br><span class="line">cas.authn.ldap[0].validateTimeout=5000</span><br><span class="line">cas.authn.ldap[0].failFast=true</span><br><span class="line">cas.authn.ldap[0].idleTime=500</span><br><span class="line">cas.authn.ldap[0].prunePeriod=24</span><br><span class="line">cas.authn.ldap[0].blockWaitTime=5000</span><br><span class="line">cas.authn.ldap[0].useSsl=false</span><br><span class="line">cas.authn.ldap[0].useStartTls=false</span><br><span class="line">cas.authn.ldap[0].responseTimeout=8000</span><br><span class="line">cas.authn.ldap[0].allowMultipleDns=false</span><br><span class="line">cas.authn.ldap[0].name=</span><br><span class="line">cas.authn.ldap[0].type=AUTHENTICATED</span><br><span class="line">cas.authn.ldap[0].searchFilter=uid=&#123;user&#125;</span><br><span class="line">#cas.authn.ldap[0].enhanceWithEntryResolver=true</span><br><span class="line">cas.authn.ldap[0].derefAliases=NEVER</span><br><span class="line">cas.authn.ldap[0].dnFormat=uid=%s,ou=People,dc=iamzhl,dc=top</span><br><span class="line">cas.authn.ldap[0].baseDn=ou=People,dc=iamzhl,dc=top</span><br></pre></td></tr></table></figure><p>é‡å¯ Tomcat æŸ¥çœ‹æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shutdown.sh</span></span><br><span class="line"><span class="comment"># startup.sh</span></span><br><span class="line"><span class="comment"># tail -f /usr/local/tomcat/logs/catalina.out</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/f2/308f5dc1de191625e6087c1d040824.jpg" alt></p><p>æ–°å»ºä¸€ä¸ª openLDAP ç”¨æˆ· test / 123456</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/0e/e69bb807212cc32a80cb28c4b927e1.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/01/ab9d40ac8d216e3e2b99a287082fa7.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/14/de8c6a3b3854b28bca29d84e338f9f.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/53/287f9a9a0cfe1c25c3c66d775fb214.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/af/af3a63b732070ac51f27b10f6e2dca.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b3/da28177e70ab2cb77421d6ae16ca95.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/70/749184f3907b06951093fc2a944e42.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/c0/5ddca5f311e7f8b2ba598480c3636e.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/e7/8a989532254213ac72efc235676a2a.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/2e/ebca96c81bd780e9b90d9bdbd3415a.jpg" alt></p><p>æ‰“å¼€ CAS ç½‘å€æµ‹è¯• <code>http://devops.iamzhl.top:8080/cas/login</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/48/9f8dc131728eda81cd522d5db954d4.jpg" alt></p><p>è¾“å…¥ç”¨æˆ·åå¯†ç ç™»é™†æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/89/2e8366b3accc1248a4043079a958a3.jpg" alt></p><p>æ—¥å¿—è¾“å‡ºå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/c3/cf45af8f7ab6b3aa80267f95cb6a42.jpg" alt></p><p>è‡³æ­¤ï¼ŒCAS 5.3 æ•´åˆ openLDAP ç»“æŸã€‚</p><h2 id="è‡ªå®šä¹‰ç™»å‡ºè·³è½¬ç•Œé¢"><a href="#è‡ªå®šä¹‰ç™»å‡ºè·³è½¬ç•Œé¢" class="headerlink" title="è‡ªå®šä¹‰ç™»å‡ºè·³è½¬ç•Œé¢"></a>è‡ªå®šä¹‰ç™»å‡ºè·³è½¬ç•Œé¢</h2><p>æŸäº›æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹ç™»å‡ºè¿›è¡Œå®šåˆ¶ï¼Œæ¯”å¦‚ç­‰å‡ºåè·³è½¬åˆ°ç­‰å‡ºç•Œé¢ï¼Œåœ¨<code>CAS 5.3</code>ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œç›´æ¥ä¿®æ”¹å‰ç«¯çš„<code>HTML</code>é¡µé¢æ— æ³•å®Œæˆç™»å‡ºçš„å®šåˆ¶è·³è½¬ï¼Œä¸è¿‡å®˜æ–¹æä¾›äº†æ›´ä¸ºæ–¹ä¾¿çš„è®¾ç½®æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶<code>application.properties</code>æ¥å®ç°ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cas.logout.followServiceRedirects=true</span><br><span class="line">cas.logout.redirectParameter=service</span><br><span class="line">cas.logout.redirectUrl=https://default.cas.com</span><br><span class="line">cas.logout.confirmLogout=false</span><br><span class="line">cas.logout.removeDescendantTickets=true</span><br></pre></td></tr></table></figure><p><em>è¯·æ ¹æ®éœ€è¦å°†å…¶ä¸­çš„<code>redirectUrl</code>æ”¹ä¸ºè¦å®šåˆ¶çš„ç™»å‡ºè·³è½¬é“¾æ¥</em></p><h2 id="è‡ªå®šä¹‰é»˜è®¤çš„ç™»å½•è·³è½¬ç•Œé¢"><a href="#è‡ªå®šä¹‰é»˜è®¤çš„ç™»å½•è·³è½¬ç•Œé¢" class="headerlink" title="è‡ªå®šä¹‰é»˜è®¤çš„ç™»å½•è·³è½¬ç•Œé¢"></a>è‡ªå®šä¹‰é»˜è®¤çš„ç™»å½•è·³è½¬ç•Œé¢</h2><p>ç™»å‡ºè·³è½¬å¯ä»¥å®šåˆ¶ï¼Œç™»å½•çš„ä¹Ÿå¯ä»¥ï¼Œæœ‰äº›æ—¶å€™ï¼Œå¯èƒ½éœ€è¦åœ¨ç›´æ¥è®¿é—®çš„<code>CAS</code>çš„æ—¶å€™ï¼Œç™»é™†æˆåŠŸåç›´æ¥è·³è½¬åˆ°æŒ‡å®šçš„ç•Œé¢ï¼Œæ¯”å¦‚ç›´æ¥è®¿é—®<code>http://devops.iamzhl.top:8080/cas</code>ï¼Œéœ€è¦è·³è½¬åˆ°<code>http://devops.iamzhl.top/index.html</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨<code>application.properties</code>ä¸­æ·»åŠ ä»¥ä¸‹å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cas.view.defaultRedirectUrl=http://devops.iamzhl.top/index.html</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰ç™»å½•ç•Œé¢ä¸»é¢˜"><a href="#è‡ªå®šä¹‰ç™»å½•ç•Œé¢ä¸»é¢˜" class="headerlink" title="è‡ªå®šä¹‰ç™»å½•ç•Œé¢ä¸»é¢˜"></a>è‡ªå®šä¹‰ç™»å½•ç•Œé¢ä¸»é¢˜</h2><p>åœ¨<code>cas/WEB-INF/classes/static/themes</code>ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä»¥è¦è®¾ç½®çš„ä¸»é¢˜åå‘½åï¼Œæ¯”å¦‚<code>devops</code>ï¼Œåœ¨æ­¤ç›®å½•ä¸‹å»ºç«‹<code>js</code>ã€<code>css</code>ä»¥åŠ<code>images</code>ç­‰é™æ€èµ„æºæ–‡ä»¶å¤¹ï¼Œå°†å®šåˆ¶çš„é™æ€èµ„æºä¿å­˜å¥½ï¼Œç»“æ„å¦‚ä¸‹</p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fzqqbpvu1cj31p818k4au.jpg" alt></p><p>ç„¶ååœ¨<code>application.properties</code>æ·»åŠ ä»¥ä¸‹å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cas.theme.defaultThemeName=devops</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      CAS 5.3.4 å®‰è£…éƒ¨ç½²
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="CAS" scheme="https://iamzhl.top/tags/CAS/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7 å®‰è£…éƒ¨ç½²é‚®ä»¶æœåŠ¡å™¨</title>
    <link href="https://iamzhl.top/Install-and-deploy-mail-server-on-CentOS-7.html"/>
    <id>https://iamzhl.top/Install-and-deploy-mail-server-on-CentOS-7.html</id>
    <published>2018-10-19T13:31:24.000Z</published>
    <updated>2019-03-11T16:21:49.893Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h1 id="æœ¬æ–‡ç¯å¢ƒ"><a href="#æœ¬æ–‡ç¯å¢ƒ" class="headerlink" title="æœ¬æ–‡ç¯å¢ƒ"></a>æœ¬æ–‡ç¯å¢ƒ</h1><p>CentOS 7.2 1511</p><h1 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h1><h2 id="å®‰è£…postfix"><a href="#å®‰è£…postfix" class="headerlink" title="å®‰è£…postfix"></a>å®‰è£…postfix</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install postfix</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæœºå™¨å·²ç»å®‰è£…äº†sendmailï¼Œéœ€è¦å°†å…¶å¸è½½ï¼Œä¸‹é¢ä¸¤æ¡å‘½ä»¤å‡å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y remove sendmail</span></span><br><span class="line"><span class="comment"># rpm -e sendmail</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹MTA(é»˜è®¤é‚®ä»¶ä»£ç†)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alternatives --config mta</span></span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alternatives --display mta</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/14/519a03d59c7bc4ff363f66a8620736.jpg" alt></p><p>è¿™é‡Œæˆ‘å·²ç»å®‰è£…è¿‡postfixäº†</p><h2 id="å®‰è£…dovecot"><a href="#å®‰è£…dovecot" class="headerlink" title="å®‰è£…dovecot"></a>å®‰è£…dovecot</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install dovecot</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/fd/d041b10136a8aea22008556cba508a.jpg" alt></p><h2 id="é…ç½®postfix"><a href="#é…ç½®postfix" class="headerlink" title="é…ç½®postfix"></a>é…ç½®postfix</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/postfix/main.cf</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä»¥ä¸‹å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">myhostname = mail.zhanghl.cn  # å–æ¶ˆæ³¨é‡Šï¼Œè®¾ç½®hostname</span><br><span class="line">mydomain = zhanghl.cn  # å–æ¶ˆæ³¨é‡Šï¼Œè®¾ç½®åŸŸå</span><br><span class="line">myorigin = $mydomain  # å–æ¶ˆæ³¨é‡Š</span><br><span class="line">inet_interfaces = all  # ä¿®æ”¹ä¸ºall</span><br><span class="line">inet_protocols = ipv4  # ä¿®æ”¹ipv4ï¼Œå¦‚æœæ”¯æŒipv6ï¼Œåˆ™å¯ä»¥ä¸ºall</span><br><span class="line">mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain # ä¿®æ”¹åœ¨æœ€åæ·»åŠ $mydomain</span><br><span class="line">mynetworks = 127.0.0.0/8, 10.0.0.0/24  # å–æ¶ˆæ³¨é‡Šï¼ŒæŒ‡å®šå†…ç½‘å’Œæœ¬åœ°çš„IPåœ°å€èŒƒå›´</span><br><span class="line">home_mailbox = Maildir/  # å–æ¶ˆæ³¨é‡Šï¼Œé‚®ä»¶ä¿å­˜ç›®å½•</span><br><span class="line">smtpd_banner = $myhostname ESMTP $mail_name ($mail_version)  # å–æ¶ˆæ³¨é‡Šï¼Œé‚®ä»¶æœåŠ¡å™¨æ¬¢è¿ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶æœ€åæ·»åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Setup max mail attachment to 10M</span><br><span class="line">message_size_limit = 10485760</span><br><span class="line"># Setup max capacity of Inbox to 1G</span><br><span class="line">mailbox_size_limit = 1073741824</span><br><span class="line"># SMTP Authentication</span><br><span class="line">smtpd_sasl_type = dovecot</span><br><span class="line">smtpd_sasl_path = private/auth</span><br><span class="line">smtpd_sasl_auth_enable = yes</span><br><span class="line">smtpd_sasl_security_options = noanonymous</span><br><span class="line">smtpd_sasl_local_domain = $myhostname</span><br><span class="line">smtpd_recipient_restrictions = permit_mynetworks,permit_auth_destination,permit_sasl_authenticated,reject</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å¹¶è®¾ç½®è‡ªå¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start postfix  //å¯åŠ¨</span></span><br><span class="line"><span class="comment"># systemctl enable postfix  //è‡ªå¯åŠ¨</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®dovecot"><a href="#é…ç½®dovecot" class="headerlink" title="é…ç½®dovecot"></a>é…ç½®dovecot</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/dovecot/dovecot.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen = *  //å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/dovecot/conf.d/10-auth.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">disable_plaintext_auth = no  //å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹</span><br><span class="line">auth_mechanisms = plain login  //ä¿®æ”¹æ·»åŠ login</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/dovecot/conf.d/10-mail.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mail_location = maildir:~/Maildir  //ä¿®æ”¹è®¾ç½®é‚®ä»¶å­˜å‚¨ä½ç½®</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/dovecot/conf.d/10-master.conf</span></span><br></pre></td></tr></table></figure><p>å–æ¶ˆæ³¨é‡Šå¹¶æ·»åŠ userå’Œgroupå±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">unix_listener /var/spool/postfix/private/auth &#123;</span><br><span class="line">    mode = 0666</span><br><span class="line">    user = postfix</span><br><span class="line">    group = postfix</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨å¹¶è®¾ç½®è‡ªå¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start dovecot  //å¯åŠ¨</span></span><br><span class="line"><span class="comment"># systemctl enable dovecot  //è‡ªå¯åŠ¨</span></span><br></pre></td></tr></table></figure><h2 id="åŸŸåè§£æ"><a href="#åŸŸåè§£æ" class="headerlink" title="åŸŸåè§£æ"></a>åŸŸåè§£æ</h2><p>æ·»åŠ ä¸€ä¸ªå­åŸŸåmailï¼ŒAè®°å½•è§£æåˆ°æœåŠ¡å™¨IPã€‚</p><p>å†æ·»åŠ ä¸€ä¸ªMXè®°å½•ï¼Œä¸»æœºè®°å½•ä¸ºç©ºï¼Œè®°å½•å€¼ä¸ºä¸Šé¢è§£æçš„äºŒçº§åŸŸåmail.zhanghl.cnï¼Œä¼˜å…ˆçº§10ã€‚</p><p>æ³¨æ„ï¼šè§£æç”Ÿæ•ˆå¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ã€‚</p><p>ä¹Ÿå¯ä»¥ä¿®æ”¹/etc/hostsæ·»åŠ é‚®ä»¶æœåŠ¡å™¨åŸŸåå®ç°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/hosts</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/e2/0e95d3345f60b59bffdf377e55fc3b.jpg" alt></p><h2 id="æµ‹è¯•é‚®ç®±"><a href="#æµ‹è¯•é‚®ç®±" class="headerlink" title="æµ‹è¯•é‚®ç®±"></a>æµ‹è¯•é‚®ç®±</h2><p>é¦–å…ˆå®‰è£…telnetï¼Œç”±äºCentOS 7å·²ç»é»˜è®¤æ²¡æœ‰äº†xinetdå’Œtelnetï¼Œå› æ­¤éœ€è¦å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install xinetd telnet telnet-server</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®xinetdå¯åŠ¨å¹¶è‡ªå¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start xinetd</span></span><br><span class="line"><span class="comment"># systemctl enable xinetd</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨telnetæµ‹è¯•é‚®ä»¶æœåŠ¡å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">[zhanghl@centos-7 ~]$ telnet zhanghl.cn 25</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to zhanghl.cn.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">220 mail.zhanghl.cn ESMTP Postfix (2.10.1)</span><br><span class="line">mail from:zhanghl</span><br><span class="line">250 2.1.0 Ok</span><br><span class="line">rcpt to:root</span><br><span class="line">250 2.1.5 Ok</span><br><span class="line">data</span><br><span class="line">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</span><br><span class="line">Hello, i<span class="string">'m zhanghl!</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">250 2.0.0 Ok: queued as 731144191B7F</span></span><br><span class="line"><span class="string">quit</span></span><br><span class="line"><span class="string">221 2.0.0 Bye</span></span><br><span class="line"><span class="string">Connection closed by foreign host.</span></span><br><span class="line"><span class="string">[zhanghl@centos-7 ~]$ telnet zhanghl.cn 110</span></span><br><span class="line"><span class="string">Trying 127.0.0.1...</span></span><br><span class="line"><span class="string">Connected to zhanghl.cn.</span></span><br><span class="line"><span class="string">Escape character is '</span>^]<span class="string">'.</span></span><br><span class="line"><span class="string">+OK Dovecot ready.</span></span><br><span class="line"><span class="string">user zhanghl</span></span><br><span class="line"><span class="string">+OK</span></span><br><span class="line"><span class="string">pass 123456</span></span><br><span class="line"><span class="string">+OK Logged in.</span></span><br><span class="line"><span class="string">list</span></span><br><span class="line"><span class="string">+OK 1 messages:</span></span><br><span class="line"><span class="string">1 2381</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">retr 1</span></span><br><span class="line"><span class="string">+OK 2381 octets</span></span><br><span class="line"><span class="string">Return-Path: &lt;&gt;</span></span><br><span class="line"><span class="string">X-Original-To: zhanghl@zhanghl.cn</span></span><br><span class="line"><span class="string">Delivered-To: zhanghl@zhanghl.cn</span></span><br><span class="line"><span class="string">Received: by mail.zhanghl.cn (Postfix)</span></span><br><span class="line"><span class="string">id 61E594191B92; Fri, 19 Oct 2018 22:44:27 +0800 (CST)</span></span><br><span class="line"><span class="string">Date: Fri, 19 Oct 2018 22:44:27 +0800 (CST)</span></span><br><span class="line"><span class="string">From: MAILER-DAEMON@zhanghl.cn (Mail Delivery System)</span></span><br><span class="line"><span class="string">Subject: Undelivered Mail Returned to Sender</span></span><br><span class="line"><span class="string">To: zhanghl@zhanghl.cn</span></span><br><span class="line"><span class="string">Auto-Submitted: auto-replied</span></span><br><span class="line"><span class="string">MIME-Version: 1.0</span></span><br><span class="line"><span class="string">Content-Type: multipart/report; report-type=delivery-status;</span></span><br><span class="line"><span class="string">boundary="731144191B7F.1539960267/mail.zhanghl.cn"</span></span><br><span class="line"><span class="string">Message-Id: &lt;20181019144427.61E594191B92@mail.zhanghl.cn&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This is a MIME-encapsulated message.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">--731144191B7F.1539960267/mail.zhanghl.cn</span></span><br><span class="line"><span class="string">Content-Description: Notification</span></span><br><span class="line"><span class="string">Content-Type: text/plain; charset=us-ascii</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This is the mail system at host mail.zhanghl.cn.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I'</span>m sorry to have to inform you that your message could not</span><br><span class="line">be delivered to one or more recipients. It<span class="string">'s attached below.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For further assistance, please send mail to postmaster.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If you do so, please include this problem report. You can</span></span><br><span class="line"><span class="string">delete your own text from the attached returned message.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                   The mail system</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;root@zhanghl.cn&gt; (expanded from &lt;root&gt;): maildir delivery failed: create</span></span><br><span class="line"><span class="string">    maildir file /root/Maildir/tmp/1539960267.P14995.centos-7.shared:</span></span><br><span class="line"><span class="string">    Permission denied</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">--731144191B7F.1539960267/mail.zhanghl.cn</span></span><br><span class="line"><span class="string">Content-Description: Delivery report</span></span><br><span class="line"><span class="string">Content-Type: message/delivery-status</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reporting-MTA: dns; mail.zhanghl.cn</span></span><br><span class="line"><span class="string">X-Postfix-Queue-ID: 731144191B7F</span></span><br><span class="line"><span class="string">X-Postfix-Sender: rfc822; zhanghl@zhanghl.cn</span></span><br><span class="line"><span class="string">Arrival-Date: Fri, 19 Oct 2018 22:43:58 +0800 (CST)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Final-Recipient: rfc822; root@zhanghl.cn</span></span><br><span class="line"><span class="string">Original-Recipient: rfc822;root</span></span><br><span class="line"><span class="string">Action: failed</span></span><br><span class="line"><span class="string">Status: 5.2.0</span></span><br><span class="line"><span class="string">Diagnostic-Code: X-Postfix; maildir delivery failed: create maildir file</span></span><br><span class="line"><span class="string">    /root/Maildir/tmp/1539960267.P14995.centos-7.shared: Permission denied</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">--731144191B7F.1539960267/mail.zhanghl.cn</span></span><br><span class="line"><span class="string">Content-Description: Undelivered Message</span></span><br><span class="line"><span class="string">Content-Type: message/rfc822</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Return-Path: &lt;zhanghl@zhanghl.cn&gt;</span></span><br><span class="line"><span class="string">Received: from mail.zhanghl.cn (mail.zhanghl.cn [127.0.0.1])</span></span><br><span class="line"><span class="string">by mail.zhanghl.cn (Postfix) with SMTP id 731144191B7F</span></span><br><span class="line"><span class="string">for &lt;root&gt;; Fri, 19 Oct 2018 22:43:58 +0800 (CST)</span></span><br><span class="line"><span class="string">Message-Id: &lt;20181019144410.731144191B7F@mail.zhanghl.cn&gt;</span></span><br><span class="line"><span class="string">Date: Fri, 19 Oct 2018 22:43:58 +0800 (CST)</span></span><br><span class="line"><span class="string">From: zhanghl@zhanghl.cn</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hello, i'</span>m zhanghl!</span><br><span class="line"></span><br><span class="line">--731144191B7F.1539960267/mail.zhanghl.cn--</span><br><span class="line">.</span><br><span class="line">quit</span><br><span class="line">+OK Logging out.</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">[zhanghl@centos-7 ~]$</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨é‚®ç®±"><a href="#ä½¿ç”¨é‚®ç®±" class="headerlink" title="ä½¿ç”¨é‚®ç®±"></a>ä½¿ç”¨é‚®ç®±</h2><p>ä¸€åˆ‡éƒ½å¼„å¥½ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨Foxmailç­‰ç¬¬ä¸‰æ–¹è½¯ä»¶æ¥æ”¶å‘é‚®ä»¶äº†ã€‚åœ¨è¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ï¼Œç³»ç»Ÿç”¨æˆ·å°±æ˜¯é‚®ä»¶çš„ç”¨æˆ·ï¼Œä¾‹å¦‚rootï¼Œå°±æ˜¯ä¸€ä¸ªé‚®ç®±ç”¨æˆ·ï¼Œé‚®ç®±æ˜¯<span class="exturl" data-url="bWFpbHRvOnJvb3RAemhhbmdobC5jbg==" title="mailto:root@zhanghl.cn">root@zhanghl.cn<i class="fa fa-external-link"></i></span>ï¼Œå¯†ç å°±æ˜¯rootçš„å¯†ç ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºç”¨æˆ·ï¼Œåªè¦ä½¿ç”¨useraddåˆ›å»ºç”¨æˆ·ï¼Œå†ä½¿ç”¨passwdè®¾ç½®å¯†ç ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      CentOS 7å®‰è£…éƒ¨ç½²é‚®ä»¶æœåŠ¡å™¨
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="Linux" scheme="https://iamzhl.top/categories/%E8%BF%90%E7%BB%B4/Linux/"/>
    
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/tags/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="Linux" scheme="https://iamzhl.top/tags/Linux/"/>
    
      <category term="SMTP" scheme="https://iamzhl.top/tags/SMTP/"/>
    
      <category term="Mail Server" scheme="https://iamzhl.top/tags/Mail-Server/"/>
    
  </entry>
  
  <entry>
    <title>TestLinkå®‰è£…éƒ¨ç½²</title>
    <link href="https://iamzhl.top/TestLink-install-and-deploy.html"/>
    <id>https://iamzhl.top/TestLink-install-and-deploy.html</id>
    <published>2018-08-26T11:51:29.000Z</published>
    <updated>2019-03-11T16:21:49.903Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h1 id="TestLinkå®‰è£…éƒ¨ç½²"><a href="#TestLinkå®‰è£…éƒ¨ç½²" class="headerlink" title="TestLinkå®‰è£…éƒ¨ç½²"></a><center>TestLinkå®‰è£…éƒ¨ç½²</center></h1><h2 id="å®‰è£…MySQL"><a href="#å®‰è£…MySQL" class="headerlink" title="å®‰è£…MySQL"></a>å®‰è£…MySQL</h2><p>MySQLçš„Serveråœ¨CentOS 7ä¸Šä»é»˜è®¤è½¯ä»¶åˆ—è¡¨ä¸­è¢«ç§»é™¤äº†ï¼Œç”¨MariaDBæ¥ä»£æ›¿ï¼Œæ‰€ä»¥è¿™å¯¼è‡´æˆ‘ä»¬å¿…é¡»è¦å»å®˜ç½‘ä¸Šè¿›è¡Œä¸‹è½½ï¼Œæ‰¾åˆ°é“¾æ¥ï¼Œç”¨wgetæ‰“å¼€ï¼Œç„¶åå†å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># yum -y install mysql mysql-server mysql-devel</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨MySQLæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure><p>è·å–å®‰è£…MySQLæ—¶çš„åˆå§‹å¯†ç å¹¶ç™»å½•MySQL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep 'temporary password' /var/log/mysqld.log</span></span><br><span class="line"><span class="comment"># mysql -u root -p</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/4a/a001ae2bae5a494c7329cd78a477a3.jpg" alt></p><p>ç™»å½•æˆåŠŸåä¿®æ”¹å¯†ç ï¼Œé¦–å…ˆä¿®æ”¹å®‰å…¨ç­–ç•¥ä¸º0ï¼Œç„¶åå°†å¯†ç é•¿åº¦é™åˆ¶ä¿®æ”¹ä¸º1ï¼Œæœ€åä¿®æ”¹å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global validate_password_policy=0;</span><br><span class="line">mysql&gt; set global validate_password_length=1;</span><br><span class="line">mysql&gt; set password for root@localhost=password(&apos;root&apos;);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a2/0f74ed53f3a426d1fe005228478d8f.jpg" alt></p><p>åˆ›å»ºtestlinkç”¨æˆ·å¹¶åˆ›å»ºtestlinkè¦ç”¨çš„æ•°æ®åº“å¹¶æŠŠtestlinkæ•°æ®åº“çš„æ‰€æœ‰æƒé™èµ‹ç»™testlinkç”¨æˆ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE USER &apos;testlink&apos;@&apos;%&apos; IDENTIFIED BY &apos;root&apos;;</span><br><span class="line">mysql&gt; CREATE DATABASE testlink; </span><br><span class="line">mysql&gt; GRANT ALL ON testlink.* TO &apos;testlink&apos;@&apos;%&apos;; </span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><p>è®¾ç½®MySQLå¯åŠ¨ä¸è‡ªå¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable mysqld    //è‡ªå¯åŠ¨</span></span><br><span class="line"><span class="comment"># systemctl start mysqld     //å¯åŠ¨</span></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…httpd"><a href="#å®‰è£…httpd" class="headerlink" title="å®‰è£…httpd"></a>å®‰è£…httpd</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install httpd</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨è‡ªå¯åŠ¨"><a href="#å¯åŠ¨è‡ªå¯åŠ¨" class="headerlink" title="å¯åŠ¨è‡ªå¯åŠ¨"></a>å¯åŠ¨è‡ªå¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable httpd  //è‡ªå¯åŠ¨</span></span><br><span class="line"><span class="comment"># systemctl start httpd   //å¯åŠ¨</span></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…PHP"><a href="#å®‰è£…PHP" class="headerlink" title="å®‰è£…PHP"></a>å®‰è£…PHP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span></span><br><span class="line"><span class="comment"># yum -y install `yum search php | grep php56w | grep -v "===" | grep -v mysqlnd | awk -F '.' '&#123;print $1&#125;'`</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ä¸€ä¸‹PHPç¯å¢ƒ"><a href="#æµ‹è¯•ä¸€ä¸‹PHPç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ä¸€ä¸‹PHPç¯å¢ƒ"></a>æµ‹è¯•ä¸€ä¸‹PHPç¯å¢ƒ</h3><p>å†™ä¸€ä¸ªphpinfoæµ‹è¯•phpç¯å¢ƒæ˜¯å¦æ­£å¸¸</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /var/www/html/info.php</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨æ‰“å¼€<code>http://IP:httpdç«¯å£/info.php</code></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/bf/a51c4fe3482af30d3b54a102c5a844.jpg" alt></p><p>å¦‚å›¾ï¼ŒPHPç¯å¢ƒå®‰è£…å®Œæˆã€‚</p><p><strong>Note:</strong><br>PHPæ— æ³•æ­£ç¡®è§£æï¼Œç½‘é¡µæ˜¾ç¤ºæºç çš„è§£å†³æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/php.ini</span><br></pre></td></tr></table></figure><p>å°†short_open_tag = Offä¿®æ”¹ä¸ºshort_open_tag = Onï¼Œç„¶åé‡å¯httpdæœåŠ¡å³å¯</p><h2 id="å®‰è£…TestLink"><a href="#å®‰è£…TestLink" class="headerlink" title="å®‰è£…TestLink"></a>å®‰è£…TestLink</h2><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://jaist.dl.sourceforge.net/project/testlink/TestLink%201.9/TestLink%201.9.18/testlink-1.9.18.tar.gz</span></span><br></pre></td></tr></table></figure><h3 id="è§£å‹é‡å‘½å"><a href="#è§£å‹é‡å‘½å" class="headerlink" title="è§£å‹é‡å‘½å"></a>è§£å‹é‡å‘½å</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxvf testlink-1.9.18.tar.gz</span></span><br><span class="line"><span class="comment"># mv testlink-1.9.18 testlink</span></span><br><span class="line"><span class="comment"># mv testlink /var/www/html/</span></span><br><span class="line"><span class="comment"># chown -R apache:apache /var/www/html/testlink</span></span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sed -i -e "s/AllowOverride None/AllowOverride All/g" /etc/httpd/conf/httpd.conf</span></span><br><span class="line"><span class="comment"># sed -i -e "s/DirectoryIndex index.html/DirectoryIndex index.html index.php index.shtm/g" /etc/httpd/conf/httpd.conf</span></span><br><span class="line"><span class="comment"># sed -i -e "s/session.gc_maxlifetime = 1440/session.gc_maxlifetime = 2400/g" /etc/php.ini</span></span><br><span class="line"><span class="comment"># sed -i -e "s/max_execution_time = 30/max_execution_time = 120/g" /etc/php.ini</span></span><br><span class="line"><span class="comment"># service httpd restart</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/49/3c7f4c9291a6c276e5dad2200d5571.jpg" alt></p><h3 id="æ–°å»ºä¸€äº›PHPç¯å¢ƒè¦æ±‚å¿…å¤‡çš„æ–‡ä»¶å¤¹å¹¶èµ‹äºˆé€‚å½“æƒé™"><a href="#æ–°å»ºä¸€äº›PHPç¯å¢ƒè¦æ±‚å¿…å¤‡çš„æ–‡ä»¶å¤¹å¹¶èµ‹äºˆé€‚å½“æƒé™" class="headerlink" title="æ–°å»ºä¸€äº›PHPç¯å¢ƒè¦æ±‚å¿…å¤‡çš„æ–‡ä»¶å¤¹å¹¶èµ‹äºˆé€‚å½“æƒé™"></a>æ–°å»ºä¸€äº›PHPç¯å¢ƒè¦æ±‚å¿…å¤‡çš„æ–‡ä»¶å¤¹å¹¶èµ‹äºˆé€‚å½“æƒé™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir -p /var/www/html/testlink/gui/templates_c</span></span><br><span class="line"><span class="comment"># mkdir -p /var/testlink/logs/</span></span><br><span class="line"><span class="comment"># mkdir -p /var/testlink/upload_area/</span></span><br><span class="line"><span class="comment"># chmod 777 /var/www/html/testlink/gui/templates_c</span></span><br><span class="line"><span class="comment"># chmod 777 /var/testlink/logs/</span></span><br><span class="line"><span class="comment"># chmod 777 /var/testlink/upload_area/</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/23/c132221e0b416226f6f7df1e63b12c.jpg" alt></p><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>æµè§ˆå™¨æ‰“å¼€<code>http://IP:port/testlink/install</code>(å°†IPæ¢æˆè‡ªå·±ä¸»æœºIPï¼Œç«¯å£å·æ¢ä¸ºè‡ªå·±ä¸»æœºçš„ApacheæœåŠ¡ç«¯å£å·)ã€‚å¦‚å›¾ï¼Œç‚¹å‡»New installationå¼€å§‹å®‰è£…</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/14/da839143e11bec790a2a77f7247529.jpg" alt></p><p>é€‰ä¸­åŒæ„åè®®ï¼Œcontinue</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/7c/b33fa4f939e6447fa43f36b5577b43.jpg" alt></p><p>è¿›å…¥ç³»ç»Ÿç¯å¢ƒæ£€æµ‹é˜¶æ®µï¼Œè¿™ä¸€æ­¥éœ€è¦æ ¹æ®é”™è¯¯æç¤ºè¿›è¡Œé…ç½®ï¼Œå‰é¢å·²ç»åœ¨å®‰è£…phpå’Œtestlinkæ—¶è§£å†³äº†ï¼Œæ‰€ä»¥ç°åœ¨å·²ç»æ²¡æœ‰é”™è¯¯äº†ï¼Œå›¾ä¸­æ©™è‰²çš„æç¤ºå¯ä»¥å¿½ç•¥ï¼Œç‚¹å‡»continue</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/8c/84dad1406d9a22e95913b060326730.jpg" alt></p><p>å¦‚å›¾ï¼Œè®¾å®šæ•°æ®åº“ç®¡ç†å‘˜ç™»å½•è´¦æˆ·å¯†ç ï¼Œè‡ªå®šä¹‰TestLinkçš„æ•°æ®åº“ç™»å½•è´¦æˆ·å¯†ç ï¼Œå…¶ä½™å‡ä¿æŒé»˜è®¤ï¼Œç‚¹å‡»Process TestLink Setup</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/58/736d782618beafcda69918ffca7749.jpg" alt></p><p><strong>è¿™é‡Œæœ‰ä¸€ç‚¹æç¤ºï¼Œå¦‚ä¸Šå›¾ä¸­é»‘ä½“æ‰€è¯´ ï¼Œéœ€è¦æ‰‹åŠ¨å¯¼å…¥<code>udf0</code>ç»“å°¾çš„<code>sql</code>æ–‡ä»¶ï¼Œåªéœ€åœ¨<code>mysql</code>å‘½ä»¤è¡Œä¸­æ‰§è¡Œ<code>source /var/www/html/testlink/install/sql/mysql/testlink_create_udf0.sql</code>å³å¯ï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹å…¶ä¸­çš„<code>use</code>å­—æ®µï¼Œå¦‚ä¸‹å›¾ï¼Œä¿®æ”¹ä¸º<code>mysql</code>æ–°å»ºçš„<code>testlink</code>æ•°æ®åº“å</strong></p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fytosr0ucnj31p818kk2a.jpg" alt></p><p><em>å¦‚æœå®‰è£…åˆ°æœ€åå‡ºç°äº†æ‰“å°æ•°æ®åº“è°ƒè¯•ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥<code>php</code>çš„<code>mysql</code>æ¨¡å—ï¼Œå‘½ä»¤æ˜¯<code>php -m | grep mysql</code>ï¼Œå¦‚ä¸‹å›¾åˆ™æ˜¯æ­£å¸¸çš„</em></p><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fytouqtrwgj31p818k7a4.jpg" alt></p><p><em>å¦‚æœæç¤ºåŠ¨æ€åº“æ— æ³•åŠ è½½ä¹‹ç±»çš„é”™è¯¯ï¼Œåªéœ€é‡æ–°å®‰è£…<code>php-mysql</code>ï¼Œç„¶åé‡å¯<code>php-fpm</code>å’Œ<code>httpd</code>å³å¯</em></p><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><p>å®‰è£…å®Œæˆç½‘å€è¾“å…¥<span class="exturl" data-url="aHR0cDovL0lQL3Rlc3RsaW5r5Y2z5Y+v6Ieq5Yqo6Lez6L2s5Yiw55m75b2V6aG16Z2i77yM6buY6K6k55So5oi3YWRtaW4vYWRtaW4=" title="http://IP/testlinkå³å¯è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·admin/admin">http://IP/testlinkå³å¯è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·admin/admin<i class="fa fa-external-link"></i></span></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      TestLinkå®‰è£…éƒ¨ç½²
    
    </summary>
    
      <category term="Linux" scheme="https://iamzhl.top/categories/Linux/"/>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/Linux/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="TestLink" scheme="https://iamzhl.top/tags/TestLink/"/>
    
  </entry>
  
  <entry>
    <title>CentOS å®‰è£…éƒ¨ç½² Gerrit</title>
    <link href="https://iamzhl.top/Gerrit-install-and-deploy.html"/>
    <id>https://iamzhl.top/Gerrit-install-and-deploy.html</id>
    <published>2018-08-22T03:36:45.000Z</published>
    <updated>2019-03-11T16:21:49.890Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="Gerrit-å®‰è£…é…ç½®è¿‡ç¨‹"><a href="#Gerrit-å®‰è£…é…ç½®è¿‡ç¨‹" class="headerlink" title="Gerrit å®‰è£…é…ç½®è¿‡ç¨‹"></a><cneter><code>Gerrit</code> å®‰è£…é…ç½®è¿‡ç¨‹</cneter></h2><h1 id="å®‰è£…è¿‡ç¨‹å¦‚ä¸‹"><a href="#å®‰è£…è¿‡ç¨‹å¦‚ä¸‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹å¦‚ä¸‹"></a>å®‰è£…è¿‡ç¨‹å¦‚ä¸‹</h1><h2 id="æ­¥éª¤ä¸€ï¼šåˆ›å»ºä¸“ç”¨è´¦æˆ·å’Œå·¥ä½œç›®å½•"><a href="#æ­¥éª¤ä¸€ï¼šåˆ›å»ºä¸“ç”¨è´¦æˆ·å’Œå·¥ä½œç›®å½•" class="headerlink" title="æ­¥éª¤ä¸€ï¼šåˆ›å»ºä¸“ç”¨è´¦æˆ·å’Œå·¥ä½œç›®å½•"></a>æ­¥éª¤ä¸€ï¼šåˆ›å»ºä¸“ç”¨è´¦æˆ·å’Œå·¥ä½œç›®å½•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># adduser gerrit  // åˆ›å»ºä¸“ç”¨è´¦æˆ·</span></span><br><span class="line"><span class="comment"># passwd gerrit  //ä¸ºä¸“æœ‰è´¦æˆ·è®¾ç½®å¯†ç </span></span><br></pre></td></tr></table></figure><h2 id="æ­¥éª¤äºŒï¼šé…ç½®Javaç¯å¢ƒ"><a href="#æ­¥éª¤äºŒï¼šé…ç½®Javaç¯å¢ƒ" class="headerlink" title="æ­¥éª¤äºŒï¼šé…ç½®Javaç¯å¢ƒ"></a>æ­¥éª¤äºŒï¼šé…ç½®<code>Java</code>ç¯å¢ƒ</h2><ul><li>å»å®˜ç½‘ä¸‹è½½<code>JDK</code>ï¼š<span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3RlY2huZXR3b3JrL2phdmEvamF2YXNlL2Rvd25sb2Fkcy9qYXZhLWFyY2hpdmUtamF2YXNlOC0yMTc3NjQ4Lmh0bWw=" title="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html">http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html<i class="fa fa-external-link"></i></span></li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/81/1b33b7e9dbe92a1515154d0193194f.jpg" alt></p><ul><li>å®‰è£…<code>JDK</code><br>å°†ä¸‹è½½å¾—åˆ°çš„<code>jdk-8u161-linux-x64.rpm</code>åŒ…ä¿å­˜åˆ°<code>Linux</code>ä¸»æœº</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -ivh jdk-8u161-linux-x64.rpm</span></span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç¼–è¾‘<code>~/.bashrc</code>ï¼Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim ~/.bashrc</span></span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_161</span><br><span class="line">export JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">export CLASSPATH=$JAVA_HOME/lib</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin:$CLASSPATH</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/49/6ac74e90a641e355b29b9c4d17deb9.jpg" alt></p><p>ä½¿ç¯å¢ƒé…ç½®ç”Ÿæ•ˆ<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source ~/.bashrc</span></span><br></pre></td></tr></table></figure><p></p><ul><li>æµ‹è¯•<code>Java</code>ç¯å¢ƒï¼Œåœ¨ç»ˆç«¯è¾“å…¥ï¼š<code>java -version</code>æŸ¥çœ‹æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œè‹¥æ˜¾ç¤ºåˆ™å®‰è£…æˆåŠŸ</li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/2f/49c7d622b298ae690db3c13754c1b1.jpg" alt></p><h2 id="æ­¥éª¤ä¸‰ï¼šå®‰è£…MySQL"><a href="#æ­¥éª¤ä¸‰ï¼šå®‰è£…MySQL" class="headerlink" title="æ­¥éª¤ä¸‰ï¼šå®‰è£…MySQL"></a>æ­¥éª¤ä¸‰ï¼šå®‰è£…MySQL</h2><p>MySQLçš„Serveråœ¨CentOS 7ä¸Šä»é»˜è®¤è½¯ä»¶åˆ—è¡¨ä¸­è¢«ç§»é™¤äº†ï¼Œç”¨MariaDBæ¥ä»£æ›¿ï¼Œæ‰€ä»¥è¿™å¯¼è‡´æˆ‘ä»¬å¿…é¡»è¦å»å®˜ç½‘ä¸Šè¿›è¡Œä¸‹è½½ï¼Œæ‰¾åˆ°é“¾æ¥ï¼Œç”¨wgetæ‰“å¼€ï¼Œç„¶åå†å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># yum -y install mysql mysql-server mysql-devel</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨MySQLæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure><p>è·å–å®‰è£…MySQLæ—¶çš„åˆå§‹å¯†ç å¹¶ç™»å½•MySQL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep 'temporary password' /var/log/mysqld.log</span></span><br><span class="line"><span class="comment"># mysql -u root -p</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/4a/a001ae2bae5a494c7329cd78a477a3.jpg" alt></p><p>ç™»å½•æˆåŠŸåä¿®æ”¹å¯†ç ï¼Œé¦–å…ˆä¿®æ”¹å®‰å…¨ç­–ç•¥ä¸º0ï¼Œç„¶åå°†å¯†ç é•¿åº¦é™åˆ¶ä¿®æ”¹ä¸º1ï¼Œæœ€åä¿®æ”¹å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global validate_password_policy=0;</span><br><span class="line">mysql&gt; set global validate_password_length=1;</span><br><span class="line">mysql&gt; set password for root@localhost=password(&apos;root&apos;);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a2/0f74ed53f3a426d1fe005228478d8f.jpg" alt></p><p>åˆ›å»ºgerritç”¨æˆ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE USER &apos;gerrit&apos;@&apos;%&apos; IDENTIFIED BY &apos;123456&apos;;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºgerritè¦ç”¨çš„æ•°æ®è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE ReviewDB;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/d2/49b9ee020b217374593ca9bf2333b3.jpg" alt></p><p>æŠŠReviewDBçš„æ‰€æœ‰æƒé™èµ‹ç»™gerrit</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT ALL ON ReviewDB.* TO &apos;gerrit&apos;@&apos;%&apos;;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/73/94a9f46a5dd2572e26ac02b13ec1d8.jpg" alt></p><h2 id="æ­¥éª¤å››ï¼šå®‰è£…Git"><a href="#æ­¥éª¤å››ï¼šå®‰è£…Git" class="headerlink" title="æ­¥éª¤å››ï¼šå®‰è£…Git"></a>æ­¥éª¤å››ï¼šå®‰è£…Git</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install git</span></span><br></pre></td></tr></table></figure><h2 id="æ­¥éª¤äº”ï¼šä¸‹è½½å®‰è£…gerrit"><a href="#æ­¥éª¤äº”ï¼šä¸‹è½½å®‰è£…gerrit" class="headerlink" title="æ­¥éª¤äº”ï¼šä¸‹è½½å®‰è£…gerrit"></a>æ­¥éª¤äº”ï¼šä¸‹è½½å®‰è£…<code>gerrit</code></h2><ul><li>ä»å®˜ç½‘ä¸‹è½½<code>gerrit</code>ï¼Œå­˜æ”¾äº<code>/home/gerrit</code>ç›®å½•ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://gerrit-releases.storage.googleapis.com/gerrit-2.15.5.war</span></span><br></pre></td></tr></table></figure><ul><li>å®‰è£…<code>gerrit</code>ï¼š</li></ul><p>é¦–å…ˆåˆ‡æ¢ä¸ºgerritç”¨æˆ·ï¼Œç„¶åè¿è¡Œgerritçš„waråŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su gerrit</span></span><br><span class="line">$ <span class="built_in">cd</span> </span><br><span class="line">$ java -jar gerrit-2.15.war init -d review_site</span><br></pre></td></tr></table></figure><p>ä¸€è·¯å›è½¦é»˜è®¤å®‰è£…(å…¶ä¸­çš„è®¤è¯æ–¹å¼å¤„æ”¹ä¸ºHTTP)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-7 gerrit]<span class="comment"># su gerrit</span></span><br><span class="line">[gerrit@centos-7 ~]$ ll</span><br><span class="line">æ€»ç”¨é‡ 83864</span><br><span class="line">-rwxr-xr-x. 1 root root 85872756 8æœˆ  21 12:49 gerrit-2.14.war</span><br><span class="line">[gerrit@centos-7 ~]$ java -jar gerrit-2.15.5.war init -d review_site</span><br><span class="line">Using secure store: com.google.gerrit.server.securestore.DefaultSecureStore</span><br><span class="line">[2018-08-21 12:51:37,463] [main] INFO  com.google.gerrit.server.config.GerritServerConfigProvider : No /home/gerrit/review_site/etc/gerrit.config; assuming defaults</span><br><span class="line"></span><br><span class="line">*** Gerrit Code Review 2.15.5</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Create <span class="string">'/home/gerrit/review_site'</span> [Y/n]?</span><br><span class="line"></span><br><span class="line">*** Git Repositories</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Location of Git repositories   [git]:</span><br><span class="line"></span><br><span class="line">*** SQL Database</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Database server <span class="built_in">type</span>           [h2]:</span><br><span class="line"></span><br><span class="line">*** Index</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Type                           [LUCENE/?]:</span><br><span class="line"></span><br><span class="line">*** User Authentication</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Authentication method          [OPENID/?]: HTTP</span><br><span class="line">Get username from custom HTTP header [y/N]?</span><br><span class="line">SSO <span class="built_in">logout</span> URL                 :</span><br><span class="line">Enable signed push support     [y/N]?</span><br><span class="line"></span><br><span class="line">*** Review Labels</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Install Verified label         [y/N]?</span><br><span class="line"></span><br><span class="line">*** Email Delivery</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">SMTP server hostname           [localhost]:</span><br><span class="line">SMTP server port               [(default)]:</span><br><span class="line">SMTP encryption                [NONE/?]:</span><br><span class="line">SMTP username                  :</span><br><span class="line"></span><br><span class="line">*** Container Process</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Run as                         [gerrit]:</span><br><span class="line">Java runtime                   [/usr/java/jdk1.8.0_161/jre]:</span><br><span class="line">Copy gerrit-2.15.5.war to review_site/bin/gerrit.war [Y/n]?</span><br><span class="line">Copying gerrit-2.15.5.war to review_site/bin/gerrit.war</span><br><span class="line"></span><br><span class="line">*** SSH Daemon</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Listen on address              [*]:</span><br><span class="line">Listen on port                 [29418]:</span><br><span class="line">Generating SSH host key ... rsa... dsa... <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">*** HTTP Daemon</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Behind reverse proxy           [y/N]?</span><br><span class="line">Use SSL (https://)             [y/N]?</span><br><span class="line">Listen on address              [*]:</span><br><span class="line">Listen on port                 [8080]:</span><br><span class="line">Canonical URL                  [http://centos-7.shared:8080/]:</span><br><span class="line"></span><br><span class="line">*** Cache</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*** Plugins</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">Installing plugins.</span><br><span class="line">Install plugin commit-message-length-validator version v2.15.5 [y/N]?</span><br><span class="line">Install plugin download-commands version v2.15.5 [y/N]?</span><br><span class="line">Install plugin hooks version v2.15.5 [y/N]?</span><br><span class="line">Install plugin replication version v2.15.5 [y/N]?</span><br><span class="line">Install plugin reviewnotes version v2.15.5 [y/N]?</span><br><span class="line">Install plugin singleusergroup version v2.15.5 [y/N]?</span><br><span class="line">Initializing plugins.</span><br><span class="line">No plugins found with init steps.</span><br><span class="line"></span><br><span class="line">Initialized /home/gerrit/review_site</span><br><span class="line">Executing /home/gerrit/review_site/bin/gerrit.sh start</span><br><span class="line">Starting Gerrit Code Review: OK</span><br><span class="line">Waiting <span class="keyword">for</span> server on centos-7.shared:8080 ... OK</span><br><span class="line">Opening http://centos-7.shared:8080/<span class="comment">#/admin/projects/ ...FAILED</span></span><br><span class="line">Open Gerrit with a JavaScript capable browser:</span><br><span class="line">  http://centos-7.shared:8080/<span class="comment">#/admin/projects/</span></span><br><span class="line">[gerrit@centos-7 ~]$</span><br></pre></td></tr></table></figure><p>æˆæƒæ–‡ä»¶å¤¹æƒé™ç»™gerritç”¨æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown -R gerrit:gerrit review_site</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹<code>gerrit</code>é…ç½®æ–‡ä»¶ï¼Œè¯´æ˜å¦‚ä¸‹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim review_site/etc/gerrit.config</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[gerrit]</span><br><span class="line">        basePath = git                          //æŒ‡å®šè¢«gerritç®¡ç†çš„æ‰€æœ‰gitåº“å­˜æ”¾ä½ç½®ï¼Œå³review_site_project/git/</span><br><span class="line">        canonicalWebUrl = http://10.211.55.19:8081/project   //æŒ‡å®šwebè®¿é—®gerritçš„ç½‘å€//å¡«è‡ªå·±çš„ipå’Œç«¯å£å·</span><br><span class="line">[database]</span><br><span class="line">        type = mysql                             //æŒ‡å®šgerritæ‰€é»˜è®¤æ•°æ®åº“ç±»å‹ï¼Œå¯ä»¥é€‰ç”¨mysqlï¼Œå®‰è£…å¹¶åˆ›å»ºgerritè´¦æˆ·</span><br><span class="line">        database = /home/gerrit/review_site/db/ReviewDB</span><br><span class="line">[auth]</span><br><span class="line">        type = HTTP                           //æŒ‡å®šæµè§ˆå™¨ç™»å½•gerritæ—¶çš„è®¤è¯æ–¹å¼</span><br><span class="line">[sendemail]</span><br><span class="line">        smtpServer = localhost                //å±€åŸŸç½‘é‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä½¿ç”¨hMailSeveræ­å»º</span><br><span class="line">[container]</span><br><span class="line">        user = gerrit                             //æŒ‡å®šgerritæ‰€åœ¨æœºå™¨çš„ç”¨æˆ·èº«ä»½ä¸ä¸Šæ–‡åˆ›å»ºçš„ç”¨æˆ·å¯¹åº”ä¸€è‡´,å¯ä»¥æ˜¯root</span><br><span class="line">        javaHome = /usr/java/jdk1.8.0_161/jre</span><br><span class="line">[sshd]</span><br><span class="line">        listenAddress = *:29418                   //æŒ‡å®šsshdæœåŠ¡ç›‘å¬çš„ç«¯å£å·</span><br><span class="line">[httpd]</span><br><span class="line">        listenUrl = http://*:8081/                //æŒ‡å®šhttpä»£ç†åœ°å€</span><br><span class="line">[cache]</span><br><span class="line">        directory = cache                        //ç¼“å­˜ä½ç½®</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/31/8e586e93c265a2f6ff36d3db0454e7.jpg" alt></p><p>é‡å¯gerritæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ review_site/bin/gerrit.sh restart</span><br></pre></td></tr></table></figure><p>è®¾ç½®gerritæœåŠ¡å¼€æœºå¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ln -snf /home/gerrit/review_site/bin/gerrit.sh /etc/init.d/gerrit.sh</span></span><br></pre></td></tr></table></figure><h2 id="æ­¥éª¤å…­ï¼šé…ç½®åå‘ä»£ç†æœåŠ¡-nginx"><a href="#æ­¥éª¤å…­ï¼šé…ç½®åå‘ä»£ç†æœåŠ¡-nginx" class="headerlink" title="æ­¥éª¤å…­ï¼šé…ç½®åå‘ä»£ç†æœåŠ¡(nginx)"></a>æ­¥éª¤å…­ï¼šé…ç½®åå‘ä»£ç†æœåŠ¡(nginx)</h2><blockquote><p>è¯´æ˜ï¼š å±€åŸŸç½‘æœ¬åœ°å®‰è£…ï¼Œè®¾ç½®æœ¬åœ°<code>repo</code>åº“</p></blockquote><h3 id="å®‰è£…nginxåå‘ä»£ç†æœåŠ¡å™¨"><a href="#å®‰è£…nginxåå‘ä»£ç†æœåŠ¡å™¨" class="headerlink" title="å®‰è£…nginxåå‘ä»£ç†æœåŠ¡å™¨"></a>å®‰è£…<code>nginx</code>åå‘ä»£ç†æœåŠ¡å™¨</h3><ul><li>å®‰è£…<code>gcc-c++ pcre pcre-devel zlib zlib-devel openssl</code>ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install gcc-c++ pcre pcre-devel zlib zlib-devel openssl</span></span><br></pre></td></tr></table></figure><ul><li>å®‰è£…å¯åŠ¨<code>nginx</code>å¹¶è®¾ç½®è‡ªå¯åŠ¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span></span><br><span class="line"><span class="comment"># yum update &amp;&amp; yum -y install nginx </span></span><br><span class="line"><span class="comment"># systemctl enable nginx</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.</span><br><span class="line"><span class="comment"># systemctl start nginx</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®nginxï¼š"><a href="#é…ç½®nginxï¼š" class="headerlink" title="é…ç½®nginxï¼š"></a>é…ç½®<code>nginx</code>ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/nginx/conf.d/default.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       82;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    auth_basic &quot;Welcome to Gerrit Code Review !&quot;;</span><br><span class="line">    auth_basic_user_file /home/gerrit/review_site/etc/passwd;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    #access_log  /var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        #root   /usr/share/nginx/html;</span><br><span class="line">        #index  index.html index.htm index.php index.jsp;</span><br><span class="line">        proxy_pass http://127.0.0.1:8081;</span><br><span class="line">        #proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a1/7b9e070ca210075f5fec8631a40d8b.jpg" alt></p><p>å¯åŠ¨<code>nginx</code>æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setenforce 0                 //å…³é—­selinuxä»¥é¿å…é€ æˆæƒé™é—®é¢˜</span></span><br><span class="line"><span class="comment"># systemctl disable firewalld  //ç¦ç”¨é˜²ç«å¢™</span></span><br><span class="line"><span class="comment"># systemctl stop firewalld     //å…³é—­é˜²ç«å¢™</span></span><br><span class="line"><span class="comment"># systemctl start nginx</span></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®ç¬¬ä¸€ä¸ªgerritç”¨æˆ·çš„è´¦å·å’Œå¯†ç "><a href="#è®¾ç½®ç¬¬ä¸€ä¸ªgerritç”¨æˆ·çš„è´¦å·å’Œå¯†ç " class="headerlink" title="è®¾ç½®ç¬¬ä¸€ä¸ªgerritç”¨æˆ·çš„è´¦å·å’Œå¯†ç "></a>è®¾ç½®ç¬¬ä¸€ä¸ª<code>gerrit</code>ç”¨æˆ·çš„è´¦å·å’Œå¯†ç </h3><p>è¦ç”¨åˆ°htpasswdå‘½ä»¤éœ€è¦é¦–å…ˆå®‰è£…æœ‰httpd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install httpd</span></span><br><span class="line">$ touch ./review_site/etc/passwd</span><br><span class="line">$ htpasswd -b ./review_site/etc/passwd gerrit 123456</span><br></pre></td></tr></table></figure><h2 id="æ­¥éª¤ä¸ƒï¼šå®‰è£…é…ç½®gitweb"><a href="#æ­¥éª¤ä¸ƒï¼šå®‰è£…é…ç½®gitweb" class="headerlink" title="æ­¥éª¤ä¸ƒï¼šå®‰è£…é…ç½®gitweb"></a>æ­¥éª¤ä¸ƒï¼šå®‰è£…é…ç½®<code>gitweb</code></h2><h3 id="å®‰è£…gitweb-æœ€å¥½åœ¨è”ç½‘ç¯å¢ƒä¸‹å®‰è£…ï¼Œæˆ–è€…åœ¨ç¦»çº¿ç¯å¢ƒä¸‹ä¸‹è½½å¯¹åº”çš„ä¾èµ–åŒ…"><a href="#å®‰è£…gitweb-æœ€å¥½åœ¨è”ç½‘ç¯å¢ƒä¸‹å®‰è£…ï¼Œæˆ–è€…åœ¨ç¦»çº¿ç¯å¢ƒä¸‹ä¸‹è½½å¯¹åº”çš„ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…gitweb,æœ€å¥½åœ¨è”ç½‘ç¯å¢ƒä¸‹å®‰è£…ï¼Œæˆ–è€…åœ¨ç¦»çº¿ç¯å¢ƒä¸‹ä¸‹è½½å¯¹åº”çš„ä¾èµ–åŒ…"></a>å®‰è£…<code>gitweb</code>,æœ€å¥½åœ¨è”ç½‘ç¯å¢ƒä¸‹å®‰è£…ï¼Œæˆ–è€…åœ¨ç¦»çº¿ç¯å¢ƒä¸‹ä¸‹è½½å¯¹åº”çš„ä¾èµ–åŒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install gitweb</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®gitweb-ä¸gerrité›†æˆ"><a href="#é…ç½®gitweb-ä¸gerrité›†æˆ" class="headerlink" title="é…ç½®gitweb,ä¸gerrité›†æˆ"></a>é…ç½®<code>gitweb</code>,ä¸<code>gerrit</code>é›†æˆ</h3><p>ä¿®æ”¹<code>gitweb</code>çš„é…ç½®æ–‡ä»¶ï¼ˆ/etc/gitweb.confï¼‰ï¼Œå°†é…ç½®é¡¹ â€œ$projectrootâ€ä¿®æ”¹ä¸º<code>gerrit</code>çš„<code>git</code>ä»“åº“ç›®å½•ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/35/3723767206d90e1f1fbf859d5df6ba.jpg" alt></p><p>ä¿®æ”¹/home/gerrit/review_site/etc/gerrit.config,æ·»åŠ ï¼š</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/26/432e046271c2658c8a203b86c19d5f.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/9d/b0b9039fc3682a7cdfae62ce5387d9.jpg" alt></p><h3 id="é…ç½®gerritæƒé™"><a href="#é…ç½®gerritæƒé™" class="headerlink" title="é…ç½®gerritæƒé™"></a>é…ç½®gerritæƒé™</h3><p>ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•<code>gerrit</code>,ä¿®æ”¹<code>All-Projects</code>çš„æƒé™ï¼Œä¸º<code>refs/*</code>å’Œ<code>refs/meta/config</code>çš„<code>Read</code>é…ç½®é¡¹é…ç½®åˆé€‚çš„æƒé™ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/bc/d4431e93f304e1a913b244cadfd492.jpg" alt></p><p><strong>æ³¨æ„ï¼šå¦‚æœä½ æ˜¯åœ¨rootç”¨æˆ·ä¸‹è¾“å…¥ä¸Šé¢çš„å‘½ä»¤ åˆ›å»ºäº†passwordæ–‡ä»¶åˆ°/home/gerrit/review_site/etcç›®å½•ä¸­,ä½ ä¼šå‘ç°åœ¨ç™»å½•çš„æ—¶å€™æ°¸è¿œç™»å½•ä¸æˆåŠŸ,æ°¸è¿œä¼šå¾—åˆ°æœåŠ¡å™¨500çš„é”™è¯¯é¡µé¢ã€‚åŸå› æ˜¯passwordæ–‡ä»¶çš„æƒé™é—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“,/home/gerrit/æ˜¯æˆ‘ä»¬ä¹‹å‰æ–°å»ºçš„gerritç”¨æˆ·çš„,é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å¤¹çš„æƒé™æ˜¯700,ä¹Ÿå°±æ˜¯åªå…è®¸gerritç”¨æˆ·è®¿é—®,å…¶ä»–ç»„çš„ç”¨æˆ·æ˜¯è®¿é—®ä¸äº†çš„,è™½ç„¶è¿™ä¸ªæ–‡ä»¶çš„æƒé™æ‹¥æœ‰rootç”¨æˆ·çš„æ‰€æœ‰æƒé™,ä½†æ˜¯å› ä¸ºå®ƒæ”¾åœ¨700æƒé™çš„æ–‡ä»¶å¤¹ä¸‹é¢,æ‰€ä»¥åŒæ ·å…¶ä»–ç”¨æˆ·æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚è§£å†³æ–¹æ³•å¦‚ä¸‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown -R gerrit:gerrit /home/gerrit</span></span><br></pre></td></tr></table></figure><h3 id="é‡å¯gerritæœåŠ¡å’ŒNginxæœåŠ¡"><a href="#é‡å¯gerritæœåŠ¡å’ŒNginxæœåŠ¡" class="headerlink" title="é‡å¯gerritæœåŠ¡å’ŒNginxæœåŠ¡"></a>é‡å¯gerritæœåŠ¡å’ŒNginxæœåŠ¡</h3><p>é‡å¯<code>gerrit</code>å’Œ<code>nginx</code>æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ /home/gerrit/review_site/bin/gerrit.sh restart</span><br><span class="line"><span class="comment"># systemctl restart nginx</span></span><br></pre></td></tr></table></figure><h2 id="æ­¥éª¤å…«ï¼šæµ‹è¯•"><a href="#æ­¥éª¤å…«ï¼šæµ‹è¯•" class="headerlink" title="æ­¥éª¤å…«ï¼šæµ‹è¯•"></a>æ­¥éª¤å…«ï¼šæµ‹è¯•</h2><p>è®¿é—®<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdO+8jOeUqGdlcnJpdOeUqOaIt+eZu+W9le+8jOeZu+W9leeVjOmdouWmguS4iw==" title="http://localhostï¼Œç”¨gerritç”¨æˆ·ç™»å½•ï¼Œç™»å½•ç•Œé¢å¦‚ä¸‹">http://localhostï¼Œç”¨gerritç”¨æˆ·ç™»å½•ï¼Œç™»å½•ç•Œé¢å¦‚ä¸‹<i class="fa fa-external-link"></i></span></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/74/51196a5c04235cfbd07cf5a09e1b95.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/79/114d466e1f80823db828265ede65ee.jpg" alt></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      CentOSå®‰è£…éƒ¨ç½²ä»£ç å®¡æŸ¥å·¥å…·--Gerrit
    
    </summary>
    
      <category term="Linux" scheme="https://iamzhl.top/categories/Linux/"/>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/Linux/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Gerrit" scheme="https://iamzhl.top/tags/Gerrit/"/>
    
      <category term="ä»£ç å®¡æŸ¥" scheme="https://iamzhl.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins é…ç½®éƒ¨ç½²</title>
    <link href="https://iamzhl.top/Jenkins-configure-and-deploy.html"/>
    <id>https://iamzhl.top/Jenkins-configure-and-deploy.html</id>
    <published>2018-08-22T03:36:45.000Z</published>
    <updated>2019-03-11T16:21:49.895Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:27 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h1 id="Jenkins-é…ç½®éƒ¨ç½²"><a href="#Jenkins-é…ç½®éƒ¨ç½²" class="headerlink" title="Jenkins é…ç½®éƒ¨ç½²"></a><center><code>Jenkins</code> é…ç½®éƒ¨ç½²</center></h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„ã€æä¾›å‹å¥½æ“ä½œç•Œé¢çš„æŒç»­é›†æˆ(CI)å·¥å…·ï¼Œèµ·æºäºHudsonï¼ˆHudsonæ˜¯å•†ç”¨çš„ï¼‰ï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨çš„æ„å»º/æµ‹è¯•è½¯ä»¶é¡¹ç›®ã€ç›‘æ§å¤–éƒ¨ä»»åŠ¡çš„è¿è¡Œã€‚Jenkinsç”¨Javaè¯­è¨€ç¼–å†™ï¼Œå¯åœ¨Tomcatç­‰æµè¡Œçš„servletå®¹å™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯ç‹¬ç«‹è¿è¡Œã€‚é€šå¸¸ä¸ç‰ˆæœ¬ç®¡ç†å·¥å…·(SCM)ã€æ„å»ºå·¥å…·ç»“åˆä½¿ç”¨ï¼›å¸¸ç”¨çš„ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿæœ‰SVNã€GITï¼Œæ„å»ºå·¥å…·æœ‰Mavenã€Antã€Gradleã€‚å…¶å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>æ˜“äºå®‰è£…ï¼šä¸éœ€è¦å®‰è£…ã€ä¸éœ€è¦æ•°æ®åº“ï¼Œåªéœ€é€šè¿‡java -jar jenkins.waræˆ–éƒ¨ç½²åˆ°ä¸€ä¸ªservletå®¹å™¨ä¸­ã€‚</li><li>æ˜“äºé…ç½®ï¼šæ‰€æœ‰çš„é…ç½®éƒ½å¯èƒ½é€šè¿‡Jenkinsæä¾›çš„webç•Œé¢å®Œæˆï¼Œå½“ç„¶å¦‚æœä½ å–œæ¬¢ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹xmlæ–‡ä»¶è¿›è¡Œé…ç½®ã€‚</li><li>æ¶ˆæ¯é€šçŸ¥åŠæµ‹è¯•æŠ¥å‘Šï¼šèƒ½å¤Ÿç”Ÿæˆå„ç±»æµ‹è¯•æŠ¥å‘Šå¹¶é€šè¿‡æ¶ˆæ¯é€šçŸ¥æœºåˆ¶ï¼ˆEmailç­‰ï¼‰è¿›è¡ŒæŠ¥å‘Šï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€è¦†ç›–ç‡æµ‹è¯•ã€é™æ€åˆ†æç­‰ã€‚</li><li>åˆ†å¸ƒå¼æ„å»ºï¼šJenkinsæ”¯æŒå¤šä¸ªSlaveèŠ‚ç‚¹çš„åŠ¨æ€æŒ‚è½½ï¼Œå®Œæˆåˆ†å¸ƒå¼æ„å»ºã€‚</li><li>èµ„æºåŠ¨æ€è°ƒåº¦ï¼šJenkinsçš„å®¹å™¨èµ„æºé€šè¿‡KubernetesåŠ¨æ€è°ƒåº¦ï¼ŒåŠ¨æ€æ‰©å®¹æ”¶ç¼©ã€‚</li><li>æ’ä»¶æ”¯æŒï¼šJenkinsæ”¯æŒä¸Šåƒç§æ’ä»¶ï¼Œå¯ä»¥è¿›è¡Œæ‰©å±•ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚è¿‘å®šåˆ¶å¼€å‘ã€‚</li></ul><h2 id="å®‰è£…éƒ¨ç½²"><a href="#å®‰è£…éƒ¨ç½²" class="headerlink" title="å®‰è£…éƒ¨ç½²"></a>å®‰è£…éƒ¨ç½²</h2><p>ä»¥CentOSç¯å¢ƒå®‰è£…éƒ¨ç½²ä¸ºä¾‹ï¼Œè¯¦ç»†ä»‹ç»Jenkinså®‰è£…éƒ¨ç½²æ•´ä½“è¿‡ç¨‹å’Œå¸¸ç”¨è®¾ç½®ã€‚</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><h4 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h4><p>å¦‚æœä½¿ç”¨Jenkins.waråŒ…çš„å½¢å¼è¿›è¡Œå®‰è£…ï¼Œéœ€è¦æå‰å‡†å¤‡ä»¥ä¸‹ç¯å¢ƒã€‚</p><h5 id="Javaç¯å¢ƒå‡†å¤‡"><a href="#Javaç¯å¢ƒå‡†å¤‡" class="headerlink" title="Javaç¯å¢ƒå‡†å¤‡"></a>Javaç¯å¢ƒå‡†å¤‡</h5><h6 id="å»å®˜ç½‘ä¸‹è½½JDKï¼š"><a href="#å»å®˜ç½‘ä¸‹è½½JDKï¼š" class="headerlink" title="å»å®˜ç½‘ä¸‹è½½JDKï¼š"></a>å»å®˜ç½‘ä¸‹è½½<code>JDK</code>ï¼š</h6><p><span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3RlY2huZXR3b3JrL2phdmEvamF2YXNlL2Rvd25sb2Fkcy9qYXZhLWFyY2hpdmUtamF2YXNlOC0yMTc3NjQ4Lmh0bWw=" title="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html">http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html<i class="fa fa-external-link"></i></span></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/81/1b33b7e9dbe92a1515154d0193194f.jpg" alt></p><h6 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h6><ul><li>å°†ä¸‹è½½å¾—åˆ°çš„<code>jdk-8u161-linux-x64.rpm</code>åŒ…ä¿å­˜åˆ°<code>Linux</code>ä¸»æœº</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -ivh jdk-8u161-linux-x64.rpm</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/ad/4301bf0ab8d0d138ded7bc3709fd4a.jpg" alt></p><h6 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim ~/.bashrc</span></span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_161</span><br><span class="line">export JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">export CLASSPATH=$JAVA_HOME/lib</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin:$CLASSPATH</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/49/6ac74e90a641e355b29b9c4d17deb9.jpg" alt></p><p>ä½¿ç¯å¢ƒé…ç½®ç”Ÿæ•ˆ<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source ~/.bashrc</span></span><br></pre></td></tr></table></figure><p></p><h6 id="æµ‹è¯•Javaç¯å¢ƒ"><a href="#æµ‹è¯•Javaç¯å¢ƒ" class="headerlink" title="æµ‹è¯•Javaç¯å¢ƒ"></a>æµ‹è¯•<code>Java</code>ç¯å¢ƒ</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># java -version</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æŸ¥çœ‹æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œè‹¥æ˜¾ç¤ºåˆ™å®‰è£…æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/2f/49c7d622b298ae690db3c13754c1b1.jpg" alt></p><h5 id="Tomcatç¯å¢ƒå‡†å¤‡"><a href="#Tomcatç¯å¢ƒå‡†å¤‡" class="headerlink" title="Tomcatç¯å¢ƒå‡†å¤‡"></a>Tomcatç¯å¢ƒå‡†å¤‡</h5><h6 id="ä¸‹è½½Tomcat"><a href="#ä¸‹è½½Tomcat" class="headerlink" title="ä¸‹è½½Tomcat"></a>ä¸‹è½½Tomcat</h6><blockquote><p>åœ°å€: <span class="exturl" data-url="aHR0cDovL21pcnJvcnMuc2h1LmVkdS5jbi9hcGFjaGUvdG9tY2F0L3RvbWNhdC04L3Y4LjUuMzIvYmluL2FwYWNoZS10b21jYXQtOC41LjMyLnRhci5neg==" title="http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v8.5.32/bin/apache-tomcat-8.5.32.tar.gz">http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v8.5.32/bin/apache-tomcat-8.5.32.tar.gz<i class="fa fa-external-link"></i></span></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v8.5.32/bin/apache-tomcat-8.5.32.tar.gz</span></span><br></pre></td></tr></table></figure><h6 id="å®‰è£…Tomcat"><a href="#å®‰è£…Tomcat" class="headerlink" title="å®‰è£…Tomcat"></a>å®‰è£…Tomcat</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxvf apache-tomcat-8.5.32.tar.gz</span></span><br><span class="line"><span class="comment"># mv apache-tomcat-8.5.32 /usr/local/</span></span><br></pre></td></tr></table></figure><h6 id="é…ç½®Tomcatç¯å¢ƒ"><a href="#é…ç½®Tomcatç¯å¢ƒ" class="headerlink" title="é…ç½®Tomcatç¯å¢ƒ"></a>é…ç½®Tomcatç¯å¢ƒ</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim ~/.bashrc</span></span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export CATALINA_BASE=/usr/local/apache-tomcat-8.5.32</span><br><span class="line">export TOMCAT_HOME=/usr/local/apache-tomcat-8.5.32</span><br><span class="line">export CATALINA_HOME=/usr/local/apache-tomcat-8.5.32</span><br><span class="line">export PATH=$PATH:$CATALINA_HOME/bin:$CATALINA_HOME/lib</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/66/1656ee9280886c6c7de6057c8835cd.jpg" alt></p><p>ä½¿ç¯å¢ƒé…ç½®ç”Ÿæ•ˆ<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source ~/.bashrc</span></span><br></pre></td></tr></table></figure><p></p><h6 id="å¯åŠ¨TomcatæœåŠ¡"><a href="#å¯åŠ¨TomcatæœåŠ¡" class="headerlink" title="å¯åŠ¨TomcatæœåŠ¡"></a>å¯åŠ¨TomcatæœåŠ¡</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># startup.sh</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/f9/4e6e503aa6fe748959adfb182e3e1c.jpg" alt></p><h6 id="æµ‹è¯•Tomcat"><a href="#æµ‹è¯•Tomcat" class="headerlink" title="æµ‹è¯•Tomcat"></a>æµ‹è¯•Tomcat</h6><p>æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥<span class="exturl" data-url="aHR0cDovL0lQOjgwODDlm57ovabvvIzlpoLmnpznnIvliLBUb21jYXToh6rluKbnmoTkuIDkuKpKU1DpobXpnaLvvIzor7TmmI7kvaDnmoRUb21jYXTlt7LmkK3lu7rmiJDlip8=" title="http://IP:8080å›è½¦ï¼Œå¦‚æœçœ‹åˆ°Tomcatè‡ªå¸¦çš„ä¸€ä¸ªJSPé¡µé¢ï¼Œè¯´æ˜ä½ çš„Tomcatå·²æ­å»ºæˆåŠŸ">http://IP:8080å›è½¦ï¼Œå¦‚æœçœ‹åˆ°Tomcatè‡ªå¸¦çš„ä¸€ä¸ªJSPé¡µé¢ï¼Œè¯´æ˜ä½ çš„Tomcatå·²æ­å»ºæˆåŠŸ<i class="fa fa-external-link"></i></span></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/43/36596794bdf3af70f1ecd35f8c40a0.jpg" alt></p><h3 id="å®‰è£…éƒ¨ç½²-1"><a href="#å®‰è£…éƒ¨ç½²-1" class="headerlink" title="å®‰è£…éƒ¨ç½²"></a>å®‰è£…éƒ¨ç½²</h3><h4 id="ä¸‹è½½waræ–‡ä»¶"><a href="#ä¸‹è½½waræ–‡ä»¶" class="headerlink" title="ä¸‹è½½waræ–‡ä»¶"></a>ä¸‹è½½waræ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Jenkins"><a href="#å®‰è£…Jenkins" class="headerlink" title="å®‰è£…Jenkins"></a>å®‰è£…Jenkins</h4><p>å°†ä¸‹è½½åçš„waråŒ…æ”¾åˆ°/usr/local/apache-tomcat-8.5.32/webapps/ç›®å½•ä¸‹ï¼Œå¯åŠ¨tomcatå³å¯ï¼Œ æˆ–è€…ç”¨å‘½ä»¤<code>java -jar jenkins.war</code>ã€‚</p><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥<span class="exturl" data-url="aHR0cDovL0lQOjgwODAvamVua2luc+Wbnui9puWNs+WPr+eci+WIsGplbmtpbuWIneWni+mFjee9rueVjOmdou+8jOaMieeFp+aPkOekuui/m+ihjOiuvue9ruOAgg==" title="http://IP:8080/jenkinså›è½¦å³å¯çœ‹åˆ°jenkinåˆå§‹é…ç½®ç•Œé¢ï¼ŒæŒ‰ç…§æç¤ºè¿›è¡Œè®¾ç½®ã€‚">http://IP:8080/jenkinså›è½¦å³å¯çœ‹åˆ°jenkinåˆå§‹é…ç½®ç•Œé¢ï¼ŒæŒ‰ç…§æç¤ºè¿›è¡Œè®¾ç½®ã€‚<i class="fa fa-external-link"></i></span></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/27/4f737ebea43eb34f747fb68a08b6fa.jpg" alt></p><h3 id="å¸¸ç”¨è®¾ç½®"><a href="#å¸¸ç”¨è®¾ç½®" class="headerlink" title="å¸¸ç”¨è®¾ç½®"></a>å¸¸ç”¨è®¾ç½®</h3><h5 id="é‚®ä»¶è®¾ç½®"><a href="#é‚®ä»¶è®¾ç½®" class="headerlink" title="é‚®ä»¶è®¾ç½®"></a>é‚®ä»¶è®¾ç½®</h5><p>Jenkins-&gt;ç³»ç»Ÿç®¡ç†-&gt;ç³»ç»Ÿè®¾ç½®ï¼Œå¼¹å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b0/075e39aad15468d3eb9cc0f6bf37f7.jpg" alt></p><ul><li>SMTPæœåŠ¡å™¨ï¼šä¸ºé‚®ç®±æœåŠ¡åœ°å€ã€‚<ul><li>QQ: smtp.qq.com</li><li>163: smtp.163.com</li></ul></li><li>ç”¨æˆ·é»˜è®¤åç¼€ï¼šå¯ä»¥è‡ªåŠ¨è¯†åˆ«ï¼Œåªéœ€å¡«å†™ç”¨æˆ·å³å¯ã€‚</li><li>å…¶ä»–é…ç½®ä¸ºJenkinsé‚®ç®±é»˜è®¤ç”¨æˆ·åŠé‡‡ç”¨çš„è®¤è¯æ–¹å¼ã€‚</li></ul><h5 id="Jobè®¾ç½®"><a href="#Jobè®¾ç½®" class="headerlink" title="Jobè®¾ç½®"></a>Jobè®¾ç½®</h5><p>åœ¨éœ€è¦é‚®ä»¶é€šçŸ¥çš„Jobè®¾ç½®é‡Œé¢å¢åŠ â€æ„å»ºåæ“ä½œæ­¥éª¤â€ -&gt; é€‰æ‹©E-mail Notificationã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/82/3005620b29b6fc4b2c9e3ce729af8b.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/9e/a3153b262215e17561eb34674635e2.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/6d/dce01f6fa0a84d625f0eb55759c422.jpg" alt></p><h5 id="æ‰©å±•æ’ä»¶è®¾ç½®"><a href="#æ‰©å±•æ’ä»¶è®¾ç½®" class="headerlink" title="æ‰©å±•æ’ä»¶è®¾ç½®"></a>æ‰©å±•æ’ä»¶è®¾ç½®</h5><p>ä½†æ˜¯å¦‚æœä½ ç¾¤å‘çš„æ”¶ä»¶äººåˆ—è¡¨æ¯”è¾ƒå¤šï¼Œæˆ–è€…æ¯æ¬¡é€šçŸ¥çš„äººä¸ä¸€æ ·ï¼Œæ¯”å¦‚æ¯æ¬¡åªæƒ³é€šçŸ¥å¯¼è‡´æ„å»ºå¤±è´¥çš„é‚£ä¸ªäººï¼ˆå³æœ€åä¸€æ¬¡ä¸Šä¼ ä»£ç çš„äººï¼‰ï¼Œé‚£ä¹ˆç®€å•çš„E-mail Notificationå°±ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œéœ€è¦ä½¿ç”¨Email extension pluginæ’ä»¶ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/18/0775061dcf193cc08da229cef10eda.jpg" alt></p><ul><li>SMTP server â€“ è®¾ç½®SMTPæœåŠ¡å™¨åœ°å€</li><li>Default user E-mail suffix â€“ è®¾ç½®ç”¨æˆ·é»˜è®¤é‚®ä»¶åç¼€</li><li>Default Content Type â€“ é»˜è®¤å†…å®¹ç±»å‹(Plain Text HTML)</li><li>Default Subject â€“ é»˜è®¤é‚®ä»¶ä¸»é¢˜</li><li>Default Content â€“ é»˜è®¤é‚®ä»¶å†…å®¹ï¼Œå¯ä»¥è®¾ç½®æ¨¡æ¿</li><li><p>Default Triggers â€“ è§¦å‘å™¨</p></li><li><p>[ ] å…¨å±€é…ç½®<br>æ ¹æ®å®é™…æƒ…å†µå‹¾é€‰éœ€è¦è§¦å‘é‚®ä»¶é€šçŸ¥çš„äº‹ä»¶ã€‚ç‚¹å‡»ä¸Šå›¾å³ä¸‹è§’Default Triggerï¼Œå¼¹å‡ºå¦‚ä¸‹è§¦å‘é¡¹ï¼š</p></li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/69/3127442cf5a527b984d83738c31e6f.jpg" alt></p><ul><li style="list-style:none"><input type="checkbox"> é¡¹ç›®é…ç½®<br>è¿›å…¥åˆ°å…·ä½“çš„é¡¹ç›®é…ç½®ç•Œé¢ç‚¹å‡»â€é…ç½®ï¼Œåœ¨é…ç½®ç•Œé¢ç‚¹å‡»â€å¢åŠ æ„å»ºåæ“ä½œæ­¥éª¤â€ï¼Œé€‰æ‹©â€Editable Email Notificationâ€ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/71/133a454b2ee120f2b1df930b4ca9fe.jpg" alt></p><p>å¯ä»¥åœ¨â€œAdvanced Settingsâ€ä¸­é’ˆå¯¹è¯¥é¡¹ç›®è¿›è¡Œä¸ªæ€§åŒ–çš„é…ç½®ã€‚å¯ä»¥é’ˆå¯¹è¯¥é¡¹ç›®å®šä¹‰è¯¥é¡¹ç›®é€šçŸ¥çš„æ”¶ä»¶äººåˆ—è¡¨ã€ä¸»é¢˜ã€å†…å®¹ã€é™„ä»¶ç­‰ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/53/67346392186853caab6ee621418aa4.jpg" alt></p><h4 id="ä»»åŠ¡åˆ›å»º"><a href="#ä»»åŠ¡åˆ›å»º" class="headerlink" title="ä»»åŠ¡åˆ›å»º"></a>ä»»åŠ¡åˆ›å»º</h4><h5 id="æ„å»ºé¡¹ç›®ç±»å‹"><a href="#æ„å»ºé¡¹ç›®ç±»å‹" class="headerlink" title="æ„å»ºé¡¹ç›®ç±»å‹"></a>æ„å»ºé¡¹ç›®ç±»å‹</h5><p>ç‚¹å‡» Jenkins é¦–é¡µâ€åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡â€çš„é“¾æ¥ï¼Œå¼¹å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºé¡µé¢ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/04/c97a32a6b1285a76a6edb8497a1cd3.jpg" alt></p><p>Jenkins æä¾›äº†å…­ç§ç±»å‹çš„ä»»åŠ¡ã€‚</p><ul><li><p>æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®<br>è¿™æ˜¯Jenkinsçš„ä¸»è¦åŠŸèƒ½ã€‚Jenkins ä¼šç»“åˆä»»ä½• SCM å’Œä»»ä½•æ„å»ºç³»ç»Ÿæ¥æ„å»ºä½ çš„é¡¹ç›®, ç”šè‡³å¯ä»¥æ„å»ºè½¯ä»¶ä»¥å¤–çš„ç³»ç»Ÿã€‚</p></li><li><p>Pipeline(æµæ°´çº¿)<br>Orchestrates long-running activities that can span multiple build slaves. Suitable for building pipelines (formerly known as workflows) and/or organizing complex activities that do not easily fit in free-style job type. â€“ å¾ˆéš¾ç”¨ä¸€ä¸¤å¥è¯è¯´æ¸… Pipeline, å‚è€ƒ , åé¢å¦èµ·ä¸€æ–‡æ¥ä»‹ç»ã€‚</p></li><li><p>æ„å»ºä¸€ä¸ªå¤šé…ç½®é¡¹ç›®<br>é€‚ç”¨äºå¤šé…ç½®é¡¹ç›®,ä¾‹å¦‚å¤šç¯å¢ƒæµ‹è¯•ã€å¹³å°æŒ‡å®šæ„å»º,ç­‰ç­‰ã€‚</p></li><li><p>GitHub Organization<br>Scans a GitHub organization (or user account) for all repositories matching some defined markers. â€“ è¿™ä¸ªä¸»è¦é’ˆå¯¹ç”± Github æ‰˜ç®¡çš„é¡¹ç›®ã€‚</p></li><li><p>Multibranch Pipeline(å¤šåˆ†æ”¯æµæ°´çº¿)<br>Creates a set of Pipeline projects according to detected branches in one SCM repository. æ ¹æ®ä¸€ä¸ªSCMå­˜å‚¨åº“ä¸­æ£€æµ‹åˆ°çš„åˆ†æ”¯åˆ›å»ºä¸€ç»„ Pipeline é¡¹ç›®ã€‚</p></li><li><p>æ–‡ä»¶å¤¹<br>åˆ›å»ºä¸€ä¸ªå¯ä»¥åµŒå¥—å­˜å‚¨çš„å®¹å™¨ã€‚åˆ©ç”¨å®ƒå¯ä»¥è¿›è¡Œåˆ†ç»„ã€‚ è§†å›¾ä»…ä»…æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè€Œæ–‡ä»¶å¤¹åˆ™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´ï¼Œ å› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªç›¸åŒåç§°çš„çš„å†…å®¹ï¼Œåªè¦å®ƒä»¬åœ¨ä¸åŒçš„æ–‡ä»¶ å¤¹é‡Œå³å¯ã€‚</p></li></ul><p>è¿™é‡Œé€‰æ‹©ç¬¬ä¸€ä¸ªï¼šæ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ï¼Œ è¾“å…¥é¡¹ç›®åç§°ï¼špython test project ï¼Œç‚¹å‡»â€ç¡®å®šâ€æŒ‰é’®ã€‚</p><h5 id="æ„å»º-Windows-æµ‹è¯•ä»»åŠ¡"><a href="#æ„å»º-Windows-æµ‹è¯•ä»»åŠ¡" class="headerlink" title="æ„å»º Windows æµ‹è¯•ä»»åŠ¡"></a>æ„å»º Windows æµ‹è¯•ä»»åŠ¡</h5><p>å‡è®¾ï¼Œæœ‰ä¸€ä¸ª Python ç¼–å†™çš„æµ‹è¯•è„šæœ¬ py_tests.py ï¼Œå…¶ç»å¯¹è·¯å¾„ä¸º/root/py_tests.pyï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">"Hello world"</span></span><br></pre></td></tr></table></figure><p>åœ¨Linuxä¸‹æ€ä¹ˆæ‰§è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ‰“å¼€ç»ˆç«¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-7 ~]# cd</span><br><span class="line">[root@centos-7 ~]# ll py_tests.py</span><br><span class="line">-rw-r--r--. 1 root root 20 8æœˆ  16 16:07 py_tests.py</span><br><span class="line">[root@centos-7 ~]# python py_tests.py</span><br><span class="line">Hello world</span><br><span class="line">[root@centos-7 ~]#</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å›åˆ°Jenkinsçš„é…ç½®è¿‡ç¨‹ä¸­</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/ab/46e2f5d22700eb539eac4128e19c85.jpg" alt></p><p>æ·»åŠ é¡¹ç›®çš„æè¿°ï¼šPython æµ‹è¯•é¡¹ç›®ï¼Œæ‰“å°Hello worldã€‚</p><p>å‰©ä¸‹çš„é€‰é¡¹éƒ½ä¸è¦ç®¡ï¼Œæ‹–åˆ°é¡µé¢åº•éƒ¨ï¼Œæ„å»º é€‰é¡¹ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/e0/dab0e9e3d049db8a84ee83f85582de.jpg" alt></p><p>é€‰æ‹©<code>æ‰§è¡Œshell</code>é€‰é¡¹ï¼Œæ‰§è¡ŒLinux shellå‘½ä»¤ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/c6/ef1db64d383033d03b465af7f3771d.jpg" alt></p><p>å¦‚ä¸Šå›¾ï¼Œè¾“å…¥ä½ åœ¨ Linux ç»ˆç«¯ä¸‹æ‰€è¾“çš„å‘½ä»¤<code>python /root/py_tests.py</code>ã€‚ ç‚¹å‡»<code>ä¿å­˜</code>ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/8f/6c232d4632eb024fa2cadcf0fbfc13.jpg" alt></p><p>ä¸€ä¸ªæç®€çš„ï¼ŒåŸºäº Linux ç³»ç»Ÿçš„ Python è„šæœ¬æµ‹è¯•æŒç»­é›†æˆé¡¹ç›®å°±åˆ›å»ºå®Œæˆäº†ã€‚</p><h4 id="èŠ‚ç‚¹æ·»åŠ "><a href="#èŠ‚ç‚¹æ·»åŠ " class="headerlink" title="èŠ‚ç‚¹æ·»åŠ "></a>èŠ‚ç‚¹æ·»åŠ </h4><p>Jenkinsæœ‰ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼šåˆ†å¸ƒå¼æ„å»º(åœ¨Jenkinsçš„é…ç½®ä¸­å«åšèŠ‚ç‚¹)ï¼Œåˆ†å¸ƒå¼æ„å»ºèƒ½å¤Ÿè®©åŒä¸€å¥—ä»£ç åœ¨ä¸åŒçš„ç¯å¢ƒ(å¦‚ï¼šWindowså’ŒLinuxç³»ç»Ÿ)ä¸­ç¼–è¯‘ã€æµ‹è¯•ç­‰ã€‚è€Œä¸”Jenkinsæ„å»ºçš„ä»£ç å’Œäº§ç‰©æœ€åè‡ªåŠ¨æ‹·è´åˆ°ä¸»èŠ‚ç‚¹ã€‚</p><p><strong>æ³¨æ„ï¼šå¦‚æœèŠ‚ç‚¹ä¸»æœºä¸Šä¸å­˜åœ¨JDKï¼ŒJenkinsä¼šå»è‡ªåŠ¨ä¸‹è½½ã€‚</strong></p><p><strong>å»ºè®®ï¼šæ‰€æœ‰Unixæˆ–è€…Windowsæœºå™¨çš„ç¯å¢ƒè·¯å¾„ç»Ÿä¸€(å¦‚ï¼šJDKã€Antã€Maven)ï¼Œå¥½å¤„æ˜¯ä¾¿äºç®¡ç†ã€ä¸å®¹æ˜“å‡ºç°å¥‡è‘©é—®é¢˜ã€‚</strong></p><h5 id="æ–°å»ºèŠ‚ç‚¹"><a href="#æ–°å»ºèŠ‚ç‚¹" class="headerlink" title="æ–°å»ºèŠ‚ç‚¹"></a>æ–°å»ºèŠ‚ç‚¹</h5><p>ç³»ç»Ÿç®¡ç† â†’ ç®¡ç†èŠ‚ç‚¹ â†’ æ–°å»ºèŠ‚ç‚¹(å·¦ä¸Šè§’)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/1e/067a4f7fa85272fa79f85208c937c0.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/eb/3eb8f07110c1e29abe65035fdc2b04.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/bb/e82fc1380ecf612e70e06bc156e17e.jpg" alt></p><p>&emsp;&emsp;èŠ‚ç‚¹åç§°ï¼šå»ºè®®ä½¿ç”¨å­—æ¯ã€æ•°å­—æˆ–å­—æ¯å’Œæ•°å­—çš„ç»„åˆã€‚æœ€å¥½è§åçŸ¥æ„ã€‚ä¸å»ºè®®ä½¿ç”¨æ ‡ç‚¹ç¬¦å·å’Œä¸­æ–‡(ä¸­æ–‡å‘½åæ²¡æœ‰é—®é¢˜ï¼Œä½†Jobä¸­æ— æ³•å¼•ç”¨)ã€‚</p><h5 id="é…ç½®èŠ‚ç‚¹"><a href="#é…ç½®èŠ‚ç‚¹" class="headerlink" title="é…ç½®èŠ‚ç‚¹"></a>é…ç½®èŠ‚ç‚¹</h5><ul><li>Name(åç§°)ï¼šèŠ‚ç‚¹åç§°</li><li>Description(æè¿°)ï¼šèŠ‚ç‚¹æè¿°ï¼Œæ”¯æŒä¸­æ–‡</li><li>å¹¶å‘æ„å»ºæ•°ï¼šæœ€å¤§åŒæ—¶æ„å»ºæ•°é‡(æ ¹æ®æœºå™¨çš„æ€§èƒ½å®šï¼Œå•é¢—å››æ ¸cpuå»ºè®®ä¸è¦è¶…è¿‡5) - å¿…é¡»ä¸ºæ•°å­—</li><li>è¿œç¨‹å·¥ä½œç›®å½•ï¼šèŠ‚ç‚¹çš„æ ¹ç›®å½•(æ³¨æ„ï¼šå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºç›®å½•ã€‚ä½ å¿…é¡»å¯¹è¯¥ç›®å½•æœ‰è¯»å†™æƒé™ï¼Œä¸ç„¶ä¼šæŠ¥é”™)</li><li>æ ‡ç­¾ï¼šæ ‡è®°(åˆå«åšæ ‡ç­¾)ç”¨æ¥å¯¹å¤šèŠ‚ç‚¹åˆ†ç»„,æ ‡è®°ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”.ä¾‹å¦‚â€™refression java6â€™å°†ä¼šæŠŠä¸€ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸Šâ€™regressionâ€™å’Œâ€™java6â€™.</li></ul><blockquote><p>ä¾‹æ¥è¯´,å¦‚æœä½ æœ‰å¤šä¸ªLinuxç³»ç»Ÿçš„æ„å»ºèŠ‚ç‚¹å¹¶ä¸”ä½ çš„Jobä¹Ÿéœ€è¦åœ¨Linuxç³»ç»Ÿä¸Šè¿è¡Œ,é‚£ä¹ˆä½ å¯ä»¥é…ç½®æ‰€æœ‰çš„Linuxç³»ç»ŸèŠ‚ç‚¹éƒ½æ ‡è®°ä¸ºâ€™windowsâ€™, ç„¶åæŠŠJobä¹Ÿæ ‡è®°ä¸ºâ€™Linuxâ€™.è¿™æ ·çš„è¯ä½ çš„Jobå°±ä¸ä¼šè¿è¡Œåœ¨é™¤äº†LinuxèŠ‚ç‚¹ä»¥å¤–çš„å…¶å®ƒèŠ‚ç‚¹ä¹‹ä¸Šäº†.<br>Linuxç”¨æ³•ï¼šå°½å¯èƒ½çš„ä½¿ç”¨è¿™ä¸ªèŠ‚ç‚¹/åªå…è®¸è¿è¡Œç»‘å®šåˆ°è¿™å°æœºå™¨çš„Job(æ ¹æ®ä½ çš„éœ€æ±‚ï¼ŒäºŒé€‰ä¸€)</p></blockquote><ul><li>å¯åŠ¨æ–¹å¼ï¼š<ul><li>LinuxèŠ‚ç‚¹ï¼šæ¨è â€“ Launch slave agents via SSHï¼Œ åœ¨Unix(åŒ…æ‹¬Linux)æœºå™¨ä¸Šé€šè¿‡SSHé€šé“è¿æ¥èŠ‚ç‚¹ (é€‚ç”¨äºUnixå’ŒLinux)</li><li>Host(ä¸»æœº)ï¼šèŠ‚ç‚¹ä¸»æœºçš„ipåœ°å€</li><li>Credentialsï¼šå‡­æ®(å¦‚æœä¸ºç©ºæˆ–è€…ä¸å¯é€‰æ‹©ï¼Œè¯·åœ¨ç³»ç»Ÿç®¡ç†â†’Manage Credentialsä¸­é…ç½®ã€‚Manage Credentialsçš„é…ç½®éå¸¸ç®€å•ï¼Œè¿™é‡Œå°±ä¸åœ¨æè¿°äº†ã€‚Manage Credentialsé…ç½®å®Œæˆåï¼Œéœ€åˆ·æ–°èŠ‚ç‚¹é…ç½®é¡µé¢æ‰ä¼šæ˜¾ç¤ºã€‚)</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/35/d7416430314fd19e34a01ac59ff464.jpg" alt></p><h5 id="èŠ‚ç‚¹è¿æ¥"><a href="#èŠ‚ç‚¹è¿æ¥" class="headerlink" title="èŠ‚ç‚¹è¿æ¥"></a>èŠ‚ç‚¹è¿æ¥</h5><p>ä»¥Launch slave agents via SSHä¸ºä¾‹ï¼Œé€‰æ‹©Manually trusted key Verification Strategyï¼Œç„¶åç‚¹å‡»æœ€ä¸‹é¢çš„ä¿å­˜ã€‚</p><p>Jenkins -&gt; ç³»ç»Ÿç®¡ç† -&gt; ç³»ç»Ÿè®¾ç½®ï¼Œè®¾ç½®SSH Server</p><ul><li>Name: è¿™ä¸ªå¯ä»¥éšæ„å†™</li><li>Hostname: è¿œç¨‹ä¸»æœºçš„IPåœ°å€</li><li>Username: è¿œç¨‹ä¸»æœºç™»å½•çš„ç”¨æˆ·å</li><li>Remote Directory: è¿œç¨‹ç›®å½•</li></ul><p>å¦‚å›¾è®¾ç½®å¥½ä¿¡æ¯åï¼Œç‚¹å‡»ä¸‹é¢çš„ä¿å­˜</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/3f/b787c0c1b5bab76ad878fbb47542ad.jpg" alt></p><p>Jenkins -&gt; ç³»ç»Ÿç®¡ç† -&gt; ç®¡ç†èŠ‚ç‚¹ï¼Œç‚¹å‡»åˆšåˆšé…ç½®å¥½çš„èŠ‚ç‚¹ï¼Œä¸Šçº¿èŠ‚ç‚¹</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/1d/1f61d958c23269f4fcc4a7ae295b0b.jpg" alt></p><p>å›åˆ°èŠ‚ç‚¹åˆ—è¡¨åå‘ç°èŠ‚ç‚¹å°±å·²ç»æˆåŠŸä¸Šçº¿äº†</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a4/346c91e15903e43bc6759a7c566502.jpg" alt></p><h4 id="è§’è‰²æƒé™"><a href="#è§’è‰²æƒé™" class="headerlink" title="è§’è‰²æƒé™"></a>è§’è‰²æƒé™</h4><p>ç”±äºjenkinsé»˜è®¤çš„æƒé™ç®¡ç†ä½“ç³»ä¸æ”¯æŒç”¨æˆ·ç»„æˆ–è§’è‰²çš„é…ç½®ï¼Œå› æ­¤éœ€è¦å®‰è£…ç¬¬ä¸‰å‘æ’ä»¶æ¥æ”¯æŒè§’è‰²çš„é…ç½®ï¼Œæœ¬æ–‡å°†ä½¿ç”¨Role Strategy Pluginï¼Œä»‹ç»é¡µé¢ï¼š<span class="exturl" data-url="aHR0cHM6Ly93aWtpLmplbmtpbnMtY2kub3JnL2Rpc3BsYXkvSkVOS0lOUy9Sb2xlK1N0cmF0ZWd5K1BsdWdpbuOAgg==" title="https://wiki.jenkins-ci.org/display/JENKINS/Role+Strategy+Pluginã€‚">https://wiki.jenkins-ci.org/display/JENKINS/Role+Strategy+Pluginã€‚<i class="fa fa-external-link"></i></span></p><h5 id="é…ç½®æ’ä»¶"><a href="#é…ç½®æ’ä»¶" class="headerlink" title="é…ç½®æ’ä»¶"></a>é…ç½®æ’ä»¶</h5><p>å®‰è£…æ’ä»¶åï¼Œè¿›å…¥ç³»ç»Ÿè®¾ç½®é¡µé¢ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/89/a69327d3e04b1b57ff022132e9f5a5.jpg" alt></p><h5 id="é…ç½®æƒé™"><a href="#é…ç½®æƒé™" class="headerlink" title="é…ç½®æƒé™"></a>é…ç½®æƒé™</h5><p>åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢ç‚¹å‡»Manage and Assign Rolesè¿›å…¥è§’è‰²ç®¡ç†é¡µé¢</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/90/a06f0b7e2eff8c0a9d81576497ff0c.jpg" alt></p><p>è¿›å…¥ä¹‹å</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/be/1bbe3e8858dbac44ac5a1fa2451883.jpg" alt></p><ul><li>ç®¡ç†è§’è‰²ï¼ˆManage Rolesï¼‰<br>é€‰æ‹©è¯¥é¡¹å¯ä»¥åˆ›å»ºå…¨å±€è§’è‰²ã€é¡¹ç›®è§’è‰²ï¼Œå¹¶å¯ä»¥ä¸ºè§’è‰²åˆ†é…æƒé™ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b8/ea91c0ea7091dca3faf3c86356da16.jpg" alt></p><p>;å¦‚ä¸Šå›¾ï¼Œåˆ†åˆ«åˆ›å»ºäº†adminã€anonymousä¸¤ä¸ªå…¨å±€è§’è‰²ï¼ŒOnline Programã€testä¸¤ä¸ªé¡¹ç›®è§’è‰²ã€‚</p><p>&emsp;&emsp;é¡¹ç›®è§’è‰²ä¸å…¨å±€è§’è‰²çš„åŒºåˆ«å°±æ˜¯ï¼Œé¡¹ç›®è§’è‰²åªèƒ½ç®¡ç†é¡¹ç›®ï¼Œæ²¡æœ‰ç®¡ç†jenkinsçš„æƒé™é…ç½®ã€‚</p><p>&emsp;&emsp;æ·»åŠ é¡¹ç›®è§’è‰²æ—¶ï¼Œéœ€è¦æŒ‡å®šåŒ¹é…é¡¹ç›®çš„æ¨¡å¼ï¼Œå¦‚ä¸Šå›¾ä¸­çš„Patternï¼Œå®˜æ–¹æ–‡æ¡£ä»‹ç»è¯¥é€‰é¡¹æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚â€Roger-.â€è¡¨ç¤ºæ‰€æœ‰ä»¥Roger-å¼€å¤´çš„é¡¹ç›®ï¼Œ<code>(?i)roger-.*</code>è¡¨ç¤ºä»¥roger-å¼€å¤´çš„é¡¹ç›®å¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¦‚ä»¥ABCå¼€å¤´çš„é¡¹ç›®å¯ä»¥é…ç½®ä¸ºâ€ABC|ABC.*â€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨â€abc|bcd|efgâ€ç›´æ¥åŒ¹é…å¤šä¸ªé¡¹ç›®ã€‚</p><ul><li>åˆ›å»ºç”¨æˆ·<br>åœ¨åˆ†é…è§’è‰²ä¹‹å‰éœ€è¦å…ˆåˆ›å»ºç”¨æˆ·ã€‚<br>åœ¨ç³»ç»Ÿç®¡ç†é¡µé¢ï¼Œç‚¹å‡»ç®¡ç†ç”¨æˆ·ï¼š</li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/2e/6a8a273181a5357a4ca587a5c2ced9.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/60/d8fa2030fff834872c259f65720958.jpg" alt></p><p>&emsp;&emsp;ç‚¹å‡»æ–°å»ºä½¿ç”¨è€…å¯ä»¥åˆ›å»ºæ–°ç”¨æˆ·ï¼Œç‚¹å‡»ç”¨æˆ·IDæˆ–åç§°éƒ½å¯ä»¥ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ã€‚</p><p>&emsp;&emsp;é€‰æ‹©Assign Roleså¯ä»¥ä¸ºç”¨æˆ·åˆ†é…æ‰€å±è§’è‰²ï¼Œå¯ä»¥åˆ†é…å…¨å±€è§’è‰²å’Œé¡¹ç›®è§’è‰²ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/57/385c466d213dd9ead86034162d9029.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/93/ddef492ecd2995c5731ea8eb1e9ee1.jpg" alt></p><p>&emsp;&emsp;å¦‚ä¸Šå›¾ï¼Œå°†ä¸åŒçš„ç”¨æˆ·åˆ†åˆ«åˆ†é…ç»™ä¸åŒçš„è§’è‰²ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥å…·æœ‰è§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™ã€‚</p><h3 id="è¿è¡Œä¸ç»´æŠ¤"><a href="#è¿è¡Œä¸ç»´æŠ¤" class="headerlink" title="è¿è¡Œä¸ç»´æŠ¤"></a>è¿è¡Œä¸ç»´æŠ¤</h3><h4 id="Jenkinså‡çº§"><a href="#Jenkinså‡çº§" class="headerlink" title="Jenkinså‡çº§"></a>Jenkinså‡çº§</h4><ul><li>è¯´æ˜ï¼šJenkinsè¿­ä»£æ›´æ–°å¾ˆé¢‘ç¹ï¼Œä¸€èˆ¬1å‘¨æ›´æ–°ä¸€æ¬¡ï¼ŒåŠå¹´ä¸€ä¸ªå¤§ç‰ˆæœ¬ã€‚</li><li>å‡çº§ï¼šä¸‹è½½æ–°çš„waråŒ…ï¼Œæ›¿æ¢æ—§çš„waråŒ…ï¼Œé‡å¯å³å¯ã€‚ä¸‹è½½åœ°å€ä¸º<span class="exturl" data-url="aHR0cDovL21pcnJvcnMuamVua2lucy1jaS5vcmcv44CC" title="http://mirrors.jenkins-ci.org/ã€‚">http://mirrors.jenkins-ci.org/ã€‚<i class="fa fa-external-link"></i></span></li></ul><p><strong>PSï¼šå‡çº§å‰ï¼Œè¯·æµ‹è¯•è¯¥ç‰ˆæœ¬å’Œä½ æœ¬åœ°æ•°æ®çš„å…¼å®¹æ€§ã€‚å¦‚ä½•æµ‹è¯•ï¼šå°†JENKINS_HOMEæ‹·è´ä¸€ä»½åˆ°æ–°çš„æœºå™¨ï¼Œç”¨æ–°ç‰ˆçš„ç¨‹åºå¯åŠ¨ã€‚æµ‹è¯•å¯¹åº”çš„æ’ä»¶å’Œé…ç½®ã€‚</strong></p><h4 id="Jenkinsè¿ç§»å’Œå¤‡ä»½"><a href="#Jenkinsè¿ç§»å’Œå¤‡ä»½" class="headerlink" title="Jenkinsè¿ç§»å’Œå¤‡ä»½"></a>Jenkinsè¿ç§»å’Œå¤‡ä»½</h4><p>é¦–å…ˆæ‰¾åˆ°JENKINS_HOMEï¼Œä¸€èˆ¬åœ¨ç”¨æˆ·æ ¹ç›®å½•ä¸‹.jenkinsç›®å½•ï¼Œå› ä¸ºJenkinsçš„æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜æ”¾åœ¨JENKINS_HOMEç›®å½•ä¸­ã€‚æ‰€ä»¥ä¸ç®¡æ˜¯è¿ç§»è¿˜æ˜¯å¤‡ä»½ï¼Œåªéœ€è¦æ“ä½œJENKINS_HOMEå°±è¡Œäº†ã€‚</p><ul><li><p>è¿ç§»ï¼šå»ºè®®å°†JENKINS_HOMEæ‰“åŒ…åå†æ‹·è´ï¼ŒWindowsä¸Šå¯ä»¥ç”¨zipï¼Œrarç­‰ï¼ŒLinuxä¸Šæœ‰zipï¼Œtarç­‰ã€‚ç„¶åå°†æ‰“åŒ…çš„æ–‡ä»¶è§£å‹åˆ°æ–°çš„JENKINS_HOMEç›®å½•å°±è¡Œäº†ã€‚</p></li><li><p>å¤‡ä»½ï¼šå¦‚æœæ˜¯ä¸´æ—¶å¤‡ä»½ï¼Œæ•´ä¸ªå‹ç¼©æ–‡ä»¶å°±è¡Œäº†ã€‚</p></li><li><p>æ¢å¤ï¼šæ¢å¤çš„æ—¶å€™éœ€è¦å…ˆåœæ­¢jenkinsã€‚</p></li></ul><h4 id="ç§»åŠ¨ï¼Œåˆ é™¤æˆ–ä¿®æ”¹jobs"><a href="#ç§»åŠ¨ï¼Œåˆ é™¤æˆ–ä¿®æ”¹jobs" class="headerlink" title="ç§»åŠ¨ï¼Œåˆ é™¤æˆ–ä¿®æ”¹jobs"></a>ç§»åŠ¨ï¼Œåˆ é™¤æˆ–ä¿®æ”¹jobs</h4><p>å¯¹äºç§»åŠ¨æˆ–åˆ é™¤jobsï¼Œåªéœ€è¦ç®€å•åœ°ç§»åŠ¨æˆ–åˆ é™¤<code>$JENKINS_HOME/jobs</code>ç›®å½•ã€‚<br>å¯¹äºä¿®æ”¹jobsçš„åå­—ï¼Œåªéœ€è¦ç®€å•åœ°ä¿®æ”¹<code>$JENKINS_HOME/jobs</code>ä¸‹å¯¹åº”jobçš„æ–‡ä»¶å¤¹çš„åå­—ã€‚<br>å¯¹äºä¸ç»å¸¸ä½¿ç”¨çš„jobï¼Œåªéœ€è¦å¯¹<code>$JENKINS_HOME/jobs</code>ä¸‹å¯¹åº”çš„jobsçš„ç›®å½•zipæˆ–taråå­˜å‚¨åˆ°å…¶ä»–çš„åœ°æ–¹ã€‚</p><h4 id="Jenkins-å¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œå‚æ•°"><a href="#Jenkins-å¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="Jenkins å¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œå‚æ•°"></a>Jenkins å¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œå‚æ•°</h4><table><thead><tr><th><code>--httpPort=$HTTP_PORT</code></th><th>ç”¨æ¥è®¾ç½®jenkinsè¿è¡Œæ—¶çš„webç«¯å£ã€‚</th></tr></thead><tbody><tr><td><code>--httpsPort=$HTTP_PORT</code></td><td>è¡¨ç¤ºä½¿ç”¨httpsåè®®ã€‚</td></tr><tr><td>~~~~â€“httpListenAddress=$HTTP_HOST</td><td>ç”¨æ¥æŒ‡å®šjenkinsç›‘å¬çš„ipèŒƒå›´ï¼Œé»˜è®¤ä¸ºæ‰€æœ‰çš„ipéƒ½å¯ä»¥è®¿é—®æ­¤jenkins serverã€‚</td></tr></tbody></table><h4 id="ä¿®æ”¹jenkinsçš„timezone"><a href="#ä¿®æ”¹jenkinsçš„timezone" class="headerlink" title="ä¿®æ”¹jenkinsçš„timezone"></a>ä¿®æ”¹jenkinsçš„timezone</h4><p>å¦‚æœjenkinsæ‰€åœ¨çš„serverçš„timezoneä¸åŒäºç”¨æˆ·çš„timezoneï¼Œè¿™æ—¶å€™éœ€è¦ä¿®æ”¹jenkinsçš„timezoneï¼Œéœ€è¦åœ¨jenkinså¯åŠ¨çš„æ—¶å€™å¢åŠ ä¸‹åˆ—å‚æ•°-Dorg.apache.commons.jelly.tags.fmt.timeZone=TZã€‚</p><h4 id="æŸ¥çœ‹jenkinsçš„ç³»ç»Ÿä¿¡æ¯"><a href="#æŸ¥çœ‹jenkinsçš„ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹jenkinsçš„ç³»ç»Ÿä¿¡æ¯"></a>æŸ¥çœ‹jenkinsçš„ç³»ç»Ÿä¿¡æ¯</h4><p>ä»¥åœ¨jenkinsçš„ç®¡ç†é¡µé¢ä¸‹çš„ç³»ç»Ÿä¿¡æ¯ä¸­ï¼ŒæŸ¥çœ‹æ‰€æœ‰çš„jenkinsçš„ä¿¡æ¯ï¼Œä¾‹å¦‚jenkinsçš„å¯åŠ¨é…ç½®ï¼Œæ‰€ä¾èµ–çš„ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œæ‰€å®‰è£…çš„pluginsã€‚</p><h4 id="Jenkinsä¸­æ‰§è¡Œbatchå’ŒPython"><a href="#Jenkinsä¸­æ‰§è¡Œbatchå’ŒPython" class="headerlink" title="Jenkinsä¸­æ‰§è¡Œbatchå’ŒPython"></a>Jenkinsä¸­æ‰§è¡Œbatchå’ŒPython</h4><p>Jenkinsçš„job -&gt; build æ”¯æŒAntï¼Œmavenï¼Œwindows batchå’ŒShellï¼Œ ä½†æ˜¯æˆ‘ä»¬çŸ¥é“pythonï¼Œperlï¼Œrubyç­‰è„šæœ¬å…¶å®ä¹Ÿæ˜¯shellè„šæœ¬ï¼Œæ‰€ä»¥è¿™é‡Œçš„Shellå¯ä»¥æ‰©å±•ä¸ºpythonï¼Œperlï¼Œrubyç­‰ã€‚å¦‚å›¾</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/99/04a1d6c847be966e185435823bb110.jpg" alt></p><h3 id="Jenkins-æ•´åˆ-LDAP-ä»¥åŠ-CAS-å•ç‚¹ç™»å½•"><a href="#Jenkins-æ•´åˆ-LDAP-ä»¥åŠ-CAS-å•ç‚¹ç™»å½•" class="headerlink" title="Jenkins æ•´åˆ LDAP ä»¥åŠ CAS å•ç‚¹ç™»å½•"></a>Jenkins æ•´åˆ LDAP ä»¥åŠ CAS å•ç‚¹ç™»å½•</h3><p>å‚è€ƒå¦å¤–ä¸€ç¯‡åšå®¢<br><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmlhbXpobC50b3AvSmVua2lucy1pbnRlZ3JhdGUtd2l0aC1sZGFwLWFuZC1DQVMuaHRtbA==" title="https://blog.iamzhl.top/Jenkins-integrate-with-ldap-and-CAS.html">Jenkins æ•´åˆ LDAP ä»¥åŠ CAS å•ç‚¹ç™»å½•<i class="fa fa-external-link"></i></span></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„ã€æä¾›å‹å¥½æ“ä½œç•Œé¢çš„æŒç»­é›†æˆ(CI)å·¥å…·ï¼Œèµ·æºäºHudsonï¼ˆHudsonæ˜¯å•†ç”¨çš„ï¼‰ï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨çš„æ„å»º/æµ‹è¯•è½¯ä»¶é¡¹ç›®ã€ç›‘æ§å¤–éƒ¨ä»»åŠ¡çš„è¿è¡Œã€‚Jenkinsç”¨Javaè¯­è¨€ç¼–å†™ï¼Œå¯åœ¨Tomcatç­‰æµè¡Œçš„servletå®¹å™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯ç‹¬ç«‹è¿è¡Œã€‚é€šå¸¸ä¸ç‰ˆæœ¬ç®¡ç†å·¥å…·(SCM)ã€æ„å»ºå·¥å…·ç»“åˆä½¿ç”¨ï¼›å¸¸ç”¨çš„ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿæœ‰SVNã€GITï¼Œæ„å»ºå·¥å…·æœ‰Mavenã€Antã€Gradleã€‚
    
    </summary>
    
      <category term="Linux" scheme="https://iamzhl.top/categories/Linux/"/>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/Linux/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Jenkins" scheme="https://iamzhl.top/tags/Jenkins/"/>
    
      <category term="æŒç»­é›†æˆ" scheme="https://iamzhl.top/tags/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
  </entry>
  
  <entry>
    <title>SonarQubeå®‰è£…éƒ¨ç½²</title>
    <link href="https://iamzhl.top/SonarQube-install-and-deploy.html"/>
    <id>https://iamzhl.top/SonarQube-install-and-deploy.html</id>
    <published>2018-08-20T08:10:59.000Z</published>
    <updated>2019-03-11T16:21:49.901Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:27 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h1 id="SonarQubeå®‰è£…éƒ¨ç½²"><a href="#SonarQubeå®‰è£…éƒ¨ç½²" class="headerlink" title="SonarQubeå®‰è£…éƒ¨ç½²"></a><center>SonarQubeå®‰è£…éƒ¨ç½²</center></h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>SonarQubeæ˜¯ä¸€ä¸ªç®¡ç†ä»£ç è´¨é‡çš„å¼€æ”¾å¹³å°ï¼Œå¯ä»¥ä»ä¸ƒä¸ªç»´åº¦æ£€æµ‹ä»£ç è´¨é‡ï¼š</p><ul><li>å¤æ‚åº¦åˆ†å¸ƒï¼ˆcomplexityï¼‰ï¼šä»£ç å¤æ‚åº¦è¿‡é«˜å°†éš¾ä»¥ç†è§£ã€éš¾ä»¥ç»´æŠ¤ï¼›</li><li>é‡å¤ä»£ç ï¼ˆduplicationsï¼‰ï¼šç¨‹åºä¸­åŒ…å«å¤§é‡å¤åˆ¶ç²˜åº¦çš„ä»£ç æ˜¯è´¨é‡ä½ä¸‹çš„è¡¨ç°ï¼›</li><li>å•å…ƒæµ‹è¯•ï¼ˆunit testsï¼‰ï¼šç»Ÿè®¡å¹¶å±•ç¤ºå•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼›</li><li>ç¼–ç è§„èŒƒï¼ˆcoding rulesï¼‰ï¼šé€šè¿‡Findbugsã€PMDã€CheckStyleç­‰è§„èŒƒä»£ç ç¼–å†™ï¼›</li><li>æ³¨é‡Šï¼ˆcommmentsï¼‰ï¼šå°‘äº†å¯è¯»æ€§å·®ï¼Œå¤šäº†çœ‹èµ·æ¥è´¹åŠ²ï¼›</li><li>æ½œåœ¨çš„Bugï¼ˆpotential bugsï¼‰ï¼šé€šè¿‡Findbugsã€PMDã€CheckStyleç­‰æ£€æµ‹æ½œåœ¨bugï¼›</li><li>ç»“æ„ä¸è®¾è®¡ï¼ˆarchitecture &amp; designï¼‰ï¼šä¾èµ–ã€è€¦åˆç­‰ã€‚</li></ul><p>SonarQube å¯ä»¥é›†æˆä¸åŒçš„æµ‹è¯•å·¥å…·ï¼ˆCppCheckã€CheckStyleã€Junitã€CppUnitç­‰ï¼‰ï¼Œä»£ç åˆ†æå·¥å…·ã€æŒç»­é›†æˆå·¥å…·ï¼ˆJenkinsï¼‰ã€IDEï¼ˆVisualStudioï¼‰ã€‚</p><p>Sonaré€šè¿‡å¯¹ä»£ç è´¨é‡åˆ†æç»“æœæ•°æ®è¿›è¡Œåœ¨åŠ å·¥å¤„ç†ï¼Œé€šè¿‡é‡åŒ–çš„æ–¹å¼æ¥åº¦é‡ä»£ç çš„è´¨é‡å˜åŒ–ï¼Œä»è€Œå¯ä»¥æ–¹ä¾¿çš„å¯¹å·¥ç¨‹è¿›è¡Œä»£ç è´¨é‡ç®¡ç†ã€‚</p><p>æ”¯æŒè¯­è¨€ï¼šJAVA PHP C# C COBOL PL/SQL FLEXç­‰20ä½™ç§ã€‚</p><h2 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h2><p>SonarQubeå¹³å°çš„ç»„æˆï¼š</p><ul><li>æ•°æ®åº“ï¼šå­˜æ”¾SonarQubeçš„é…ç½®æ•°æ®ã€ä»£ç è´¨é‡çš„å¿«ç…§æ•°æ®ã€‚</li><li>WebæœåŠ¡ï¼šç”¨äºæŸ¥çœ‹SonarQubeçš„é…ç½®æ•°æ®ã€ä»£ç è´¨é‡çš„å¿«ç…§æ•°æ®ã€‚</li><li>åˆ†æå™¨ï¼šå¯¹é¡¹ç›®ä»£ç è¿›è¡Œåˆ†æã€ç”Ÿæˆè´¨é‡ç»“æœæ•°æ®å¹¶å­˜å…¥æ•°æ®åº“ä¸­ï¼ˆåˆ†æå™¨æœ‰å¤šä¸­ï¼Œæ­¤å¤„é€‰æ‹©SonarQube Maven Pluginï¼‰ã€‚</li></ul><h2 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¯å¢ƒ"></a>å®‰è£…ç¯å¢ƒ</h2><h3 id="å®‰è£…JDK"><a href="#å®‰è£…JDK" class="headerlink" title="å®‰è£…JDK"></a>å®‰è£…JDK</h3><p>å»å®˜ç½‘ä¸‹è½½<code>JDK</code>ï¼š<span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3RlY2huZXR3b3JrL2phdmEvamF2YXNlL2Rvd25sb2Fkcy9qYXZhLWFyY2hpdmUtamF2YXNlOC0yMTc3NjQ4Lmh0bWw=" title="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html">http://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html<i class="fa fa-external-link"></i></span></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/81/1b33b7e9dbe92a1515154d0193194f.jpg" alt></p><p>å®‰è£…<code>JDK</code><br>å°†ä¸‹è½½å¾—åˆ°çš„<code>jdk-8u161-linux-x64.rpm</code>åŒ…ä¿å­˜åˆ°<code>Linux</code>ä¸»æœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -ivh jdk-8u161-linux-x64.rpm</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç¼–è¾‘<code>~/.bashrc</code>ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim ~/.bashrc</span></span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_161export JRE_HOME=$JAVA_HOME/jreexport CLASSPATH=$JAVA_HOME/libexport PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin:$CLASSPATH</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/49/6ac74e90a641e355b29b9c4d17deb9.jpg" alt></p><p>ä½¿ç¯å¢ƒé…ç½®ç”Ÿæ•ˆ<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source ~/.bashrc</span></span><br></pre></td></tr></table></figure><p></p><p>æµ‹è¯•<code>Java</code>ç¯å¢ƒï¼Œåœ¨ç»ˆç«¯è¾“å…¥ï¼š<code>java -version</code>æŸ¥çœ‹æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼Œè‹¥æ˜¾ç¤ºåˆ™å®‰è£…æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/2f/49c7d622b298ae690db3c13754c1b1.jpg" alt></p><p><strong>Note:</strong><br>å¦‚æœå·²ç»é¢„è£…äº†openjdkï¼Œè¯·å…ˆå¸è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum list installed | grep openjdk # æ ¹æ®æ‰§è¡Œç»“æœè¿›è¡Œå¸è½½</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…MySQL"><a href="#å®‰è£…MySQL" class="headerlink" title="å®‰è£…MySQL"></a>å®‰è£…MySQL</h3><p>MySQLçš„Serveråœ¨CentOS 7ä¸Šä»é»˜è®¤è½¯ä»¶åˆ—è¡¨ä¸­è¢«ç§»é™¤äº†ï¼Œç”¨MariaDBæ¥ä»£æ›¿ï¼Œæ‰€ä»¥è¿™å¯¼è‡´æˆ‘ä»¬å¿…é¡»è¦å»å®˜ç½‘ä¸Šè¿›è¡Œä¸‹è½½ï¼Œæ‰¾åˆ°é“¾æ¥ï¼Œç”¨wgetæ‰“å¼€ï¼Œç„¶åå†å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># yum -y install mysql mysql-server mysql-devel</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨MySQLæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure><p>è·å–å®‰è£…MySQLæ—¶çš„åˆå§‹å¯†ç å¹¶ç™»å½•MySQL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep 'temporary password' /var/log/mysqld.log</span></span><br><span class="line"><span class="comment"># mysql -u root -p</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/4a/a001ae2bae5a494c7329cd78a477a3.jpg" alt></p><p>ç™»å½•æˆåŠŸåä¿®æ”¹å¯†ç ï¼Œé¦–å…ˆä¿®æ”¹å®‰å…¨ç­–ç•¥ä¸º0ï¼Œç„¶åå°†å¯†ç é•¿åº¦é™åˆ¶ä¿®æ”¹ä¸º1ï¼Œæœ€åä¿®æ”¹å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global validate_password_policy=0;</span><br><span class="line">mysql&gt; set global validate_password_length=1;</span><br><span class="line">mysql&gt; set password for root@localhost=password(&apos;root&apos;);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a2/0f74ed53f3a426d1fe005228478d8f.jpg" alt></p><p>è®¾ç½®sonarçš„ç”¨æˆ·åå’Œæ•°æ®åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># adduser sonar</span></span><br><span class="line"><span class="comment"># passwd sonar # ä¿®æ”¹sonarç”¨æˆ·å¯†ç </span></span><br><span class="line"><span class="comment"># su sonar # åˆ‡æ¢ä¸ºsonarç”¨æˆ·å®‰è£…</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create user &apos;sonar&apos;@&apos;%&apos; identified by &apos;sonar&apos;;</span><br><span class="line">mysql&gt; CREATE DATABASE sonar CHARACTER SET utf8 COLLATE utf8_general_ci;</span><br><span class="line">mysql&gt; grant all privileges on sonar.* to &apos;sonar&apos;@&apos;%&apos;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…SonarQube"><a href="#å®‰è£…SonarQube" class="headerlink" title="å®‰è£…SonarQube"></a>å®‰è£…SonarQube</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.3.zip</span><br><span class="line">$ unzip sonarqube-7.3.zip  //è‹¥æç¤ºunzipå‘½ä»¤æ‰¾ä¸åˆ°ï¼Œç”¨yum -y install unzipå®‰è£…å³å¯</span><br><span class="line">$ mv sonarqube-7.3 sonarqube </span><br><span class="line">$ mv sonarqube /usr/<span class="built_in">local</span>/</span><br><span class="line"><span class="comment"># chown -R sonar:sonar /usr/local/sonarqube</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®sonar"><a href="#é…ç½®sonar" class="headerlink" title="é…ç½®sonar"></a>é…ç½®sonar</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/<span class="built_in">local</span>/sonarqube/conf/sonar.properties</span><br></pre></td></tr></table></figure><p>å¦‚å›¾è®¾ç½®ä»¥ä¸‹é€‰é¡¹</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/46/56cfe2c33866ab48ab8c9bdd402acc.jpg" alt></p><h2 id="å¯åŠ¨sonar"><a href="#å¯åŠ¨sonar" class="headerlink" title="å¯åŠ¨sonar"></a>å¯åŠ¨sonar</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/<span class="built_in">local</span>/sonarqube/bin/linux-x86-64/sonar.sh start</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¯åŠ¨åï¼Œè®¿é—®æœ¬åœ° <span class="exturl" data-url="aHR0cDovL0lQOjkwMDDvvIxTb25hclF1YmU=" title="http://IP:9000ï¼ŒSonarQube">http://IP:9000ï¼ŒSonarQube<i class="fa fa-external-link"></i></span> åˆå§‹ç®¡ç†å‘˜è´¦å·ä¸º adminï¼Œé»˜è®¤å¯†ç ä¸º adminï¼Œç™»å½•åå¯ä¿®æ”¹å¯†ç ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/25/5b9f14a21cdaf024ea8b3ce551dd7a.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/83/71e7da548917e52b08eb37f385e000.jpg" alt></p><p><strong>Note:</strong><br>å¦‚æœé‡åˆ°Sonarå¯åŠ¨ä¸èµ·æ¥ï¼ŒæŸ¥çœ‹æ—¥å¿—è‡ªåŠ¨å…³é—­çš„é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•è§£å†³</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo -e "vm.max_map_count=262144" &gt;&gt; /etc/sysctl.conf</span></span><br><span class="line"><span class="comment"># sysctl -p</span></span><br><span class="line"><span class="comment"># echo -e "sonar hard nofile 65536" &gt;&gt; /etc/security/limits.conf </span></span><br><span class="line"><span class="comment"># echo -e "sonar soft nofile 65536" &gt;&gt; /etc/security/limits.conf</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ³¨é”€sonarç”¨æˆ·é‡æ–°ä»¥sonarèº«ä»½ç™»å½•åå†æ¬¡å¯åŠ¨:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/<span class="built_in">local</span>/sonarqube/bin/linux-x86-64/sonar.sh start</span><br></pre></td></tr></table></figure><p>æ’ä»¶å®‰è£…ï¼šå¦‚æœéœ€è¦ä¸‹è½½æ’ä»¶çš„è¯ï¼Œå„ä¸ªç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå…ˆç‚¹å‡»Administration,å†æ‰“å¼€Marketplaceå°±å¯ä»¥çœ‹åˆ°Pluginså„ç§æ’ä»¶äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/c6/cef3a943ab5d4347d4af8f3332a196.jpg" alt></p><p>SonarQube æ”¯æŒåˆ†æçš„è¯­è¨€æœ‰å¾ˆå¤šï¼ŒåƒJavaã€Pythonã€Phpã€C/C++ã€C#ã€HTMLã€JavaScriptã€PL/SQLã€Objective Cç­‰20+è¯­è¨€ï¼Œå½“æˆ‘ä»¬éœ€è¦æ”¯æŒåˆ†æä»€ä¹ˆè¯­è¨€æ—¶ï¼Œåªéœ€è¦å»æ’ä»¶ä¸­å¿ƒå®‰è£…å¯¹åº”è¯­è¨€çš„æ’ä»¶å³å¯ï¼Œéå¸¸æ–¹ä¾¿ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦å»é€‰æ‹©æ’ä»¶ã€‚</p><h2 id="å®éªŒéªŒè¯"><a href="#å®éªŒéªŒè¯" class="headerlink" title="å®éªŒéªŒè¯"></a>å®éªŒéªŒè¯</h2><blockquote><p>æœ¬æ¬¡å®éªŒéªŒè¯ä»¥Javaå·¥ç¨‹ä¸ºä¾‹</p></blockquote><h3 id="å®‰è£…é…ç½®sonar-scanner"><a href="#å®‰è£…é…ç½®sonar-scanner" class="headerlink" title="å®‰è£…é…ç½®sonar-scanner"></a>å®‰è£…é…ç½®sonar-scanner</h3><ul><li>è·å–sonar-scanner</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.2.0.1227-linux.zip</span></span><br><span class="line"><span class="comment"># unzip sonar-scanner-cli-3.2.0.1227-linux.zip</span></span><br><span class="line"><span class="comment"># mv sonar-scanner-3.2.0.1227-linux sonar-scanner</span></span><br><span class="line"><span class="comment"># mv sonar-scanner /usr/local/</span></span><br><span class="line"><span class="comment"># chown -R sonar:sonar sonar-scanner</span></span><br></pre></td></tr></table></figure><ul><li>é…ç½®sonar-scannerç¯å¢ƒå˜é‡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim ~/.bashrc</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/40/6ea5e9c0aee37c056f4583b32c048d.jpg" alt></p><ul><li>ä½¿é…ç½®ç”Ÿæ•ˆ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source ~/.bashrc</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/70/524b2333bbfb3e6a50b77f92eb201d.jpg" alt></p><ul><li>æ£€æŸ¥ç¯å¢ƒé…ç½®æ˜¯å¦æˆåŠŸ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sonar-scanner -version</span><br></pre></td></tr></table></figure><ul><li>é…ç½®sonar-scanner.propertiesæ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/<span class="built_in">local</span>/sonar-scanner/conf/sonar-scanner.properties</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/46/849b0c5cac635e91e9efcf07ba5fbd.jpg" alt></p><h3 id="éªŒè¯è¿‡ç¨‹"><a href="#éªŒè¯è¿‡ç¨‹" class="headerlink" title="éªŒè¯è¿‡ç¨‹"></a>éªŒè¯è¿‡ç¨‹</h3><ul><li>æ·»åŠ Java Mavenæµ‹è¯•å·¥ç¨‹</li></ul><p>ç¼–å†™æµ‹è¯•å·¥ç¨‹</p><ul><li>æ·»åŠ sonar-project.propertiesæ–‡ä»¶</li></ul><p>åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸­æ·»åŠ sonar-project.propertiesæ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=com.geovis         //é¡¹ç›®çš„å”¯ä¸€æ ‡è¯†</span><br><span class="line">sonar.projectName=helloworld        //é¡¹ç›®çš„åå­—</span><br><span class="line">sonar.projectVersion=1.0            //é¡¹ç›®çš„ç‰ˆæœ¬</span><br><span class="line">sonar.sources=/root/helloworld/src  //é¡¹ç›®çš„æºç ç›®å½•ï¼Œå¤šç›®å½•ä»¥è‹±æ–‡é€—å·åˆ†éš”</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚æˆ‘çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/6a/e62e31b74ec65b783f21f4d8cda98e.jpg" alt></p><p>é‚£ä¹ˆæ­¤é¡¹ç›®é…ç½®æ–‡ä»¶åº”ä¸º</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/98/4f0aa2e69db09a846cfd6da4a3442f.jpg" alt></p><ul><li>ä»£ç è´¨é‡æ£€æŸ¥<br>è®¾ç½®å®Œåï¼Œç»ˆç«¯è¿è¡Œ<code>sonar-scanner</code>å‘½ä»¤ï¼Œå¼€å§‹é¡¹ç›®æºä»£ç çš„åˆ†æ</li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/77/64ffb2ce43fdba046811cce438845c.jpg" alt></p><ul><li>æŸ¥çœ‹ç»“æœ<br>å‘½ä»¤è¿è¡Œå®Œæˆä¹‹åï¼Œè®¿é—®<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MDAw77yM6L6T5YWl6LSm5Y+35a+G56CB5Y2z5Y+v5p+l55yL5YiG5p6Q57uT5p6c77yM5aaC5LiL5Zu+" title="http://localhost:9000ï¼Œè¾“å…¥è´¦å·å¯†ç å³å¯æŸ¥çœ‹åˆ†æç»“æœï¼Œå¦‚ä¸‹å›¾">http://localhost:9000ï¼Œè¾“å…¥è´¦å·å¯†ç å³å¯æŸ¥çœ‹åˆ†æç»“æœï¼Œå¦‚ä¸‹å›¾<i class="fa fa-external-link"></i></span></li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b4/92864641223d1537b6f4dfa27a6358.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/97/221636aa330d56dea8bb870957f29a.jpg" alt></p><h2 id="SonarQube-æ•´åˆ-LDAP-å’Œ-CAS-å•ç‚¹ç™»å½•"><a href="#SonarQube-æ•´åˆ-LDAP-å’Œ-CAS-å•ç‚¹ç™»å½•" class="headerlink" title="SonarQube æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•"></a>SonarQube æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•</h2><p><code>SonarQube</code>æ•´åˆ<code>LDAP</code>å’Œ<code>CAS</code>å•ç‚¹ç™»å½•çš„è¿‡ç¨‹è¯·å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡åšå®¢<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmlhbXpobC50b3AvU29uYXJRdWJlLWludGVncmF0ZS13aXRoLWxkYXAtYW5kLUNBUy5odG1s" title="https://blog.iamzhl.top/SonarQube-integrate-with-ldap-and-CAS.html">SonarQube æ•´åˆ LDAP å’Œ CAS å•ç‚¹ç™»å½•<i class="fa fa-external-link"></i></span></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      SonarQubeå®‰è£…éƒ¨ç½²ä»¥åŠä»£ç åˆ†æå®ä¾‹è¿‡ç¨‹å°è®°
    
    </summary>
    
      <category term="Linux" scheme="https://iamzhl.top/categories/Linux/"/>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/Linux/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="SonarQube" scheme="https://iamzhl.top/tags/SonarQube/"/>
    
      <category term="sonar-scanner" scheme="https://iamzhl.top/tags/sonar-scanner/"/>
    
  </entry>
  
  <entry>
    <title>MantisBT å®‰è£…éƒ¨ç½²è¿‡ç¨‹</title>
    <link href="https://iamzhl.top/MantisBT-install-and-deploy.html"/>
    <id>https://iamzhl.top/MantisBT-install-and-deploy.html</id>
    <published>2018-08-18T05:53:09.000Z</published>
    <updated>2019-03-11T16:21:49.896Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:27 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h1 id="MantisBTè½¯ä»¶å®‰è£…éƒ¨ç½²è¿‡ç¨‹"><a href="#MantisBTè½¯ä»¶å®‰è£…éƒ¨ç½²è¿‡ç¨‹" class="headerlink" title="MantisBTè½¯ä»¶å®‰è£…éƒ¨ç½²è¿‡ç¨‹"></a><strong><center>MantisBTè½¯ä»¶å®‰è£…éƒ¨ç½²è¿‡ç¨‹</center></strong></h1><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>&#160;&#160;&#160;&#160;Mantisæ˜¯ä¸€ä¸ªåŸºäºPHPæŠ€æœ¯çš„è½»é‡çº§çš„å¼€æºç¼ºé™·è·Ÿè¸ªç³»ç»Ÿï¼Œä»¥Webæ“ä½œçš„å½¢å¼æä¾›é¡¹ç›®ç®¡ç†åŠç¼ºé™·è·Ÿè¸ªæœåŠ¡ã€‚åœ¨åŠŸèƒ½ä¸Šã€å®ç”¨æ€§ä¸Šè¶³ä»¥æ»¡è¶³ä¸­å°å‹é¡¹ç›®çš„ç®¡ç†åŠè·Ÿè¸ªã€‚æ›´é‡è¦çš„æ˜¯å…¶å¼€æºï¼Œä¸éœ€è¦è´Ÿæ‹…ä»»ä½•è´¹ç”¨ã€‚</p><h1 id="éƒ¨ç½²ç¯å¢ƒ"><a href="#éƒ¨ç½²ç¯å¢ƒ" class="headerlink" title="éƒ¨ç½²ç¯å¢ƒ"></a>éƒ¨ç½²ç¯å¢ƒ</h1><p>Mantiså®‰è£…éƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹ï¼š</p><table><thead><tr><th>åç§°</th><th>ç‰ˆæœ¬å·</th><th>æè¿°</th></tr></thead><tbody><tr><td>Mantisbt</td><td>2.16.0</td><td>BugTracing è½¯ä»¶</td></tr><tr><td>æ“ä½œç³»ç»Ÿ</td><td>CentOS 7</td><td>RedHat ç¤¾åŒºå‘è¡Œç‰ˆ</td></tr><tr><td>PHP</td><td>7.2.8</td><td>PHP ç¯å¢ƒ</td></tr></tbody></table><h1 id="éƒ¨ç½²è¿‡ç¨‹"><a href="#éƒ¨ç½²è¿‡ç¨‹" class="headerlink" title="éƒ¨ç½²è¿‡ç¨‹"></a>éƒ¨ç½²è¿‡ç¨‹</h1><h2 id="è½¯ä»¶å®‰è£…"><a href="#è½¯ä»¶å®‰è£…" class="headerlink" title="è½¯ä»¶å®‰è£…"></a>è½¯ä»¶å®‰è£…</h2><h3 id="å®‰è£…PHP"><a href="#å®‰è£…PHP" class="headerlink" title="å®‰è£…PHP"></a>å®‰è£…PHP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span></span><br><span class="line"><span class="comment"># yum -y install libicu libicu-devel libicu-doc</span></span><br><span class="line"><span class="comment"># yum -y install php70w php70w-gd php70w-xml php70w-mysql php70w-mbstring php70w-ldap php70w-xmlrpc php70w-odbc php70w-pear php70w-soap php70w-snmp</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…PHPMailer"><a href="#å®‰è£…PHPMailer" class="headerlink" title="å®‰è£…PHPMailer"></a>å®‰è£…PHPMailer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/Synchro/PHPMailer/releases/tag/v5.2.13</span><br></pre></td></tr></table></figure><p>ä¸‹è½½è§£å‹åˆ°/var/www/html/mantis/PHPMailer-5.2.13/</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/0b/f7ba2cdc89ecb4edee3d7c32861ad1.jpg" alt></p><h3 id="å®‰è£…apache-mysqlç­‰å¿…è¦è½¯ä»¶"><a href="#å®‰è£…apache-mysqlç­‰å¿…è¦è½¯ä»¶" class="headerlink" title="å®‰è£…apache mysqlç­‰å¿…è¦è½¯ä»¶"></a>å®‰è£…apache mysqlç­‰å¿…è¦è½¯ä»¶</h3><p>MySQLçš„Serveråœ¨CentOS 7ä¸Šä»é»˜è®¤è½¯ä»¶åˆ—è¡¨ä¸­è¢«ç§»é™¤äº†ï¼Œç”¨MariaDBæ¥ä»£æ›¿ï¼Œæ‰€ä»¥è¿™å¯¼è‡´æˆ‘ä»¬å¿…é¡»è¦å»å®˜ç½‘ä¸Šè¿›è¡Œä¸‹è½½ï¼Œæ‰¾åˆ°é“¾æ¥ï¼Œç”¨wgetæ‰“å¼€ï¼Œç„¶åå†å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># rpm -ivh mysql57-community-release-el7-9.noarch.rpm</span></span><br><span class="line"><span class="comment"># yum -y install mysql mysql-server mysql-devel</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨MySQLæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure><p>è·å–å®‰è£…MySQLæ—¶çš„åˆå§‹å¯†ç å¹¶ç™»å½•MySQL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep 'temporary password' /var/log/mysqld.log</span></span><br><span class="line"><span class="comment"># mysql -u root -p</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/4a/a001ae2bae5a494c7329cd78a477a3.jpg" alt></p><p>ç™»å½•æˆåŠŸåä¿®æ”¹å¯†ç ï¼Œé¦–å…ˆä¿®æ”¹å®‰å…¨ç­–ç•¥ä¸º0ï¼Œç„¶åå°†å¯†ç é•¿åº¦é™åˆ¶ä¿®æ”¹ä¸º1ï¼Œæœ€åä¿®æ”¹å¯†ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global validate_password_policy=0;</span><br><span class="line">mysql&gt; set global validate_password_length=1;</span><br><span class="line">mysql&gt; set password for root@localhost=password(&apos;root&apos;);</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a2/0f74ed53f3a426d1fe005228478d8f.jpg" alt></p><p>å®‰è£…apache httpd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install httpd</span></span><br><span class="line"><span class="comment"># systemctl enable httpd   //è‡ªå¯åŠ¨</span></span><br><span class="line"><span class="comment"># systemctl start httpd    //å¯åŠ¨</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…mantis"><a href="#å®‰è£…mantis" class="headerlink" title="å®‰è£…mantis"></a>å®‰è£…mantis</h3><h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /var/www/html</span></span><br><span class="line"><span class="comment"># wget https://jaist.dl.sourceforge.net/project/mantisbt/mantis-stable/2.18.0/mantisbt-2.18.0.zip</span></span><br></pre></td></tr></table></figure><h4 id="è§£å‹é‡å‘½å"><a href="#è§£å‹é‡å‘½å" class="headerlink" title="è§£å‹é‡å‘½å"></a>è§£å‹é‡å‘½å</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxvf mantisbt-2.16.0.tar.gz</span></span><br><span class="line"><span class="comment"># mv mantisbt-2.16.0 mantis</span></span><br><span class="line"><span class="comment"># mv mantis /var/www/html/</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹ç”¨æˆ·ç»„"><a href="#ä¿®æ”¹ç”¨æˆ·ç»„" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·ç»„"></a>ä¿®æ”¹ç”¨æˆ·ç»„</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown -R apache:apache /var/www/html/mantis</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-7 html]<span class="comment"># mysql -u root -p</span></span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 5.7.23 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; create database mantis;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges on mantis.* to root@localhost identified by <span class="string">'123456'</span>;</span><br><span class="line">ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_policy=0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password_length=1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges on mantis.* to root@localhost identified by <span class="string">'123456'</span>;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">exit</span></span><br><span class="line">Bye</span><br><span class="line">[root@centos-7 html]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>æ‰“å¼€æµè§ˆå™¨åœ¨åœ°å€æ è¾“å…¥ <span class="exturl" data-url="aHR0cDovLzEwLjIxMS41NS4xNzo4Mi9tYW50aXM=" title="http://10.211.55.17:82/mantis">http://10.211.55.17:82/mantis<i class="fa fa-external-link"></i></span> â€“ æ ¼å¼ä¸º <code>http://IP:ç«¯å£/mantisæ–‡ä»¶å¤¹åç§°</code>ï¼Œè¿™æ—¶å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°phpå®‰è£…å‘å¯¼çš„é¡µé¢:</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/13/430b174ae372e2c4854b5804123ab1.jpg" alt></p><p>&#160;&#160;&#160;&#160;å¡«å¥½ä¸»æœºã€å¯†ç ç­‰ä¿¡æ¯ä¹‹åç‚¹å‡» Install/Upgrade Database å®‰è£…æ•°æ®åº“ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/86/f2dd1067427ccefb9829d5a3e2903e.jpg" alt></p><h4 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h4><p>è¿›å…¥Mantisç™»å½•ç•Œé¢ï¼Œè¾“å…¥ç”¨æˆ·å¯†ç ï¼šadministrator/root ï¼Œç™»é™†å³å¯çœ‹åˆ°mantisä¸»ç•Œé¢ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b1/c3e84af9570ae5c9d61d788d482a69.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/f4/2302c64875ae7556c732820ffe6c2f.jpg" alt></p><h2 id="é‚®ä»¶é…ç½®"><a href="#é‚®ä»¶é…ç½®" class="headerlink" title="é‚®ä»¶é…ç½®"></a>é‚®ä»¶é…ç½®</h2><p>ä¿®æ”¹MantisBT/config/config_inc.phpæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$g_enable_email_notification = ON;</span><br><span class="line">$g_administrator_email = &apos;mailuser&apos;;    # é‚®ç®±åœ°å€</span><br><span class="line">$g_webmaster_email = &apos;mailuser&apos;;        # é‚®ç®±åœ°å€</span><br><span class="line">$g_from_email = &apos;mailuser&apos;;             # é‚®ç®±åœ°å€</span><br><span class="line">$g_from_name = &apos;Mantis Bug Tracker&apos;;</span><br><span class="line">$g_phpMailer_method = PHPMAILER_METHOD_SMTP;</span><br><span class="line">$g_smtp_host = &apos;smtp.163.com&apos;;          # SMTP æœåŠ¡å™¨</span><br><span class="line">$g_smtp_username = &apos;mailuser&apos;;          # é‚®ç®±åœ°å€</span><br><span class="line">$g_smtp_password = &apos;mailpwd&apos;;           # é‚®ç®±å¯†ç </span><br><span class="line">$g_use_phpMailer = ON; </span><br><span class="line">$g_return_path_email = &apos;mailuser&apos;;      # é‚®ç®±åœ°å€</span><br></pre></td></tr></table></figure><h2 id="ä¸­æ–‡é…ç½®"><a href="#ä¸­æ–‡é…ç½®" class="headerlink" title="ä¸­æ–‡é…ç½®"></a>ä¸­æ–‡é…ç½®</h2><p>ä¿®æ”¹/var/www/html/mantis/config_defaults_inc.phpæ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ°è¯­è¨€è®¾ç½®çš„åœ°æ–¹ï¼Œä¿®æ”¹$g_default_languageï¼Œå°†â€™englishâ€™æ”¹ä¸ºâ€™chinese_simplifiedâ€™ã€‚æ‡’å¾—æ‰¾çš„è¯ç›´æ¥å¤åˆ¶ä¸‹é¢çš„å‘½ä»¤ä¹Ÿå¯ä»¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sed -i -e "s/$g_default_language = 'auto'/$g_default_language = 'chinese_simplified'/g" /var/www/html/mantis/config_defaults_inc.php</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/17/52f55640c0580b49bb51e81728e32b.jpg" alt></p><h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><p>é—®é¢˜æè¿°ï¼šé…ç½®å®Œæˆåï¼Œæ— æ³•å‘é€é‚®ä»¶ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š<br>é‚®ç®±é…ç½®é—®é¢˜ï¼Œæ·»åŠ æœ¬åœ°é‚®ç®±æœåŠ¡å™¨ï¼Œè®¾ç½®æœ¬åœ°é‚®ç®±ï¼Œå¯¹äºæœ¬åœ°æµ‹è¯•é‚®ç®±ï¼Œè®¾ç½®$g_smtp_host=æœ¬åœ°IPåœ°å€ã€‚</p><h1 id="å®ä¾‹è¿è¡Œ"><a href="#å®ä¾‹è¿è¡Œ" class="headerlink" title="å®ä¾‹è¿è¡Œ"></a>å®ä¾‹è¿è¡Œ</h1><ul><li>ä¸ºäº†ä¾¿äºç†è§£ï¼Œå…ˆç»™å‡ºBUGè·Ÿè¸ªæµç¨‹å›¾ï¼š</li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b7/a17671861ee0f1c0ef2d34063c1f7e.png" alt></p><ul><li>Mantisä½¿ç”¨æµç¨‹å›¾ï¼š</li></ul><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/36/e0cd2969561f3a3847f00064f10d86.jpg" alt></p><ul><li>æ–°ç”¨æˆ·åˆ›å»ºä¸ç™»å½•</li></ul><p>ç›®å‰æœ¬ç³»ç»Ÿçš„è®¿é—®åœ°å€ä¸ºï¼š<span class="exturl" data-url="aHR0cDovL0lQOnBvcnQvbWFudGlzL2xvZ2luX3BhZ2UucGhw77yM55So5oi35Y+v5Lul6YCa6L+H6aaW6aG15pi+56S655qEJnF1b3Q75rOo5YaM5LiA5Liq5paw5biQ5Y+3JnF1b3Q76L+b6KGM5paw55So5oi35rOo5YaM44CC" title="http://IP:port/mantis/login_page.phpï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é¦–é¡µæ˜¾ç¤ºçš„&quot;æ³¨å†Œä¸€ä¸ªæ–°å¸å·&quot;è¿›è¡Œæ–°ç”¨æˆ·æ³¨å†Œã€‚">http://IP:port/mantis/login_page.phpï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é¦–é¡µæ˜¾ç¤ºçš„&quot;æ³¨å†Œä¸€ä¸ªæ–°å¸å·&quot;è¿›è¡Œæ–°ç”¨æˆ·æ³¨å†Œã€‚<i class="fa fa-external-link"></i></span></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/7d/1aa6506c45bdc101125dbf0eb471cb.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/e0/c44b7bd62656a42effb30cbe072d8d.jpg" alt></p><p>ç„¶åç‚¹å‡»é‚®ç®±å†…çš„æ¿€æ´»é‚®ä»¶ï¼Œè¿›è¡Œç”¨æˆ·åä¸å¯†ç çš„è®¾ç½®ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç®¡ç†å‘˜åˆ›å»ºæ–°ç”¨æˆ·</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/f3/3984a7b93cb83f5018a886334554f3.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/38/81f16e90a837e3b2e4753481d53d49.jpg" alt></p><p>ç®¡ç†å‘˜å¯ä»¥å¯¹ç”¨æˆ·çš„è§’è‰²ã€æ‰€å±çš„é¡¹ç›®ä»¥åŠä¸€äº›å…¶ä»–çš„æƒ…å†µè¿›è¡Œå¯¹åº”çš„é…ç½®ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/7e/8a3bf7d3b7d54549861c08cc2b8695.jpg" alt></p><p>å„ç§å…·ä½“çš„é…ç½®ä»¥åŠå„ç§è§’è‰²ç”¨æˆ·çš„æƒé™å¯å‚è§ç®¡ç†å‘˜çš„ç®¡ç†è§†å›¾ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/64/fb372744682c06a5abf50d6d08e3c3.jpg" alt></p><p><strong>æ“ä½œæµç¨‹</strong><br>é¦–å…ˆï¼Œè¯´æ˜ä¸€ä¸‹ç³»ç»Ÿä¸­çš„è§’è‰²å’Œä¸€èˆ¬æ‰€å¯¹åº”çš„äººå‘˜ï¼šè§‚å¯Ÿè€…ï¼ˆå¤æŸ¥å‘˜ï¼‰ã€æŠ¥å‘Šè€…ï¼ˆæµ‹è¯•å‘˜ï¼‰ã€å‡çº§è€…ï¼ˆå®¡æ ¸å‘˜ï¼‰ã€å¼€å‘äººå‘˜ï¼ˆå¼€å‘å‘˜ï¼‰ã€ç»ç†ï¼ˆé¡¹ç›®ç»ç†ï¼‰ã€ç®¡ç†å‘˜ï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰ã€‚è¿˜è¦ç®€å•è¯´æ˜ä¸€ä¸‹é—®é¢˜çŠ¶æ€åŠç›¸å…³å«ä¹‰ï¼ˆä»¥ä¸Šçš„ä¸¤ç‚¹åªæ˜¯ä¸­æ–‡ç†è§£å’Œä¸­æ–‡ç¿»è¯‘çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨mantisbt-2.15.0/lang/strings_chinese_simplified.txtä¸­ä¿®æ”¹ï¼‰ï¼š</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/32/a9311c413f72019f384eb9fdb64e91.jpg" alt></p><ul><li>æ–°å»ºï¼šæ–°æäº¤çš„æŠ¥å‘Šï¼Œé»˜è®¤çŠ¶æ€ä¸ºæ–°å»º</li><li>åé¦ˆï¼šä¿®æ­£çš„é—®é¢˜ç»è¿‡æµ‹è¯•åä»ä¸å®Œå–„</li><li>è®¤å¯ï¼šæŠ¥å‘Šçš„é—®é¢˜ç¡®å®å­˜åœ¨</li><li>å·²ç¡®è®¤ï¼šé€šå¸¸ä¸ºé¡¹ç›®ç»ç†ç¡®è®¤æ—¶ä½¿ç”¨</li><li>å·²åˆ†é…ï¼šåˆ†æ´¾ç»™å…·ä½“å¼€å‘äººå‘˜</li><li>å·²è§£å†³ï¼šä¿®æ”¹åçš„é—®é¢˜ï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•</li><li>å·²å…³é—­ï¼šæµ‹è¯•é€šè¿‡çš„é—®é¢˜ï¼Œæˆ–è€…åœ¨æŠ¥å‘Šå‘¨æœŸå†…åˆ¤å®šä¸ºæ— éœ€ä¿®æ”¹çš„é—®é¢˜ã€‚</li></ul><p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹ç®€å•çš„æ“ä½œæµç¨‹ï¼Œè¿™é‡Œä»¥ç®¡ç†å‘˜å’ŒæŠ¥å‘Šè€…ä½œä¸ºç¤ºä¾‹ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ç¤ºä¾‹ï¼Œç¤ºä¾‹ä¸­ç®¡ç†å‘˜åŒ…å«äº†å…¶ä»–è§’è‰²å±æ€§ã€‚è§‚å¯Ÿè€…ã€å‡çº§è€…ä»¥åŠç»ç†å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œæ·»åŠ ã€‚</p><ul><li>æäº¤é—®é¢˜</li></ul><p><strong>æƒé™ï¼š</strong>å…¨éƒ¨è§’è‰²<br><strong>å¿…å¡«ä¿¡æ¯ï¼š</strong>åˆ†ç±»ã€æ‘˜è¦ã€æè¿°ã€æŸ¥çœ‹æƒé™<br><strong>é€‰å¡«ä¿¡æ¯ï¼š</strong>å‡ºç°é¢‘ç‡ã€ä¸¥é‡æ€§ã€ä¼˜å…ˆçº§ã€é€‰æ‹©å¹³å°è®¾ç½®ã€é‡ç°æ­¥éª¤ã€è¾…åŠ©ã€æ ‡ç­¾ã€ä¸Šä¼ æ–‡ä»¶ã€‚<br><strong>é—®é¢˜å•çŠ¶æ€ï¼š</strong>æ–°å»º</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/7a/b1f51f397d2700ccd2ae21cc7edbc7.jpg" alt></p><ul><li>å®¡æ ¸é—®é¢˜</li></ul><p><strong>æƒé™ï¼š</strong>å®¡æ ¸å‘˜ã€é¡¹ç›®ç»ç†ã€ï¼ˆå¼€å‘å‘˜ï¼‰<br><strong>å¯è¿›è¡Œæ“ä½œï¼š</strong>æ·»åŠ é™„ä»¶ã€æ·»åŠ æ³¨é‡Š<br><strong>é—®é¢˜å•çŠ¶æ€ï¼š</strong>æ–°å»º -&gt; å·²å®¡æ ¸ï¼ˆè®¤å¯ï¼‰ï¼Œå®¡æ ¸å‘˜å¯¹é—®é¢˜è¿›è¡Œå®¡æ ¸ï¼Œå¹¶ç¡®è®¤æ­¤é—®é¢˜ï¼›æ–°å»º -&gt; å·²å…³é—­ï¼Œå®¡æ ¸å‘˜è®¤ä¸ºæŠ¥å‘Šçš„é—®é¢˜ä¸å­˜åœ¨æˆ–æ— éœ€ä¿®æ”¹ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/cc/cf2fa843e333b7b168418e13720f06.jpg" alt></p><ul><li>ç¡®è®¤é—®é¢˜</li></ul><p><strong>æƒé™ï¼š</strong>é¡¹ç›®ç»ç†<br><strong>é—®é¢˜å•çŠ¶æ€ï¼š</strong>è®¤å¯ -&gt; å·²ç¡®è®¤ï¼Œé¡¹ç›®ç»ç†ç¡®è®¤é—®é¢˜ï¼Œç¡®è®¤åè¿›å…¥ä¿®æ”¹æµç¨‹ï¼›è®¤å¯ -&gt; åé¦ˆï¼Œé¡¹ç›®ç»ç†å¯¹é—®é¢˜å­˜åœ¨å¼‚è®®ï¼Œåé¦ˆç»™å®¡æ ¸è€…ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/61/b450cb7f3eb6af3ce04b1e071dd25e.jpg" alt></p><ul><li>åˆ†æ´¾é—®é¢˜</li></ul><p><strong>æƒé™ï¼š</strong>é¡¹ç›®ç»ç†ã€å¼€å‘å‘˜<br><strong>é—®é¢˜å•çŠ¶æ€ï¼š</strong>å·²ç¡®è®¤ -&gt; å·²åˆ†æ´¾ï¼Œé¡¹ç›®ç»ç†åˆ†æ´¾é—®é¢˜ç»™ç›¸åº”çš„å¼€å‘äººå‘˜ï¼›å·²åˆ†æ´¾ -&gt; å·²åˆ†æ´¾ï¼Œå¼€å‘ç»„é•¿ä¹Ÿå¯ä»¥ç»™ç»„å‘˜åˆ†æ´¾é—®é¢˜ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/97/1e02d524da8f78c447a2fae2b0ceb3.jpg" alt></p><ul><li>ä¿®å¤é—®é¢˜</li></ul><p><strong>æƒé™ï¼š</strong>å¼€å‘å‘˜<br><strong>é—®é¢˜å•çŠ¶æ€ï¼š</strong>å·²åˆ†æ´¾ -&gt; å·²è§£å†³ï¼Œåˆ†æ´¾ç»™å¼€å‘å‘˜çš„é—®é¢˜å·²ä¿®å¤åŠå†…éƒ¨æµ‹è¯•ï¼Œå¯ä»¥æäº¤ä¸šåŠ¡æµ‹è¯•æ—¶ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/46/f8d53110204d554fe1339fa16d4d98.jpg" alt></p><ul><li>æµ‹è¯•é—®é¢˜</li></ul><p><strong>æƒé™ï¼š</strong>æŠ¥å‘Šè€…<br><strong>é—®é¢˜å•çŠ¶æ€ï¼š</strong>å·²è§£å†³ -&gt; å·²å…³é—­ï¼ŒæŠ¥å‘Šè€…å¯¹å·²è§£å†³çš„é—®é¢˜æµ‹è¯•ä¸”æµ‹è¯•é€šè¿‡ï¼›å·²è§£å†³ -&gt; åé¦ˆï¼ŒæŠ¥å‘Šè€…å¯¹å·²è§£å†³çš„é—®é¢˜æµ‹è¯•ï¼Œè€Œæµ‹è¯•æœªé€šè¿‡ï¼Œå¼€å‘å‘˜å¯å¯¹åé¦ˆçš„é—®é¢˜ç»§ç»­ä¿®å¤ï¼Œå†è¿›å…¥åç»­ç¯èŠ‚ã€‚</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/93/d945f5412b7aece0c5595564633ad6.jpg" alt></p><p>åˆ°æ­¤ï¼Œæ•´ä¸ªæµç¨‹ç»“æŸã€‚<br><strong>è¯´æ˜ï¼šæ•´ä¸ªæµç¨‹ä¸­ï¼Œé—®é¢˜å¤„äºä¸åŒçš„çŠ¶æ€ï¼Œæ ‡è®°çš„é¢œè‰²ä¸åŒã€‚</strong></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      MantisBTæ˜¯ä¸€ä¸ªåŸºäºPHPæŠ€æœ¯çš„è½»é‡çº§çš„å¼€æºç¼ºé™·è·Ÿè¸ªç³»ç»Ÿï¼Œä»¥Webæ“ä½œçš„å½¢å¼æä¾›é¡¹ç›®ç®¡ç†åŠç¼ºé™·è·Ÿè¸ªæœåŠ¡ã€‚åœ¨åŠŸèƒ½ä¸Šã€å®ç”¨æ€§ä¸Šè¶³ä»¥æ»¡è¶³ä¸­å°å‹é¡¹ç›®çš„ç®¡ç†åŠè·Ÿè¸ªã€‚æ›´é‡è¦çš„æ˜¯å…¶å¼€æºï¼Œä¸éœ€è¦è´Ÿæ‹…ä»»ä½•è´¹ç”¨ã€‚æœ¬æ–‡ç®€ä»‹MantisBTçš„å®‰è£…éƒ¨ç½²è¿‡ç¨‹ã€‚
    
    </summary>
    
      <category term="Linux" scheme="https://iamzhl.top/categories/Linux/"/>
    
      <category term="è¿ç»´" scheme="https://iamzhl.top/categories/Linux/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="MantisBT" scheme="https://iamzhl.top/tags/MantisBT/"/>
    
      <category term="Bugè¿½è¸ª" scheme="https://iamzhl.top/tags/Bug%E8%BF%BD%E8%B8%AA/"/>
    
  </entry>
  
  <entry>
    <title>awk to use</title>
    <link href="https://iamzhl.top/awk-to-use.html"/>
    <id>https://iamzhl.top/awk-to-use.html</id>
    <published>2018-08-05T10:01:00.000Z</published>
    <updated>2019-03-11T16:21:49.905Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><code>awk</code>æ˜¯<code>Linux</code>æœ€å¸¸ç”¨çš„å­—ç¬¦ä¸²å¤„ç†å·¥å…·</p><h1 id="awk-å†…ç½®å‚æ•°"><a href="#awk-å†…ç½®å‚æ•°" class="headerlink" title="awk å†…ç½®å‚æ•°"></a>awk å†…ç½®å‚æ•°</h1><ul><li>NR â€“ è¡Œå·</li><li>NF â€“ åˆ—æ€»æ•°</li><li>FILENAME â€“ å½“å‰æ–‡ä»¶å</li></ul><blockquote><p>å®ä¾‹</p></blockquote><ul><li><p>æ‰“å°<code>/etc/passwd</code>æ¯è¡Œçš„è¡Œå·ï¼Œæ¯è¡Œçš„å­—ç¬¦æ€»æ•°ä»¥åŠç¬¬ä¸€è¡Œ(å³æ¯è¡Œçš„ç”¨æˆ·å)</p><p><code>print</code>å®ç°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F <span class="string">':'</span> <span class="string">'&#123;print "Line:"NR,"Col:"NF,"User:"$1&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure><p><code>printf</code>å®ç°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F <span class="string">':'</span> <span class="string">'&#123;printf "Line:%s,Col:%s,User:%s\n",NR,NF,$1&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>æ‰“å°<code>/etc/passwd</code>ä¸­<code>UID(å³ç¬¬ä¸‰åˆ—)</code>å¤§äº100çš„è¡Œçš„è¡Œå·ï¼Œå­—ç¬¦æ€»æ•°ä»¥åŠç¬¬ä¸€åˆ—(å³æ¯è¡Œçš„ç”¨æˆ·å)</p><p><code>print</code>å®ç°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F <span class="string">':'</span> <span class="string">'&#123;if ($3&gt;100) print "Line:"NR,"Col:"NF,"User:",$1&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure></li></ul><p><code>printf</code>å®ç°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F <span class="string">':'</span> <span class="string">'&#123;if ($3&gt;100) printf("Line:%s,Col:%s,User:%s\n",NR,NF,$1)&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure><ul><li>æå–æœåŠ¡å™¨æ—¥å¿—<code>fresh.log</code>ä¸­<code>ERROR</code>è¡Œå‘ç”Ÿçš„æ—¶é—´</li></ul><p><code>fresh.log</code>å†…å®¹æ ¼å¼å¦‚ä¸‹å›¾</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/7b/0fc81ccb4783036209f7ed10c01128.jpg" alt></p><p>åˆ©ç”¨<code>sed</code>å’Œ<code>awk</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">'/ERROR/p'</span> fresh.log | awk <span class="string">'&#123;print $1&#125;'</span></span><br></pre></td></tr></table></figure><p>åªåˆ©ç”¨<code>awk</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">'/ERROR/&#123;print $1&#125;'</span> fresh.log</span><br></pre></td></tr></table></figure><h1 id="START-END"><a href="#START-END" class="headerlink" title="START END"></a><code>START</code> <code>END</code></h1><blockquote><p><code>awk</code>æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹å¼åœ¨åˆ©ç”¨<code>awk</code>å¤„ç†ç¼–ç¨‹éœ€æ±‚æ—¶çš„é—®é¢˜ï¼Œä¾‹å¦‚åˆ¶è¡¨æ—¶éœ€åœ¨è¡¨å‰æ‰“å°è¡¨å¤´ã€è¡¨åæ‰“å°è¡¨å°¾ã€‚</p></blockquote><blockquote><p>ä¸¾ä¸€ä¸ªæ¡ˆä¾‹ï¼Œåˆ¶è¡¨æ˜¾ç¤º<code>/etc/passwd</code>çš„è¡Œå·ã€åˆ—å·å’Œç”¨æˆ·å</p></blockquote><blockquote><p>æ€è·¯æ˜¯é¦–å…ˆåœ¨å¼€å¤´æ‰“å°â€Line Col Userâ€ï¼Œç„¶åä¾æ¬¡æ‰“å°<code>/etc/passwd</code>æ¯ä¸€è¡Œçš„è¡Œå·ã€åˆ—å·å’Œç”¨æˆ·åï¼Œæœ€åå¦èµ·ä¸€è¡Œæ‰“å°<code>--------</code>å¹¶åœ¨ä¸­é—´åŠ å…¥<code>awk</code>æ“ä½œçš„æ–‡ä»¶åä»¥ç»“æŸåˆ¶è¡¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F <span class="string">':'</span> <span class="string">'BEGIN&#123;print "Line    Col    User"&#125;&#123;print NR,NF,$1&#125;END&#123;print "------",FILENAME,"------"&#125;'</span> /etc/passwd | grep -v <span class="string">"#"</span></span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­çš„<code>grep -v &quot;#&quot;</code>ç”¨ä»¥è¿‡æ»¤æ‰<code>/etc/passwd</code>ä¸­å¼€å¤´çš„æ— ç”¨è¯´æ˜ä¿¡æ¯</p></blockquote><h2 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h2><blockquote><p>ä¸ºæˆªå›¾æ–¹ä¾¿è¿™é‡Œåªæˆªäº†å‰é¢çš„ä¸€äº›è¡Œå’Œæœ€åçš„ä¸€äº›è¡Œ</p></blockquote><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/93/04d33ecfbe22a469a95806f4d7e33f.jpg" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/6a/599d7e553eddcb04e05d87118fe358.jpg" alt></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      awk ä½¿ç”¨å°è®°
    
    </summary>
    
      <category term="Linux" scheme="https://iamzhl.top/categories/Linux/"/>
    
      <category term="å­¦ä¹ " scheme="https://iamzhl.top/categories/Linux/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Linux" scheme="https://iamzhl.top/tags/Linux/"/>
    
      <category term="å­¦ä¹ " scheme="https://iamzhl.top/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>quicksort</title>
    <link href="https://iamzhl.top/quicksort.html"/>
    <id>https://iamzhl.top/quicksort.html</id>
    <published>2018-07-20T04:53:01.000Z</published>
    <updated>2019-03-11T16:21:49.905Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quicksort</span><span class="params">(<span class="keyword">int</span> a[], <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="keyword">int</span> i, j, t, temp; </span><br><span class="line"><span class="keyword">if</span>(left &gt; right) </span><br><span class="line">   <span class="keyword">return</span>; </span><br><span class="line"></span><br><span class="line">temp = a[left];</span><br><span class="line">i = left; </span><br><span class="line">j = right; </span><br><span class="line"><span class="keyword">while</span>(i != j) </span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">while</span>(a[j] &gt;= temp &amp;&amp; i &lt; j) </span><br><span class="line">j --; </span><br><span class="line"><span class="keyword">while</span>(a[i] &lt;= temp &amp;&amp; i &lt; j) </span><br><span class="line">i ++; </span><br><span class="line"><span class="keyword">if</span>(i &lt; j) </span><br><span class="line">&#123; </span><br><span class="line">t = a[i]; </span><br><span class="line">a[i] = a[j]; </span><br><span class="line">a[j] = t; </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line">a[left] = a[i]; </span><br><span class="line">a[i] = temp; </span><br><span class="line"> </span><br><span class="line">quicksort(a, left, i<span class="number">-1</span>);</span><br><span class="line">quicksort(a, i+<span class="number">1</span>, right);</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i, j, t; </span><br><span class="line"><span class="keyword">int</span> n = <span class="number">5</span>;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line"><span class="keyword">int</span> a[n];</span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">1</span>;i &lt;= n; i++) </span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;a[i]); </span><br><span class="line"></span><br><span class="line">quicksort(a, <span class="number">1</span>, n);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">1</span>; i &lt;= n; i++) </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d "</span>, a[i]); </span><br><span class="line"><span class="built_in">putchar</span>(<span class="string">'\n'</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h1><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/b8/847de187a667d431036df4a77966d9.jpg" alt></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      å¿«é€Ÿæ’åºç®—æ³•å®ç°
    
    </summary>
    
      <category term="ç®—æ³•" scheme="https://iamzhl.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="å¿«é€Ÿæ’åº" scheme="https://iamzhl.top/tags/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>High Sierra å’Œ Mojave é•œåƒå¤§å…¨</title>
    <link href="https://iamzhl.top/High-Sierra-and-Mojave-Images-update.html"/>
    <id>https://iamzhl.top/High-Sierra-and-Mojave-Images-update.html</id>
    <published>2018-07-15T07:58:04.000Z</published>
    <updated>2019-03-30T13:15:13.490Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬äººæ‰€æœ‰é•œåƒå‡é‡‡ç”¨<code>Applestore</code>å®˜æ–¹å•†åº—ä¸‹è½½æ•´åŒ…åˆ¶ä½œï¼Œé€‚ç”¨äº<code>gpt</code>åˆ†åŒºè¡¨ï¼ŒåŠ å…¥äº†å„ä¸ªç‰ˆæœ¬åˆšæ¨é€æ—¶çš„<code>Clover</code>æºç æœ€æ–°å¼•å¯¼ï¼Œåç»­çš„æµ‹è¯•ç‰ˆæ¨é€ä¹‹åæˆ‘ä¼šå°½æ—©åšå‡ºä¾›å›å‹ä½¿ç”¨ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒç»™æ¥¼ä¸»åŠ ä¸ªåˆ†ï¼Œä½ ä»¬çš„æ”¯æŒå°±æ˜¯æˆ‘çš„åŠ¨åŠ›</p><hr><p>æ¥¼ä¸»æ‰€åšçš„é•œåƒå…¨éƒ¨é›†æˆå¤šé©±åŠ¨ï¼Œå¤š<code>config</code>ï¼Œé•œåƒæ‰€é›†æˆçš„è¿™äº›ä¸œè¥¿åªæ˜¯æ–¹ä¾¿å¤§å®¶ç”¨ï¼Œå›å‹å†™å…¥ä¹‹åè¯·é€‚å½“åˆ å‡ä½¿ç”¨ï¼Œæœ‰èƒ½åŠ›çš„æˆ–è€…æœ¬èº«è‡ªå·±æœ‰ä¸€å¥—é€‚åˆè‡ªå·±çš„<code>EFI</code>çš„æœ‹å‹è¯·ç”¨è‡ªå·±çš„ï¼Œæœ›å‘¨çŸ¥ã€‚</p><p><strong><em>PS: é•œåƒå†…é©±åŠ¨å’Œconfigæ˜¯ä¸ºæ–°æ‰‹å‡†å¤‡ï¼Œè€é¸Ÿå‹¿å–·<br>é•œåƒå†…æœ‰æ–‡ä»¶è¯¦ç»†è¯´æ˜ï¼Œæ–°æ‰‹è¯·æŒ‰è¯´æ˜è‡ªè¡Œé…ç½®å¼•å¯¼ã€‚</em></strong></p><h2 id="æœ€è¿‘ä¸€æ¬¡æ›´æ–°å†…å®¹"><a href="#æœ€è¿‘ä¸€æ¬¡æ›´æ–°å†…å®¹" class="headerlink" title="æœ€è¿‘ä¸€æ¬¡æ›´æ–°å†…å®¹"></a>æœ€è¿‘ä¸€æ¬¡æ›´æ–°å†…å®¹</h2><p>æ–°æ¬¾<code>MacBook Pro</code>ä¸Šå¸‚ä¹‹åï¼Œ<code>Apple</code>æ¨å‡ºç‰¹ä¾›ç‰ˆæœ¬ä»¥æ”¯æŒå…«ä»£<code>CPU</code>ï¼Œä¾ç„¶æ˜¯<code>10.13.6</code>ï¼Œæ­¤æ¬¡ç‰ˆæœ¬å·ä¸º<code>17G2208</code>ï¼Œç»æµ‹è¯•ï¼Œå·²åŸç”Ÿæ”¯æŒå…«ä»£æœºå™¨</p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/35/a6f93b4a09ab4880e7b5736b6e87e7.jpg" alt></p><p>æ­¤å¤–,<code>Clover</code>ä¹ŸåŠæ—¶è·Ÿæ–°äº†<code>mbp15,1</code>ä»¥åŠ<code>mbp15,2</code>çš„<code>SMBIOS</code>ï¼Œæ¨èå¤§å®¶ä½¿ç”¨ï¼Œä½å‹æœ¬ç”¨<code>mbp15,2</code>ï¼Œå…¶ä»–<code>mbp15,1</code>ï¼Œä¸‹é¢æ˜¯<code>SMBIOS</code>ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥å¥—ç”¨ï¼Œè®°å¾—ä¿®æ”¹<code>BoardSerialNumber</code>ä¸ºè‡ªå·±ä¹‹å‰æ­£åœ¨ç”¨çš„ã€‚</p><blockquote><p>MacBook Pro 15,1</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;SMBIOS&lt;/key&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;BiosReleaseDate&lt;/key&gt;</span><br><span class="line">&lt;string&gt;06/26/2018&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BiosVendor&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BiosVersion&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MBP151.88Z.0178.B00.1806260902&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Board-ID&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Mac-937A206F2EE63C01&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BoardManufacturer&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BoardSerialNumber&lt;/key&gt;</span><br><span class="line">&lt;string&gt;C02418108QXF64WCB&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BoardType&lt;/key&gt;</span><br><span class="line">&lt;integer&gt;11&lt;/integer&gt;</span><br><span class="line">&lt;key&gt;BoardVersion&lt;/key&gt;</span><br><span class="line">&lt;string&gt;1.0&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ChassisAssetTag&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MacBook-Aluminum&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ChassisManufacturer&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ChassisType&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0x09&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Family&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MacBook Pro&lt;/string&gt;</span><br><span class="line">&lt;key&gt;FirmwareFeatures&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0xFC0FE137&lt;/string&gt;</span><br><span class="line">&lt;key&gt;FirmwareFeaturesMask&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0xFF1FFF3F&lt;/string&gt;</span><br><span class="line">&lt;key&gt;LocationInChassis&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Part Component&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Manufacturer&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Mobile&lt;/key&gt;</span><br><span class="line">&lt;true/&gt;</span><br><span class="line">&lt;key&gt;PlatformFeature&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0x1A&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ProductName&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MacBookPro15,1&lt;/string&gt;</span><br><span class="line">&lt;key&gt;SerialNumber&lt;/key&gt;</span><br><span class="line">&lt;string&gt;C02X1HACKGYG&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Version&lt;/key&gt;</span><br><span class="line">&lt;string&gt;1.0&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br></pre></td></tr></table></figure><blockquote><p>MacBook Pro 15,2</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;SMBIOS&lt;/key&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">&lt;key&gt;BiosReleaseDate&lt;/key&gt;</span><br><span class="line">&lt;string&gt;06/26/2018&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BiosVendor&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BiosVersion&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MBP152.88Z.0178.B00.1806260902&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Board-ID&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Mac-827FB448E656EC26&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BoardManufacturer&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BoardSerialNumber&lt;/key&gt;</span><br><span class="line">&lt;string&gt;C02418108QXF64WCB&lt;/string&gt;</span><br><span class="line">&lt;key&gt;BoardType&lt;/key&gt;</span><br><span class="line">&lt;integer&gt;11&lt;/integer&gt;</span><br><span class="line">&lt;key&gt;BoardVersion&lt;/key&gt;</span><br><span class="line">&lt;string&gt;1.0&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ChassisAssetTag&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MacBook-Aluminum&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ChassisManufacturer&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ChassisType&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0x09&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Family&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MacBook Pro&lt;/string&gt;</span><br><span class="line">&lt;key&gt;FirmwareFeatures&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0xFC0FE137&lt;/string&gt;</span><br><span class="line">&lt;key&gt;FirmwareFeaturesMask&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0xFF1FFF3F&lt;/string&gt;</span><br><span class="line">&lt;key&gt;LocationInChassis&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Part Component&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Manufacturer&lt;/key&gt;</span><br><span class="line">&lt;string&gt;Apple Inc.&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Mobile&lt;/key&gt;</span><br><span class="line">&lt;true/&gt;</span><br><span class="line">&lt;key&gt;PlatformFeature&lt;/key&gt;</span><br><span class="line">&lt;string&gt;0x1A&lt;/string&gt;</span><br><span class="line">&lt;key&gt;ProductName&lt;/key&gt;</span><br><span class="line">&lt;string&gt;MacBookPro15,2&lt;/string&gt;</span><br><span class="line">&lt;key&gt;SerialNumber&lt;/key&gt;</span><br><span class="line">&lt;string&gt;C02X1HACJHCD&lt;/string&gt;</span><br><span class="line">&lt;key&gt;Version&lt;/key&gt;</span><br><span class="line">&lt;string&gt;1.0&lt;/string&gt;</span><br><span class="line">&lt;/dict&gt;</span><br></pre></td></tr></table></figure><h2 id="é•œåƒå†…å®¹"><a href="#é•œåƒå†…å®¹" class="headerlink" title="é•œåƒå†…å®¹"></a>é•œåƒå†…å®¹</h2><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/88/e3735f1df7c1698869bc4700b0e34f.png" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/48/99a6d0d9094d41acc455008be82109.png" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/48/87d2b0ec6f40a3df7347148b03d196.png" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/04/9fa489977f2fc21eccce5b795eddb6.png" alt></p><p><img src="https://raw.githubusercontent.com/athlonreg/BlogImages/master/Images/a6/ba1d85d46d0523daf0d539579bcbbd.png" alt></p><h2 id="é•œåƒåœ°å€"><a href="#é•œåƒåœ°å€" class="headerlink" title="é•œåƒåœ°å€"></a>é•œåƒåœ°å€</h2><p>æ¯å‡ºä¸€ä¸ªç‰ˆæœ¬éƒ½å†™ä¸€ä¸ªå¸–å­çš„è¯å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥å†³å®šç›´æ¥å†™ä¸€ä¸ªé•œåƒçš„é›†åˆè´´ï¼Œä¸‹é¢æ˜¯å„ä¸ªç‰ˆæœ¬çš„é“¾æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥:https://pan.baidu.com/s/1ymm0dm2R3dlFGyCH88fbmA  å¯†ç :vvon</span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ ¡éªŒ"><a href="#é•œåƒæ ¡éªŒ" class="headerlink" title="é•œåƒæ ¡éªŒ"></a>é•œåƒæ ¡éªŒ</h2><p>ä¸ºé˜²æ­¢ä¸‹è½½æ–‡ä»¶æŸåï¼Œè¯·å°½é‡è¿›è¡Œ<code>MD5</code>ã€<code>SHA1</code>ã€<code>SHA256</code>æ ¡éªŒï¼Œæ ¡éªŒæ–‡ä»¶ä»¥å›¾ç‰‡çš„å½¢å¼å­˜åœ¨äºå„ä¸ªé•œåƒæ–‡ä»¶å¤¹å†…ã€‚</p><h2 id="é•œåƒåˆ—è¡¨"><a href="#é•œåƒåˆ—è¡¨" class="headerlink" title="é•œåƒåˆ—è¡¨"></a>é•œåƒåˆ—è¡¨</h2><ul><li><p>OS X EI Capitan</p><ul><li>OS X EI Capitan 10.11.6 15G31</li></ul></li><li><p>macOS Sierra</p><ul><li>macOS Sierra 10.12.5 16F73</li><li>macOS Sierra 10.12.6 16G29</li></ul></li><li><p>macOS High Sierra</p><ul><li>macOS High Sierra DP1 17A264c</li><li>macOS High Sierra DP1 17A291m</li><li>macOS High Sierra DP1 17A306F</li><li>macOS High Sierra DP1 17A315i</li><li>macOS High Sierra DP1 17A330h</li><li>macOS High Sierra DP1 17A344b</li><li>macOS High Sierra DP1 17A352a</li><li>macOS High Sierra DP1 17A358a</li><li>macOS High Sierra DP1 17A360a</li><li>macOS High Sierra Golden Master 17A362a</li><li>macOS High Sierra 10.13.0 17A365</li><li>macOS High Sierra 10.13.0 17A405</li><li>macOS High Sierra 10.13.1 17B48</li><li>macOS High Sierra 10.13.2 17C88</li><li>macOS High Sierra 10.13.2 17C88 å…‰ - æš—å½±ç²¾çµ II ä¸“ç”¨</li><li>macOS High Sierra 10.13.3 17D47</li><li>macOS High Sierra 10.13.4 17E199</li><li>macOS High Sierra 10.13.5 17F77</li><li>macOS High Sierra 10.13.6 17G65</li><li>macOS High Sierra 10.13.6 17G2112</li><li>macOS High Sierra 10.13.6 17G2208</li></ul></li><li><p>macOS Mojave</p><ul><li>macOS Mojave 10.14 DP1 18A293u</li><li>macOS Mojave 10.14 DP2 18A324h</li><li>macOS Mojave 10.14 DP3 18A326h</li><li>macOS Mojave 10.14 DP4 18A336e</li><li>macOS Mojave 10.14 DP5 18A347e</li><li>macOS Mojave 10.14 DP6 18A353d</li><li>macOS Mojave 10.14 DP7 18A365a</li><li>macOS Mojave 10.14 DP8 18A371a</li><li>macOS Mojave 10.14 DP9 18A377a</li><li>macOS Mojave 10.14 DP10 18A384a</li><li>macOS Mojave 10.14 Golden Master 18A389</li><li>macOS Mojave 10.14.0 18A389</li><li>macOS Mojave 10.14.1 18B75</li><li>macOS Mojave 10.14.1 18B2107</li><li>macOS Mojave 10.14.1 18B3094</li><li>macOS Mojave 10.14.2 18C54</li><li>macOS Mojave 10.14.3 18D42</li><li>macOS Mojave 10.14.4 18E226</li><li>macOS Mojave 10.14.4 18E2034 (iMac 19 ç‰¹ä¾›ç‰ˆ)</li></ul></li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      macOS High Sierra ä»¥åŠ macOS Mojave é•œåƒå¤§å…¨(æŒç»­æ›´æ–°)
    
    </summary>
    
      <category term="é»‘è‹¹æœ" scheme="https://iamzhl.top/categories/%E9%BB%91%E8%8B%B9%E6%9E%9C/"/>
    
    
      <category term="åŸç‰ˆé•œåƒ" scheme="https://iamzhl.top/tags/%E5%8E%9F%E7%89%88%E9%95%9C%E5%83%8F/"/>
    
      <category term="é»‘è‹¹æœé•œåƒ" scheme="https://iamzhl.top/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C%E9%95%9C%E5%83%8F/"/>
    
  </entry>
  
  <entry>
    <title>mac ä¸Šä½¿ç”¨å­—ç¬¦ä¸²å¤„ç†ç¥å™¨ sed çš„æ­£ç¡®å§¿åŠ¿</title>
    <link href="https://iamzhl.top/Command-sed-on-mac.html"/>
    <id>https://iamzhl.top/Command-sed-on-mac.html</id>
    <published>2018-07-07T14:04:34.000Z</published>
    <updated>2019-03-11T16:21:49.886Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><!-- build time:Sun May 12 2019 12:32:26 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>sed</code>æ˜¯<code>shell</code>ä¸­å­—ç¬¦ä¸²å¤„ç†çš„ä¸‰å¤§ç¥å™¨ä¹‹ä¸€ï¼Œåˆ©ç”¨<code>sed</code>è¿›è¡Œå­—ç¬¦ä¸²å¤„ç†å¯¹ä»äº‹<code>Linux</code>ç›¸å…³èŒä¸šçš„äººæ¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½†æ˜¯åœ¨<code>mac</code>ä¸Šçš„<code>sed</code>ä¸<code>Linux</code>çš„<code>sed</code>æ˜¯æœ‰ä¸€å®šåŒºåˆ«çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸º<code>mac</code>å®è´¨ä¸Šå’Œ<code>Linux</code>å°±æ˜¯ä¸ä¸€æ ·çš„ï¼Œå°½ç®¡å…¶ä¸­å¾ˆå¤šåŸºæœ¬å‘½ä»¤æ˜¯é€šç”¨çš„ï¼Œä¾‹å¦‚<code>ls</code>ã€<code>cd</code>ã€<code>pwd</code>ç­‰ã€‚<code>mac</code>æ˜¯<code>unix</code>å†…æ ¸ï¼Œæ˜¯åŸºäº<code>FreeBSD</code>çš„ï¼Œè€Œæˆ‘ä»¬å¸¸ç”¨çš„<code>Linux</code>å¦‚<code>Ubuntu</code>ã€<code>CentOS</code>ç­‰æ˜¯<code>Linux</code>å†…æ ¸ã€‚</p><h2 id="sedçš„ä¸åŒ"><a href="#sedçš„ä¸åŒ" class="headerlink" title="sedçš„ä¸åŒ"></a><code>sed</code>çš„ä¸åŒ</h2><p>éå¸¸å¤§çš„ä¸€ä¸ªå‘å°±æ˜¯<code>sed</code>å‘½ä»¤çš„ä¸ç»Ÿä¸€ï¼Œ<code>Linux</code>çš„<code>sed</code>æ˜¯åŸºäº<code>GNU</code>çš„<code>sed</code>ï¼Œè€Œ<code>FreeBSD</code>ä¸­çš„<code>sed</code>åˆ™æ˜¯åŸºäº<code>XNU</code>çš„ï¼Œå…¶ç”¨æ³•æœ‰äº›ä¸åŒï¼Œä¸‹é¢ä¼šåšå¯¹æ¯”ç®€è¦è¯´æ˜ã€‚</p><p>æ‹¿æœ€å¸¸ç”¨çš„è¿½åŠ è¡Œæ¥è¯´ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘éœ€è¦å¯¹<code>test.txt</code>æ–‡ä»¶å®æ—¶å†™å…¥ï¼Œåœ¨æ–‡ä»¶ç¬¬äºŒè¡Œæ·»åŠ <code>1234</code>ï¼Œæ–‡ä»¶åˆå§‹å†…å®¹å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.txt</span><br><span class="line">3333</span><br><span class="line">1112</span><br><span class="line">3333</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">4444</span><br><span class="line">5555</span><br></pre></td></tr></table></figure><p>åœ¨<code>Linux</code>ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯å®ç°è¿½åŠ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i -e <span class="string">'1a\1234'</span> test.txt</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨<code>mac</code>ä¸‹è¿™æ¡å‘½ä»¤ä¼šæŠ¥é”™å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed: 1: &quot;1a\1234&quot;: extra characters after \ at the end of a command</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º<code>xnu</code>çš„<code>sed</code>å‘½ä»¤ç”¨æ³•ä¸åŒäº<code>gnu</code>ï¼Œå…·ä½“å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹<code>sed</code>å‘½ä»¤æ‰‹å†Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ man sed</span><br></pre></td></tr></table></figure><p><img src="https://ws1.sinaimg.cn/large/006dLY5Ily1fypvvrfr68j31p818kn8n.jpg" alt></p><p>é‚£ä¹ˆæˆ‘æƒ³ç”¨æˆ‘ä¹ æƒ¯çš„<code>Linux</code>çš„<code>GNU-sed</code>æ€ä¹ˆè§£å†³å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…<code>gnu-sed</code>æ¥ä»£æ›¿ç³»ç»Ÿå†…çš„<code>sed</code>ï¼Œå…·ä½“æ–¹æ³•å¦‚ä¸‹</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦<code>Homebrew</code>åŒ…ç®¡ç†å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œé€šè¿‡<code>brew</code>æ¥å®‰è£…<code>gnu-sed</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install gnu-sed</span><br></pre></td></tr></table></figure><p>é»˜è®¤<code>brew</code>ä¼šå°†<code>gnu-sed</code>å®‰è£…åˆ°<code>/usr/local/Cellar/</code>ç›®å½•ä¸‹ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨<code>gsed</code>æ¥æ‰§è¡Œäº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gsed -i -e <span class="string">'1a\1234'</span> test.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœæç¤ºå‘½ä»¤æ‰¾ä¸åˆ°çš„è¯ï¼Œåªéœ€è¦å°†ä¸‹é¢çš„è·¯å¾„æ·»åŠ åˆ°<code>PATH</code>ç¯å¢ƒå˜é‡å°±å¯ä»¥äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/Cellar/gnu-sed/4.5/bin/</span><br></pre></td></tr></table></figure><p>æˆ–è€…å°†<code>/usr/local/Cellar/gnu-sed/4.5/bin/gsed</code>æ·»åŠ åˆ«åéƒ½å¯ä»¥ã€‚</p><p>ç½‘ä¸Šä¹Ÿæœ‰äººç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install gnu-sed --with-default-names</span><br></pre></td></tr></table></figure><p>è²Œä¼¼è¿™ç§æ–¹å¼ç›´æ¥æ›¿ä»£äº†ç³»ç»Ÿå†…çš„<code>sed</code>ï¼Œæˆ‘ä¸ªäººä¸æ˜¯å¾ˆæ¨èè¿™ç§æ–¹å¼ï¼Œä¸æ˜¯è¯´ä¸å¥½ï¼Œè€Œæ˜¯å½“æˆ‘ä»¬çš„æœºå™¨ä¸åªæ˜¯ä¸€ä¸ªäººç”¨ï¼Œæ˜¯åšæœåŠ¡å™¨ç”¨çš„ï¼Œæˆ–è€…æœ‰ä¸€äº›æˆ‘ä»¬æ­£åœ¨ç”¨çš„è„šæœ¬é‡Œé¢æœ‰<code>xnu</code>çš„<code>sed</code>è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å°±ä¼šé€ æˆä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºå®‰è£…äº†<code>gnu-sed</code>åï¼Œåˆ©ç”¨åˆ«åã€ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰æ–¹å¼è°ƒç”¨æ˜¯æ›´å¥½çš„ä¸€ç§æ–¹æ³•ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªæ ¹æ®ä¸ªäººéœ€æ±‚å†³å®šå°±å¥½äº†ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      macä¸Šä½¿ç”¨å­—ç¬¦ä¸²å¤„ç†ç¥å™¨sedçš„æ­£ç¡®å§¿åŠ¿
    
    </summary>
    
      <category term="å­¦ä¹ " scheme="https://iamzhl.top/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="sed" scheme="https://iamzhl.top/tags/sed/"/>
    
      <category term="gnu-sed" scheme="https://iamzhl.top/tags/gnu-sed/"/>
    
      <category term="xnu-sed" scheme="https://iamzhl.top/tags/xnu-sed/"/>
    
  </entry>
  
</feed>
